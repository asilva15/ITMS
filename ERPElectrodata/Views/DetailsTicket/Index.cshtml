@model ERPElectrodata.Models.DETAILS_TICKET

@{
    ViewBag.Title = "Index";
    var impacto = ViewBag.Impacto;
    var garantiaProveedor = ViewBag.GarantiaProveedor;
    ViewBag.ID_CATE_MINSUR = ViewBag.ID_CATE_MINSUR ?? "0";
    Layout = "~/Views/Shared/_LayoutKendo22.cshtml";
}
<style>
    table.k-editor {
        height: auto !important;
    }

    .navVertical {
        margin: 0px;
        padding: 0px;
        list-style: none;
    }

        .navVertical ul {
            margin: 0px;
            padding: 0px;
            width: 100%;
            list-style: none;
        }

            .navVertical ul li {
                float: left;
                color: #022A41;
                font-size: 13px;
                margin: 0px;
                padding: 0px;
                border-bottom: 1px solid #e2e2e2;
                width: 100%;
            }

                .navVertical ul li a {
                    text-decoration: none;
                    color: #022A41;
                }

                    .navVertical ul li a div {
                        padding: 6px 10px 6px 10px;
                    }

                    .navVertical ul li a:hover div {
                        background-color: #022A41;
                        color: #e2e2e2;
                    }

    #navDT {
        width: 100%;
        list-style: none;
        margin: 0px;
        padding: 0px;
    }

        #navDT ul {
            margin: 0px;
            margin-top: 2px;
            /*border:solid 1px #e2e2e2;*/
            /*background-color:#e2e2e2;*/
            display: inline-block;
            list-style: none;
            padding: 0px;
            width: 100%;
            border-top: solid 1px #e2e2e2;
            /*border-bottom:solid 1px #e2e2e2;*/
        }

            #navDT ul li {
                float: left;
                color: #022A41;
                font-size: 13px;
                margin: 0px;
                padding: 0px;
            }

                #navDT ul li a {
                    text-decoration: none;
                    color: #022A41;
                }

                    #navDT ul li a div {
                        padding: 6px 10px 6px 10px;
                    }

                    #navDT ul li a:hover div {
                        background-color: #022A41;
                        color: #e2e2e2;
                    }

    .activeNavDT {
        background-color: #022A41;
        color: #e2e2e2;
    }

    .titulo a:hover {
        color: #2E64FE;
        cursor: pointer;
    }

    #tamGestionCambio {
        width: 78% !important;
    }

    .smallTitulo {
        opacity: .8;
        font-weight: bold;
    }

    .smallCampo {
        color: #444444;
        text-transform: capitalize;
    }

    /*Estilos de barra de progreso*/
    .circular-progress {
        position: relative;
        height: 150px;
        width: 150px;
        border-radius: 50%;
        display: grid;
        place-items: center;
    }

        .circular-progress:before {
            content: "";
            position: absolute;
            height: 84%;
            width: 84%;
            background-color: #ffffff;
            border-radius: 50%;
        }

    .value-container {
        position: relative;
        font-family: "Poppins", sans-serif;
        font-size: 30px;
        color: #231c3d;
    }

    .btn-error {
        color: #fff;
        background-color: #d92550;
        border-color: #d92550;
    }
</style>
@*
<script src="~/Content/themes/plugin/toastr/toastr.min.js"></script>
<link href="~/Content/themes/plugin/toastr/toastr.min.css" rel="stylesheet" />
<input type="hidden" id="IdIdioma" name="IdIdioma" value="@Session[" IdIdioma"]" />
<link href="~/Content/themes/plugin/iCheck/square/blue.css" rel="stylesheet" />
<script src="~/Content/themes/plugin/iCheck/icheck.js"></script>
<script src="~/Scripts22/js/jquery-3.7.0.min.js"></script>
<script src="~/Scripts/Itms/Plugins/switchery.js"></script>
<link href="~/Content/ITMS/switchery.css" rel="stylesheet" />
<link href="~/Content/ITMS/starrr.css" rel="stylesheet" />
<script src="~/Scripts/Itms/Plugins/starrr.js"></script>*@

@*<link href="~/Content/sweet-alert.css" rel="stylesheet" />
<script src="~/Scripts/sweet-alert.js"></script>*@

<link href="~/Content/themes/plugin/iCheck/square/blue.css" rel="stylesheet" />
<script src="~/Content/themes/plugin/iCheck/icheck.js"></script>
<script src="~/Content/themes/plugin/toastr/toastr.min.js"></script>
<link href="~/Content/themes/plugin/toastr/toastr.min.css" rel="stylesheet" />
<script>
    $(document).ready(function () {
        $('input').iCheck({
            checkboxClass: 'icheckbox_square-blue',
            radioClass: 'iradio_square-blue',
            increaseArea: '20%' // optional
        });
    });
</script>

<div class="row">
    <div class="col-md-7">
        <div class="main-card mb-3 card">
            <div class="card-header">
                <div style="flex: 25%">
                    @ViewBag.NAM_TYPE_TICK # @ViewBag.COD_TICK
                </div>
                <div style="flex: 50%">
                    <div style="padding-top:3px; padding-right:1%; float:right; width:73%; text-transform:capitalize; text-align:right;" id="divCIA"></div>
                </div>
                <div style="flex: 25%">
                    @{
                    if (Convert.ToInt32(Session["ID_ACCO"].ToString()) == 60)
                    {
                    <div class="progress ml-auto">
                        <div id="progressSLATicket" class="progress-bar" role="progressbar" hidden></div>
                    </div>
                    }
                    }
                </div>
            </div>
            <input type="hidden" id="idUsuario" name="idUsuario" readonly="readonly" />
            <div class="card-body">
                <div id="divDetaTicket">
                </div>

                <div id="divComentario">
                </div>
                @{
                if (Convert.ToInt32(Session["ID_ACCO"].ToString()) == 60)
                {



                <div class="col-md-3">
                    <div class="form-group">
                        @if (@ViewBag.Estado != 4)
                        {
                        <button type="button" class="mb-2 mr-2 btn btn-gradient-info" onclick="RegistrarHoraReal();" id="BotonFechaReal">En Proceso</button>
                        }
                        <div id="fechaInicioReal">
                            @if (@ViewBag.FechaInicioReal != null)
                            {
                            <div>
                                <p class="smallTitulo">
                                    Fecha de inicio real:
                                </p>
                                @ViewBag.FechaInicioReal
                            </div>
                            }
                        </div>


                    </div>
                </div>
                }

                }

                <div class="card-body">
                    <ul class="tabs-animated-shadow nav-justified tabs-animated nav">
                        <li class="nav-item">
                            <a role="tab" class="nav-link active" id="tabActividad" data-toggle="tab" aria-selected="true">
                                <span class="nav-text"><i class="fa fa-comment"></i> Actividad</span>
                            </a>
                        </li>

                        @{if (@ViewBag.ID_CATE == 20813 || @ViewBag.ID_CATE == 21265 || @ViewBag.ID_CATE == 21296 || @ViewBag.ID_CATE == 21300)
                        {
                        if (@ViewBag.ID_QUEU_TAREA != 1 & @ViewBag.ID_QUEU_TAREA != 25)
                        {
                        if (@ViewBag.ID_ACCO != 56 && @ViewBag.ID_ACCO != 57 && @ViewBag.ID_ACCO != 58 && @ViewBag.ID_ACCO != 60)
                        {
                        <li class="nav-item">
                            <a role="tab" class="nav-link" id="tabActividadProgramar" data-toggle="tab" aria-selected="false">
                                <span class="nav-text"><i class="fa fa-calendar"></i> Programar</span>
                            </a>
                        </li>
                        }



                        <li class="nav-item">
                            <a role="tab" class="nav-link" id="tabCambiarEstado" data-toggle="tab">
                                <span class="nav-text"><i class="fa fa-arrow-circle-up"></i> Cambiar Estado</span>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a role="tab" class="nav-link" id="tabTransferir" data-toggle="tab">
                                <span class="nav-text"><i class="fa fa-fighter-jet"></i> Transferir</span>
                            </a>
                        </li>
                        }

                        }
                        else
                        {
                        if (@ViewBag.ID_ACCO != 56 && @ViewBag.ID_ACCO != 57 && @ViewBag.ID_ACCO != 58 && @ViewBag.ID_ACCO != 60)
                        {
                        <li class="nav-item">
                            <a role="tab" class="nav-link" id="tabActividadProgramar" data-toggle="tab" aria-selected="false">
                                <span class="nav-text"><i class="fa fa-calendar"></i> Programar</span>
                            </a>
                        </li>
                        }



                        <li class="nav-item">
                            <a role="tab" class="nav-link" id="tabCambiarEstado" data-toggle="tab">
                                <span class="nav-text"><i class="fa fa-arrow-circle-up"></i> Cambiar Estado</span>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a role="tab" class="nav-link" id="tabTransferir" data-toggle="tab">
                                <span class="nav-text"><i class="fa fa-fighter-jet"></i> Transferir</span>
                            </a>
                        </li>
                        }
                        }
                    </ul>
                    @using (Html.BeginForm("Create", "DetailsTicket", FormMethod.Post, new { enctype = "multipart/form-data", id = "FrmDetailIncident", target = "upload_target" }))
                    {
                    @Html.ValidationSummary(true)
                    <input type="hidden" value="@ViewBag.UploadFile" name="KEY_ATTA" id="KEY_ATTA" readonly="readonly" />
                    @Html.HiddenFor(model => model.ID_TICK)

                    @Html.HiddenFor(model => model.ID_TYPE_DETA_TICK)
                    <div class="tab-content" id="DetalleTicketPrinc">
                        <div class="tab-pane active" id="tab-animated1-0" role="tabpanel">
                            <div class="form-row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label id="" for="" class="">Desde </label>
                                        @Html.EditorFor(model => model.FROM_TIME)
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label id="" for="" class="">Hasta </label>
                                        @Html.EditorFor(model => model.TO_TIME)
                                    </div>
                                </div>
                                <div class="col-md-4" id="DivCausa">
                                    <div class="form-group">
                                        <label id="" for="" class="" style="padding-left:20px">Causas </label>
                                        <div class="position-relative form-group">
                                            <div>
                                                <div class="custom-checkbox custom-control">
                                                    @Html.CheckBox("Causa", false)
                                                    @Html.ValidationMessageFor(model => model.Causa)
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div id="subcategorizacionPry" class="divHide">
                                <div class="form-row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label id="" for="" class="">Etapa </label>
                                            <input id="cboEtapa" name="cboEtapa" type="text" />
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label id="" for="" class="">Actividad </label>
                                            <input id="cboActividad" name="cboActividad" type="text" />
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label id="" for="" class="">Subcategoría </label>
                                            <input id="cboSubcategoria" name="cboSubcategoria" type="text" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col-md-12" id="DivEstado" hidden>

                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label id="" for="" class="">Estado </label>
                                                
                                                @Html.EditorFor(model => model.ID_STAT, new { htmlAttributes = new { id = "ID_STAT" } })
                                                @Html.ValidationMessageFor(model => model.ID_STAT)
                                            </div>
                                        </div>

                                        @{
                                            if (Convert.ToInt32(Session["ID_ACCO"].ToString()) == 60)
                                            {

                                                <div class="col-md-4" id="impactoServicioContainer" style="display: none;">
                                                    <div class="form-group">
                                                        <label id="" for="" class="">Impacto del Servicio </label>
                                                        <input id="ImpactoServicio" name="ImpactoServicio" />
                                                    </div>
                                                </div>

                                            }
                                        }





                                    </div>


                                    </div>


                                    <div class="col-md-4" id="DivEstado" hidden>
                                        <div class="form-group">
                                            <label id="" for="" class="">Estado </label>
                                            <br />
                                            @Html.EditorFor(model => model.ID_STAT)
                                            @Html.ValidationMessageFor(model => model.ID_STAT)
                                        </div>
                                    </div>

                                    <div class="col-md-4" id="DivFechaProgramada" hidden>
                                        <div class="form-group">
                                            <label id="" for="" class="">Fecha Programada </label>
                                            @Html.EditorFor(model => model.FEC_SCHE)
                                            @Html.ValidationMessageFor(model => model.FEC_SCHE)
                                        </div>
                                    </div>
                                    <div id="divBolsaHoras" hidden>
                                        
                                    </div>
                                </div>
                                <br/>
                                <div class="form-row">
                                    <div class="col-md-4" id="DivControlRemoto" hidden>
                                        <div class="form-group">
                                            <label id="" for="" class="" style="padding-left:20px">Control Remoto </label>
                                            <div class="position-relative form-group">
                                                <div>
                                                    <div class="custom-checkbox custom-control">
                                                        @Html.CheckBox("ControlRemoto", false)
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="col-md-4" id="divTipoResolucion" hidden>
                                        <div class="form-group">
                                            <label id="" for="" class="" style="padding-left:20px">Solución temporal</label>
                                            <div class="position-relative form-group">
                                                <div>
                                                    <div class="custom-checkbox custom-control">
                                                        @Html.CheckBox("TipoResolucion", false)
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                    <div class="col-md-4" id="DivEsperaCliente" hidden>
                                        <div class="form-group">
                                            <label id="" for="" class="" style="padding-left:20px">¿Es Espera Por Cliente? </label>
                                            <div class="position-relative form-group">
                                                <div>
                                                    <div class="custom-checkbox custom-control">
                                                        @Html.CheckBox("EsperaPorCliente", false)
                                                        @Html.ValidationMessageFor(model => model.EsperaPorCliente)
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            <div class="form-row">
                                <div class="col-md-4" id="divMotivoEspera" hidden>
                                    <div class="form-group">
                                        <label>Motivo de Espera </label>
                                        @Html.EditorFor(model => model.IdMotivoEstado)
                                    </div>
                                </div>
                                <div class="col-md-4" id="divMotivoEsperaProgra" hidden>
                                    <div class="form-group">
                                        <label>Motivo de Espera </label>
                                        @Html.Editor("IdMotivoEstadoProgra")
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col-md-4" id="DivArea" hidden>
                                    <div class="form-group">
                                        <label id="" for="" class="">Area Responsable </label>
                                        @Html.EditorFor(model => model.ID_QUEU)
                                        @Html.ValidationMessageFor(model => model.ID_QUEU)
                                    </div>
                                </div>
                                <div class="col-md-4" id="DivAsignado" hidden>
                                    <div class="form-group">
                                        <label id="" for="" class="">Asignado a </label>
                                        @Html.EditorFor(model => model.ID_PERS_ENTI)
                                        @Html.ValidationMessageFor(model => model.ID_PERS_ENTI)
                                    </div>
                                </div>
                                @{
                                if (Convert.ToInt32(Session["ID_ACCO"].ToString()) == 3)
                                {
                                <div class="col-md-4" id="DivFechaFinReal" hidden>
                                    <div class="form-group">
                                        <label id="" for="" class="">Fecha Fin Real </label>
                                        @Html.EditorFor(model => model.FEC_END_REAL)
                                        @Html.ValidationMessageFor(model => model.FEC_END_REAL)
                                    </div>
                                </div>
                                }
                                }

                            </div>
                            <div class="form-row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <div class="form">
                                            <label id="" for="" class="" style="padding-left:20px">¿Ver en el Portal? </label>
                                            <div class="position-relative form-group">
                                                <div>
                                                    <div class="custom-checkbox custom-control">
                                                        @Html.CheckBox("PortalComent", false)
                                                        @Html.ValidationMessageFor(model => model.PortalComent)
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="divCtrlRemot">
                                                <label id="" for="" class="" style="padding-left:20px">Control Remoto</label>
                                                <div class="position-relative form-group">
                                                    <div>
                                                        <div class="custom-checkbox custom-control">
                                                            @Html.CheckBox("ControlRemotoAct", false)
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                            </div>
                            <div class="form-row">
                                <div class="col-md-4">
                                    @{

                                    if (Convert.ToInt32(Session["ID_ACCO"].ToString()) >= 60 && Convert.ToInt32(Session["ID_ACCO"].ToString()) <= 74)
                                    {
                                    <div class="form-group" id="divRazon" hidden>
                                        Razón
                                        @Html.Editor("IdRazon")
                                    </div>
                                    }
                                    else
                                    {
                                    <div class="form-group">
                                    </div>
                                    }
                                    }

                                </div>
                                @*<div class="col-md-4">
                                    <div class="form-group">
                                    </div>
                                </div>*@
                                @{

                                if (Convert.ToInt32(Session["ID_ACCO"].ToString()) != 60)
                                {
                                if (Convert.ToInt32(Session["ID_ACCO"].ToString()) != 56
                                && Convert.ToInt32(Session["ID_ACCO"].ToString()) != 57
                                && Convert.ToInt32(Session["ID_ACCO"].ToString()) != 58)
                                {
                                <div class="col-md-4">
                                    <div class="form-group">
                                        Grupo
                                        @*<label id="cboGrupo" for="ID_GRUPO" class="">Grupo</label>*@
                                        @Html.Editor("IDGRUPO")
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        Plantilla
                                        @*<label id="cboPlantilla" for="ID_PLAN" class="">Plantilla</label>*@
                                        @Html.Editor("IDPLAN")

                                    </div>
                                </div>
                                }

                                }
                                }

                            </div>

                            <div class="form-row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label id="" for="" class="" style="padding-left:20px">Comentario </label>
                                        @Html.TextAreaFor(model => model.COM_DETA_TICK, new { rows = "20" })
                                        @Html.ValidationMessageFor(model => model.COM_DETA_TICK)

                                    </div>
                                </div>


                            </div>
                            <div class="form-row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label id="" for="" class="">&nbsp; </label>
                                        <button type="button" data-toggle="modal" data-target="#miModal" onclick="AdjuntarComentario();" id="Adjuntar" class="mb-2 mr-2 btn-pill btn btn-success btn-block"><span>Adjuntar</span></button>

                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label id="" for="" class="">&nbsp; </label>


                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label id="" for="" class="">&nbsp; </label>


                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label id="" for="" class="">&nbsp; </label>
                                        <button id="submitDetail" type="button" class="mb-2 mr-2 btn-pill btn btn-primary btn-block"><span>Crear</span></button>
                                        <button id="submit" class="mb-2 mr-2 btn-pill btn btn-primary btn-block" hidden><span>Crear</span></button>

                                    </div>
                                </div>


                            </div>
                        </div>
                        <div class="tab-pane" id="tab-animated1-1" role="tabpanel">
                            <p class="mb-0">
                                Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an
                                unknown
                                printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged.
                            </p>
                        </div>
                        <div class="tab-pane" id="tab-animated1-2" role="tabpanel">
                            <p class="mb-0">
                                It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus
                                PageMaker including versions of Lorem Ipsum.
                            </p>
                        </div>
                    </div>
                    <iframe id="upload_target" name="upload_target" src="" hidden></iframe>
                    }


                </div>
                <div id="divDetails"></div>
            </div>
        </div>
    </div>
    <div class="col-md-5">
        @{
        if (Convert.ToInt32(Session["ID_ACCO"].ToString()) == 56 || Convert.ToInt32(Session["ID_ACCO"].ToString()) == 57 || Convert.ToInt32(Session["ID_ACCO"].ToString()) == 58)
        {
        <div class="form-row">
            <div class="col-md-12">
                <div class="main-card mb-3 card">
                    @{
                    if (ViewBag.ID_CATE_MINSUR == 27158 || ViewBag.ID_CATE_MINSUR == 28529 || ViewBag.ID_CATE_MINSUR == 29900
                        || ViewBag.ID_CATE_MINSUR == 32465 || ViewBag.ID_CATE_MINSUR == 32466)
                    {
                    <div class="card-header" style="padding-top:10px;">
                        <div class="col-md-5">Tareas Pendientes</div>
                        <div class="col-md-4">
                            <button id="btnImportarTMovil" onclick="ImportarTareasMinsur(@ViewBag.ID_CATE_MINSUR)" class="mb-2 mr-2 btn-pill btn btn-primary btn-block" data-toggle="modal" data-target="#miModal" type="button">Importar Tareas</button>
                        </div>
                        <div class="col-md-3"><button onclick="ReportexTicket(@ViewBag.ID_TICK)" class="mb-2 mr-2 btn-pill btn btn-primary btn-block" type="button">Reporte</button></div>
                    </div>
                    <div class="card-body">
                        <span id="MensajeTarea"></span>
                        <div id="ListaTarea" class="x_panel">
                            <div class="row">
                                <div style="right:auto" class="col-md-12">
                                    <div class="x_content ticketHijoIndex" id="ticketHijoIndex">
                                        <ul id="divrecargartarea" class="todo-list-wrapper list-group list-group-flush" style='overflow-x: hidden; overflow-y: scroll;max-height:400px;'>
                                            <li class="divListTMinsur"></li>
                                            <li class="divCrearTMinsur"></li>
                                        </ul>
                                    </div>

                                    <div>
                                        <button class="btn-shadow btn btn-primary" type="button" style="height: 35px;" onclick="AgregarFormTareaMinsur(@ViewBag.ID_CATE_MINSUR);">
                                            +
                                        </button>
                                        <button class="btn-shadow btn btn-primary" type="button" style="height: 35px;" onclick="CrearTareasMasivas(@ViewBag.ID_CATE_MINSUR);">
                                            Crear Tareas
                                        </button>
                                        <div style="float: right; margin-right: 30px;">
                                            <button class="btn-shadow btn btn-primary" type="button" style="height: 35px;" onclick="MostrarAlertTMasivas();">
                                                <i class="pe-7s-diskette" style="font-weight:900;"></i>
                                            </button>
                                        </div>
                                        <div id="alertaMinsurTMasiva" class="alert alert-info" role="alert" style="margin-top: 10px; display: none;">
                                            Desea guardar las tareas?
                                            <span onclick="GuardarTMasivasRealizadas(@ViewBag.ID_CATE_MINSUR)" style="cursor: pointer;"><strong>Sí</strong></span>
                                            <button onclick="$('#alertaMinsurTMasiva').hide()" type="button" class="close">
                                                <span aria-hidden="true">×</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    }
                    else
                    {
                    <div class="card-header" style="padding-top:10px">
                        <div class="col-md-9">Tareas Pendientes</div>
                        <div class="col-md-3"><button onclick="ReportexTicket(@ViewBag.ID_TICK)" class="mb-2 mr-2 btn-pill btn btn-primary btn-block" type="button">Reporte</button></div>
                        <input type="hidden" id="idTareaDetalleResolverTicket" />
                        <input type="hidden" id="idEstadoResolverTicket" />
                        <button hidden id="btnResolverTicketTareas" onclick="ResolverTicketTareas(@ViewBag.ID_TICK)" type="button">
                        </button>
                    </div>
                    <div class="card-body">
                        <span id="MensajeTarea"></span>
                        <div id="ListaTarea" class="x_panel">
                            <div class="row">
                                <div style="right:auto" class="col-md-12">
                                    <div class="x_content ticketHijoIndex" id="ticketHijoIndex">
                                        <ul id="divrecargartarea" class="todo-list-wrapper list-group list-group-flush" style='overflow-x: hidden; overflow-y: scroll;max-height:400px;'></ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    }
                    }
                </div>
            </div>
        </div>
        }
        else if (Convert.ToInt32(Session["ID_ACCO"].ToString()) == 60)
        {
            <div class="form-row">
                <div class="col-md-12">
                    <div class="main-card mb-3 card">
                        <div class="card-header" style="padding-top:10px">
                            <div class="col-md-9">Tareas Pendientes</div>
                            <div class="col-md-3">
                                <a class="mb-2 mr-2 btn-pill btn btn-primary btn-block" href="~/Tarea/ReportePorTicket/@ViewBag.ID_TICK" target="_blank">
                                    Reporte
                                </a>
                            </div>
                        </div>
                        <div class="card-body">
                            <span id="MensajeTareaBNV"></span>
                            <div id="ListaTareaBNV" class="x_panel">
                                <div class="row">
                                    <div style="right:auto" class="col-md-12">
                                        <div class="x_content ticketHijoIndexBNV">
                                            <ul class="todo-list-wrapper list-group list-group-flush" style='overflow-x: hidden; overflow-y: scroll;max-height:400px;'></ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
        }

        @if (ViewBag.ID_ACCO == 0)
        {
        <div class="form-row" hidden>
            <div class="col-md-12">
                <div class="main-card mb-3 card">
                    <div class="card-header">
                        Porcentaje de avance
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-center">
                            <div class="circular-progress">
                                <div class="value-container">0%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        }

        @if (ViewBag.ID_ACCO != 60)
        {
        <div class="form-row">
            <div class="col-md-12">
                <div class="main-card mb-3 card">
                    <div class="card-header">
                        Gestión De Cambios
                    </div>
                    <div class="card-body" style="text-align:center">
                        <span id="MensajeCambio"></span>
                        <button id="btnGestionDeCambio" type="button" class="mb-2 mr-2 btn btn-gradient-info" onclick="GenerarCambio()" data-toggle="modal" data-target="#miModal">Generar Cambio</button>
                        <button id="btnIrCambio" type="button" class="mb-2 mr-2 btn btn-gradient-info" onclick="IrCambio(@ViewBag.IdCambio)">Ir al Cambio</button>
                        <button id="btnEntregaActivo" type="button" class="mb-2 mr-2 btn btn-gradient-info">Entrega de Activo</button>
                    </div>
                </div>
            </div>
        </div>
        }

        @if (ViewBag.ID_ACCO == 60 && ViewBag.IdRazon >= 11 && ViewBag.IdRazon <= 14)
        {
        <div id="divAprobacionAccesos" class="form-row">
            <div class="col-md-12">
                <div class="main-card mb-3 card">
                    <div class="card-header">
                        Aprobacion de Accesos
                    </div>
                    @*<div class="card-body" style="text-align:center">
                        <button id="btnAprobar" onclick="detalleUsuario()" class="mb-4 mr-4 btn btn-gradient-success" data-toggle="modal" data-target="#miModal">Aprobar</button>

                        <button id="btnRechazar" onclick="detalleUsuario()" class="mb-4 mr-4 btn btn-gradient-danger" data-toggle="modal" data-target="#miModal">Rechazar</button>

                        <button id="btnMasInformacion" onclick="detalleUsuario()" class="mb-4 mr-4 btn btn-gradient-warning" data-toggle="modal" data-target="#miModal">Más Información</button>

                    </div>*@


                    @if (ViewBag.IdRazon == 12 && ViewBag.ID_QUEU == 108)
                    {
                    <div class="card-body d-flex justify-content-center">
                        <button id="btnAprobarAcceso" onclick="aprobarAcceso()" class="btn btn-success mr-4" data-toggle="modal" data-target="#miModal">Aprobar</button>

                        <button id="btnRechazarAcceso" onclick="rechazarAcceso()" class="btn btn-danger mx-4" data-toggle="modal" data-target="#miModal">Rechazar</button>

                        <button id="btnMasInformacionAcceso" onclick="masInformacionAcceso()" class="btn btn-warning  ml-4" data-toggle="modal" data-target="#miModal">Más Información</button>
                    </div>

                    }

                    @if (ViewBag.IdRazon == 13)
                    {
                    <div class="card-body d-flex justify-content-center">
                        <button id="btnAprobarAccesoGTI" onclick="aprobarAccesoGTI()" class="btn btn-success mr-4" data-toggle="modal" data-target="#miModal">Solicitar Aprobación  GTI</button>

                    </div>

                    }

                    @if (ViewBag.IdRazon == 14)
                    {
                    <div class="card-body d-flex justify-content-center">
                        <button id="btnCrearTicketRemediacionHost" onclick="crearTicketRemediacionHost()" class="btn btn-warning mr-4" data-toggle="modal" data-target="#miModal">Solicitar Remediación de Host</button>

                    </div>

                    }

                </div>

            </div>
        </div>
        }

        <div class="form-row">
            <div class="col-md-12">
                <div class="main-card mb-3 card">
                    <div class="card-header">
                        Lecciones Aprendidas
                    </div>
                    <div class="card-body">
                        <div style="right:auto" class="col-md-12">
                            <div class="x_panel">
                                <div class="x_content lecciones">
                                    <ul class='list-unstyled msg_list' style='overflow-x: hidden; overflow-y: scroll;'></ul>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @if (ViewBag.ID_ACCO != 60)
        {
        <div class="form-row">
            <div class="col-md-12">
                <div class="main-card mb-3 card">
                    <div class="card-header">
                        Tickets Vinculados
                    </div>
                    <div class="card-body">
                        <div>
                            <div class="x_panel">
                                <div class="x_content tickets">
                                    <ul class="list-unstyled msg_list" style="overflow-x: hidden; overflow-y: scroll;"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        }
        <div class="form-row">
            <div class="col-md-12">
                <div class="main-card mb-3 card">
                    <div class="card-header">
                        Opciones
                    </div>
                    <div class="card-body" style="text-align:center">

                        @if ((Convert.ToInt32(Session["OPERACIONES"]) == 1 || Convert.ToInt32(Session["SERVICEDESK"]) == 1 || Convert.ToInt32(Session["SUPERVISOR_SERVICEDESK"]) == 1 || Convert.ToInt32(Session["SUPERVISOR_OPERACIONES"]) == 1) && ViewBag.TieneSoporte == 1)
                        {
                        <button id="btnVerSoporte" onclick="verSoporteED()" class="mb-2 mr-2 btn btn-gradient-info" data-toggle="modal" data-target="#miModal">Ver Vigencia  </button>
                        }
                        <button id="btnTraza" onclick="detalleUsuario()" class="mb-2 mr-2 btn btn-gradient-info" data-toggle="modal" data-target="#miModal">Detalle Usuario</button>


                        @if (Convert.ToInt32(Session["ID_ACCO"].ToString()) == 56 || Convert.ToInt32(Session["ID_ACCO"].ToString()) == 57 || Convert.ToInt32(Session["ID_ACCO"].ToString()) == 58 || Convert.ToInt32(Session["ID_ACCO"].ToString()) == 1 || Convert.ToInt32(Session["ID_ACCO"].ToString()) == 25)
                        {
                        <button id="btnTktPadreHijo" onclick="detalleTicketPadreHijo()" class="mb-2 mr-2 btn btn-gradient-info" data-toggle="modal" data-target="#miModal">Ticket Padre-Hijo</button>
                        }


                    </div>
                </div>
            </div>
        </div>
        <div class="form-row">
            <div class="col-md-12">
                <div class="main-card mb-3 card">
                    <div class="card-header">
                        Adjuntar
                    </div>
                    <div class="card-body">
                        <div id="divAttachFiles" style="padding:5px;height:185px;border:none;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-row">
            <div class="col-md-12">
                <div class="main-card mb-3 card">
                    <div class="card-header">
                        Actividades
                    </div>
                    <div class="card-body">
                        <div id="divActivities">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
<div id="divContent">
    <div style="float:left; width:60%;">

        <div class="bodyForm">

        </div>
    </div>

    @*<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="myModalLabel">Adjuntar Archivos</h4>
                </div>
                <div class="modal-body">
                    <div class="editor-label">
                        Type Document
                    </div>
                    <div class="editor-field">
                        @Html.TextBox("ArrayFile")
                    </div>
                    <br />
                    <input name="files" id="files" type="file" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="k-button" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>*@

    <div class="modal fade" id="EditCommentModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Cerrar</span></button>
                    <h4 class="modal-title" id="myModalLabel">Editar Descripción</h4>
                </div>
                <div id="divFrmLoadSummary">

                </div>

            </div>
        </div>
    </div>
    <div class="modal fade" id="modalGenerarCambio" role="dialog" aria-labelledby="modalGenerarCambioLabel" aria-hidden="true">
        <div class="modal-dialog" id="tamGestionCambio">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" id="cerrarAsig"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="modalGenerarCambioLabel">Gestión de Cambios</h4>
                </div>
                <div class="modal-body">
                    <div id="divGenerarCambio"></div>
                    <!-- CONTENIDO -->
                </div>
            </div>
        </div>
    </div>


</div>
<div class="modal fade" id="modalSoporteED" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" id="tamVerSoporte">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" IdRazon class="close" data-dismiss="modal" data-backdrop="false" id="cerrarAsig"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel"> <span id="tituloOP"></span></h4>
            </div>
            <div class="modal-body">
                <div id="divSoporteED"></div>
                <!-- CONTENIDO -->
            </div>
        </div>
    </div>
</div>
<script type="text/x-kendo-tmpl" id="templdu">
    <div class="du12">
        <div class="duCont">
            <div class="duContdet" style="text-transform:capitalize;margin:0px 5px 3px 5px;color:black;">
                Fotocheck: ${FOT_CLIE}<br>
                Usuario: ${NAM_CLIE}<br>
                <div style="float:left;padding:0px 5px 0px 0px">Tipo Usuario: </div><div style="color:${COLOR};"> ${USE_TYPE}</div>
                Cargo: ${JOB_TITL}<br>
                Area: ${ARE_CLIE}<br>
                Gestión: ${MANA}<br>
                Compañía: ${CIA}<br>
                Anexo: ${EXT}<br>
                Celular: ${CEL_CLIE}<br>
                RPM: ${RPM_CLIE}
            </div>
            <div class="duContFot">
            </div>
        </div>
    </div>
</script>

<script id="templateDownload" type="text/x-kendo-template">
    <tr data-uid="#= uid #">
        <td colspan="2">
            <a href="../../Adjuntos/#: NAM_ATTA #" target="_BLANK">#: NAM_ATTA #</a>
        </td>
        <td colspan="2">
            <strong>#: NAM_TYPE_DOCU_ATTA #</strong>
        </td>
    </tr>
</script>

<script>
    $(document).ready(function () {
        

        function toggleImpactoServicioVisibility() {
            var estadoValue = $('#ID_STAT').val(); // Obtener el valor actual del campo Estado
            // Mostrar el campo de Impacto del Servicio si el estado es igual a 4, ocultarlo en otro caso
            if (estadoValue == '4') {
                $('#impactoServicioContainer').show(); // Mostrar el contenedor
            } else {
                $('#impactoServicioContainer').hide(); // Ocultar el contenedor
            }
        }

        // Llamar a la función al cargar la página para inicializar el estado del campo
        toggleImpactoServicioVisibility();

        // Llamar a la función cada vez que cambie el valor del campo Estado
        $('#ID_STAT').change(function () {
            toggleImpactoServicioVisibility();
        });

        $("#ImpactoServicio").kendoComboBox({

            autoBind: true,

            dataTextField: "text",

            dataValueField: "value",

            dataSource: [

                { text: "Seleccionar", value: "" },

                { text: "Si", value: "Si" },

                { text: "No", value: "No" }

            ],

            value: "@ViewBag.Impacto"

        }).data("kendoComboBox");

    });

</script>


<script type="text/javascript">
    var tareasTemp = [];
    var areaResponsableData = [];

    if (@Session["ID_ACCO"] == 60)
    {
        ValidarFechaReal();

    }

    $("#tabActividad").click(function () {
        LimpiarValores();
        $("#tabActividad").addClass("active");
        $("#tabActividadProgramar").removeClass("active");
        $("#tabCambiarEstado").removeClass("active");
        $("#tabTransferir").removeClass("active");

        //$("#DivCausa").attr("hidden", true);
        $("#DivCausa").removeAttr("hidden");
        $("#DivFechaProgramada").attr("hidden", true);
        $("#DivEsperaCliente").attr("hidden", true);
        $("#DivEstado").attr("hidden", true);
        $("#DivArea").attr("hidden", true);
        $("#DivAsignado").attr("hidden", true);
        $("#DivFechaFinReal").attr("hidden", true);
        $("#DivControlRemoto").attr("hidden", true);
        $("#divMotivoEspera").attr("hidden", true);
        $("#divMotivoEsperaProgra").attr("hidden", true);
        $("#ID_TYPE_DETA_TICK").val(1);
        $("#FEC_END_REAL").val('');
        if (@ViewBag.TicketProyecto == 1) {
        $("#subcategorizacionPry").attr("hidden", false);
        $("#divCtrlRemot").attr("hidden", false);
    } else {
        $("#subcategorizacionPry").attr("hidden", true);
        $("#divCtrlRemot").attr("hidden", true);
    }
    $("#divTipoResolucion").attr("hidden", true);
    $("#divRazon").attr("hidden", true);
                });

    $("#tabActividadProgramar").click(function () {
        LimpiarValores();
        $("#tabActividad").removeClass("active");
        $("#tabActividadProgramar").addClass("active");
        $("#tabCambiarEstado").removeClass("active");
        $("#tabTransferir").removeClass("active");

        $("#DivCausa").attr("hidden", true);
        $("#DivFechaProgramada").removeAttr("hidden");
        $("#DivEsperaCliente").removeAttr("hidden");
        $("#divMotivoEspera").attr("hidden", true);
        $("#DivEstado").attr("hidden", true);
        $("#DivArea").attr("hidden", true);
        $("#DivAsignado").attr("hidden", true);
        $("#DivFechaFinReal").attr("hidden", true);
        $("#DivControlRemoto").attr("hidden", true);
        $("#ID_TYPE_DETA_TICK").val(3);
        $("#ID_STAT").val(5);
        $("#subcategorizacionPry").attr("hidden", true);
        $("#divCtrlRemot").attr("hidden", true);
        $("#divTipoResolucion").attr("hidden", true);
        $("#divRazon").attr("hidden", true);
        if (![56, 57, 58, 60].includes(parseInt(@Session["ID_ACCO"]))) {
        $("#divMotivoEsperaProgra").removeAttr("hidden");
    }
                });

    $("#tabCambiarEstado").click(function () {
        LimpiarValores();
        $("#tabActividad").removeClass("active");
        $("#tabActividadProgramar").removeClass("active");
        $("#tabCambiarEstado").addClass("active");
        $("#tabTransferir").removeClass("active");


        $("#DivCausa").attr("hidden", true);
        $("#DivFechaProgramada").attr("hidden", true);
        $("#DivEsperaCliente").attr("hidden", true);
        $("#DivEstado").removeAttr("hidden");
        $("#DivArea").attr("hidden", true);
        $("#DivAsignado").attr("hidden", true);
        $("#divMotivoEspera").attr("hidden", true);
        $("#divMotivoEsperaProgra").attr("hidden", true);
        $("#DivFechaFinReal").attr("hidden", true);
        $("#DivControlRemoto").attr("hidden", true);
        $("#divBolsaHoras").attr("hidden", true);
        $("#ID_TYPE_DETA_TICK").val(3);
        // if (@Session["ID_ACCO"] == 60) {
        //     $("#ID_STAT").data("kendoDropDownList").value(0);
        // } else {
        //     $("#ID_STAT").data("kendoComboBox").value("");
        // }

        $("#subcategorizacionPry").attr("hidden", true);
        $("#divCtrlRemot").attr("hidden", true);
        $("#ID_STAT").on('change', function (e) {
            $("#divMotivoEspera").attr("hidden", true);
            var cbEstado = $("#ID_STAT").val();
            console.log(cbEstado);
            if (cbEstado == 2 || cbEstado == 1) {
                $("#DivFechaProgramada").attr("hidden", true);
                $("#DivControlRemoto").attr("hidden", true);
                $("#DivEsperaCliente").removeAttr("hidden");
                $("#DivFechaFinReal").attr("hidden", true);
                $("#divBolsaHoras").attr("hidden", true);
                $("#divTipoResolucion").attr("hidden", true);
            }
            else if (cbEstado == 5) {
                $("#DivFechaProgramada").removeAttr("hidden");
                $("#DivEsperaCliente").removeAttr("hidden");
                $("#DivControlRemoto").attr("hidden", true);
                $("#divBolsaHoras").attr("hidden", true);
                $("#DivFechaFinReal").attr("hidden", true);
                $("#divTipoResolucion").attr("hidden", true);

                if (![56, 57, 58, 60].includes(parseInt(@Session["ID_ACCO"]))) {
        $("#divMotivoEspera").removeAttr("hidden");
    }
                        }
                        else if (cbEstado == 4) {
                            $("#DivFechaProgramada").attr("hidden", true);
                            $("#DivControlRemoto").removeAttr("hidden");
                            $("#DivEsperaCliente").removeAttr("hidden");
                            $("#DivFechaFinReal").removeAttr("hidden");
                            $("#divTipoResolucion").attr("hidden", false);
                            if (@ViewBag.ID_ACCO == 4) {
                                $("#divBolsaHoras").removeAttr("hidden");
                                ObtenerBolsaHoras(@ViewBag.ID_TICK);
                            }
                        } else {
                            $("#DivFechaProgramada").attr("hidden", true);
                            $("#DivControlRemoto").attr("hidden", true);
                            $("#DivFechaFinReal").attr("hidden", true);
                            $("#DivFechaFinReal").attr("hidden", true);
                            $("#DivEsperaCliente").attr("hidden", true);
                            $("#divTipoResolucion").attr("hidden", true);
                            $("#divBolsaHoras").attr("hidden", true);
                        }

        });
    $("#divRazon").removeAttr("hidden");
    });

    $("#tabTransferir").click(function () {
        LimpiarValores();
        $("#tabActividad").removeClass("active");
        $("#tabActividadProgramar").removeClass("active");
        $("#tabCambiarEstado").removeClass("active");
        $("#tabTransferir").addClass("active");

        $("#DivArea").removeAttr("hidden");
        $("#DivAsignado").removeAttr("hidden");
        $("#DivCausa").attr("hidden", true);
        $("#DivFechaProgramada").attr("hidden", true);
        $("#DivEsperaCliente").attr("hidden", true);
        $("#DivEstado").attr("hidden", true);
        $("#DivFechaFinReal").attr("hidden", true);
        $("#DivControlRemoto").attr("hidden", true);
        $("#divMotivoEspera").attr("hidden", true);
        $("#divMotivoEsperaProgra").attr("hidden", true);

                    $("#ID_TYPE_DETA_TICK").val(2);
                    $("#subcategorizacionPry").attr("hidden", true);
                    $("#divCtrlRemot").attr("hidden", true);
                    $("#divTipoResolucion").attr("hidden", true);
                    $("#divRazon").attr("hidden", true);
    });

    // bolsa de horas
    function ObtenerBolsaHoras(id) {
        $("#divBolsaHoras").empty();

        $.ajax({
            url: "/SoporteED/ObtenerDetalleBolsaHoras/",
            data: "&IdTick=" + id,
            cache: false,
            type: "GET",
            dataType: "json",
            success: function (data) {
                strPrioridad = '';
                $.each(data['Data'], function (index) {

                    if ((data['Data'][index]) == 'SI') {
                        strPrioridad =

                            '<div class="form-group">' +
                            '<br/><br/>' +
                            '<div class="form-row col-md-12">' +
                            '<div class="col-md-7">' +
                            '<label> ¿Efectivo para consumo de horas?:</label>' +
                            '</div>' +
                            '<div class="col-md-1">' +
                            '<input id="AplicaConsumoHoras" name="AplicaConsumoHoras" type="checkbox" />' +
                            '</div>' +
                            '<div class="col-md-4" id="minutosEfectivosContainer" style="visibility:hidden;">' +
                            '<input type="number" id="MinutosEfectivos" name="MinutosEfectivos" style="width:60%"/> Min' +
                            '</div>' +
                            '</div>' +
                            '</div>';
                    }

                });

                $("#divBolsaHoras").append(strPrioridad);

                // Agrega el evento change al checkbox
                $("#AplicaConsumoHoras").change(function () {
                    if ($(this).is(":checked")) {
                        $("#minutosEfectivosContainer").css("visibility", "visible");
                    } else {
                        $("#minutosEfectivosContainer").css("visibility", "hidden");
                    }
                });
            }
        });
    }

    function LimpiarValores() {
        if (@Session["ID_ACCO"] == 60) {
            $("#ID_STAT").data("kendoDropDownList").value(0);
        } else {
            $("#ID_STAT").data("kendoComboBox").value("");
        }

        $("#Causa").iCheck("uncheck");
        $("#FEC_SCHE").data("kendoDateTimePicker").value("");
        $("#EsperaPorCliente").iCheck("uncheck");
        $("#ID_QUEU").data("kendoComboBox").value("");
        $("#ID_PERS_ENTI").data("kendoComboBox").value("");
        $("#IdMotivoEstado").data("kendoComboBox").value("");
        $("#IdMotivoEstadoProgra").data("kendoComboBox").value("");
    }

    function a_entero(valor) {
        //intento convertir a entero.
        //si era un entero no le afecta, si no lo era lo intenta convertir
        valor = parseInt(valor);
        //comprobamos si es un valor entero
        if (isNaN(valor)) {
            //no es entero 0
            return 0;
        } else {
            //es un valor entero
            return valor;
        }
    }

    function closeWinModalPopUpLoad(sw) {

        $("#dlgl").hide('200', "swing", function () {
            $("#bkgl").fadeOut("300");
        });
    }

    function winPopUpModalLoad(title, contHtml, ancho, alto) {

        var altobkg = 0;
        var top = 0;
        altpan = $(window).height(); // devuelve la altura del viewport del navegador
        altobkg = $(document).height(); // devuelve la altura del documento HTML
        altbar = $(window).scrollTop(); // devuelve la posición vertical actual de la barra de scroll
        top = altbar + (altpan / 2);
        $("#winPopUpModalLoad").prepend("<div id='bkgl' class='backgroundcad' style='z-index: 998; display: visibility; height: " + altobkg + "px;'>" +
            "<div id='dlgl' class='modalcad' style='z-index: 998; display: none; top: " + a_entero(top) + "px; width: " + a_entero(ancho) + "px; margin-left: -" + a_entero(ancho) / 2 + "px; height: " + a_entero(alto) + "px; margin-top: -" + a_entero(alto) / 2 + "px;'>" +
            "<div id='titulomodall' class='titlemodalcad'>" +
            "</div><div id='contenidomodall' class='contenidomodalcad'></div>" +
            "<div class='divLoading'></div>" +
            "</div></div>");

        if ($('#bkgl').css("visibility") == 'hidden') {
            document.getElementById('bkgl').style.visibility = '';
            $("#bkgl").hide();
        }
        if ($('#bkgl').css("visibility") == 'hidden') {
            document.getElementById('dlgl').style.visibility = '';
            $("#dlgl").hide();
        }
        $("#bkgl").fadeIn(300, "linear", function () {
            $("#dlgl").show(200, "swing");
            $("#titulomodall").prepend(title)
            $("#contenidomodall").prepend('<div style="text-align:justify">' + contHtml + '</div>')
        });
        $("#closebtnmodall").click(function () {
            $("#dlgl").hide('200', "swing", function () {
                $("#bkgl").fadeOut("300");
            });
        });
    }
    /*################################################################## GCR161203 #######################################################################################*/

    function aprobarAcceso() {

        var idTick = @ViewBag.ID_TICK;
        $("#lblTitulo").text("Aprobar Acceso");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-lg");

        $('#modal-content').empty();
        $('#modal-content').load("/Ticket/viewAprobarAcceso?id=" + idTick + "&var=" + Math.random());
    }
    function rechazarAcceso() {

        var idTick = @ViewBag.ID_TICK;
        $("#lblTitulo").text("Rechazar Acceso");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-lg");

        $('#modal-content').empty();
        $('#modal-content').load("/Ticket/viewRechazarAcceso?id=" + idTick + "&var=" + Math.random());
    }
    function masInformacionAcceso() {

        var idTick = @ViewBag.ID_TICK;
        $("#lblTitulo").text("Solicitar Más Información Sobre el Acceso");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-lg");

        $('#modal-content').empty();
        $('#modal-content').load("/Ticket/viewMasInformacionAcceso?id=" + idTick + "&var=" + Math.random());
    }

    function crearTicketRemediacionHost() {

        var idTick = @ViewBag.ID_TICK;
        $("#lblTitulo").text("Solicitar Remediación de Host");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-lg");

        $('#modal-content').empty();
        $('#modal-content').load("/Ticket/viewGenerarTicketRemediacionHostBuenaventura?id=" + idTick + "&var=" + Math.random());
    }

    function aprobarAccesoGTI() {

        var idTick = @ViewBag.ID_TICK;
        $("#lblTitulo").text("Solicitar Aprobación de GTI");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-lg");

        $('#modal-content').empty();
        $('#modal-content').load("/Ticket/viewAprobarAccesoGTI?id=" + idTick + "&var=" + Math.random());
    }


    //function crearTicketRemediacion() {
    //    var formData = new FormData();

    //    fetch('/TuControlador/Create', {
    //        method: 'POST',
    //        body: formData
    //    })
    //        .then(response => response.text())
    //        .then(data => {
    //            console.log(data);
    //        })
    //        .catch(error => {
    //            console.error('Error:', error);
    //        });
    //}

    function detalleUsuario() {

        var idUsuario = $("#idUsuario").val();
        $("#lblTitulo").text("Detalle de Usuario");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-lg");

        $('#modal-content').empty();
        $('#modal-content').load("/Ticket/viewDetalleUsuario?id=" + idUsuario + "&var=" + Math.random());

        //var htmlForm = '<div id="FormDetalleUsuario"></div>';
        //winFormPopUpModal("Detalle de Usuario", htmlForm, 850, 600);
        //$("#FormDetalleUsuario").load("/Ticket/viewDetalleUsuario?id=" + idUsuario + "&var=" + Math.random());
    }
    function detalleTicketPadreHijo() {
        $("#lblTitulo").text("Ticket Padre-Hijo");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-lg");

        $('#modal-content').empty();
        $('#modal-content').load("/Ticket/verTicketPadreHijo?id=" + @ViewBag.ID_TICK + "&var=" + Math.random());

        @*var htmlForm = '<div id="FormDetalleTicketPadreHijo"></div>';
        winFormPopUpModal("Ticket Padre-Hijo", htmlForm, 580, 320);
        $("#FormDetalleTicketPadreHijo").load("/Ticket/verTicketPadreHijo?id=" + @ViewBag.ID_TICK + "&var=" + Math.random());*@
    }
    /*################################################################## GCR161203 #######################################################################################*/
    function verSoporteED() {
        $("#lblTitulo").text("Lista de Soportes");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-lg");

        $('#modal-content').empty();
        $('#modal-content').load("/SoporteED/ListaSoportes/@ViewBag.IdDocuSale");

        @* $("#divSoporteED").empty();
        $("#divSoporteED").load("/SoporteED/ListaSoportes/@ViewBag.IdDocuSale");
        $('#tituloOP').text('Lista de Soportes');*@
    }
    var i_conf = 0;
    //
    $(document).ready(function () {
        //  var messg = "";
        //var mssgCR = "";modalEditCat
         $("#submitDetail").on("click", function () {
            if ((@Session["ID_ACCO"] == 56 || @Session["ID_ACCO"] == 57 || @Session["ID_ACCO"] == 58) && $("#ID_TYPE_DETA_TICK").val() == 3 && $("#ID_STAT").val() == 4) {
                if (@ViewBag.TieneTarea == 1) {
                    if (tareasTemp.some(tarea => tarea.IdEstado != 4 && tarea.IdEstado != 5 && tarea.IdEstado != 7 && tarea.IdEstado != 8 && tarea.IdEstado != 9 && tarea.IdEstado != 10 && tarea.IdEstado != null)) {
                        swal({
                            title: "No se puede resolver este ticket",
                            text: "¡Este ticket aún tiene tareas pendientes!",
                            type: "warning",
                            confirmButtonColor: "#DD6B55",
                            confirmButtonText: "Aceptar",
                            closeOnConfirm: false
                        });
                    } else {
                        $("#submit").click();
                    }
                } else {
                    if (tareasTemp.some(tarea => tarea.Estado != 1 && tarea.Estado != 2 && tarea.Estado != null)) {
                        swal({
                            title: "No se puede resolver este ticket",
                            text: "¡Este ticket aún tiene tareas pendientes!",
                            type: "warning",
                            confirmButtonColor: "#DD6B55",
                            confirmButtonText: "Aceptar",
                            closeOnConfirm: false
                        });
                    } else {
                        $("#submit").click();
                    }
                }
            } else {
                $("#submit").click();
            }
        });
    if (@ViewBag.TicketProyecto == 1) {
        $("#subcategorizacionPry").attr("hidden", false);
        $("#divCtrlRemot").attr("hidden", false);
    } else {
        $("#subcategorizacionPry").attr("hidden", true);
        $("#divCtrlRemot").attr("hidden", true);
    }
    if (@ViewBag.AplicaCambio== 1) {
        var flag = 0;
        $("#btnEntregaActivo").click(function () {
            window.open("/DeliveryReception/Create/@ViewBag.ID_TICK", "_blank");
            //   messg = "Mostrar botón Entrega Activo";
        });
        if (((@ViewBag.Estado == 1 || @ViewBag.Estado == 3 || @ViewBag.Estado == 5 ) && @ViewBag.AplicaGestionActivo == 0) || @ViewBag.Estado == 2 || @ViewBag.Estado == 4 || @ViewBag.Estado == 6 ) {
            $("#btnEntregaActivo").hide();


        }
        if ( @ViewBag.Estado == 2 || @ViewBag.Estado == 4  ) {
            $("#ListaTarea").hide();
            $("#MensajeTarea").text("No se encontraron tareas pendientes.")

        }
        if ((@ViewBag.Estado == 2 || @ViewBag.Estado == 4) && (@ViewBag.ID_CATE_MINSUR == 27158 || @ViewBag.ID_CATE_MINSUR == 28529 || @ViewBag.ID_CATE_MINSUR == 29900 || @ViewBag.ID_CATE_MINSUR == 32465 || @ViewBag.ID_CATE_MINSUR == 32466)) {
            $("#btnImportarTMovil").hide();
        }
        if ( @ViewBag.Estado== 4 ||  @ViewBag.Estado== 6 ||  @ViewBag.IdCambio!= 0) {
            $("#btnGestionDeCambio").hide();
            flag = 1;
            //  mssgCR = "btnGestionDeCambio 1 - Ocultar";
        }

        if (@ViewBag.IdCambio== 0) {
            $("#btnIrCambio").hide();
            flag = flag + 1;
        }
        if (flag == 2) {
            $("#MensajeCambio").text("No se encontró una solicitud de cambios.")

        }
    }else {
        $("#btnGestionDeCambio").hide();
        $("#btnIrCambio").hide();
        $("#MensajeCambio").text("La solicitud del cambio solo aplica a los tickets de tipo incidente o requerimiento.");
        //mssgCR = "btnGestionDeCambio 2 - Ocultar";

    }

    if (@ViewBag.ExisteCambio == 0) {
        $("#linkUS").show();
        $("#btnIrCambio").hide();
    }
        else {
        $("#linkUS").hide();
        $("#btnIrCambio").show();
        //$("#btnEntregaActivo").hide();
        //MARCA -------------------------------------------------------------------------------------
        $("#btnGestionDeCambio").hide();
        // mssgCR = "btnGestionDeCambio 3 - Ocultar";

    }
    if (@ViewBag.ExisteCambioInc == 1) {
        $("#linkUS").hide();
        $("#btnIrCambio").show();
        //$("#btnEntregaActivo").hide();
        $("#btnGestionDeCambio").hide();
        // mssgCR = "btnGestionDeCambio 4 - Ocultar";

    }

    if (((@ViewBag.Estado == 1 || @ViewBag.Estado == 3 || @ViewBag.Estado == 5 ) && @ViewBag.AplicaGestionActivo == 0) || @ViewBag.Estado == 2 || @ViewBag.Estado == 4 || @ViewBag.Estado == 6 ) {
        $("#btnEntregaActivo").hide();
    }else {
        $("#btnGestionDeCambio").hide();
        // mssgCR = "btnGestionDeCambio 5 - Ocultar";

    }

    var IdMotivoEstado = $("#IdMotivoEstado").kendoComboBox({
        dataTextField: "NombreMotivo",
        dataValueField: "Id",
        cascadeFrom: 'ID_STAT',
        filter: "contains",
        autoBind: false,
        dataSource: {
            serverFiltering: true,
            schema: {
                data: "Data",
                total: "Count"
            },
            transport: {
                read: "/Ticket/ListaMotivoEspera?var=" + Math.random()
            }
        }
    }).data("kendoComboBox");

    var IdMotivoEstadoProgra = $("#IdMotivoEstadoProgra").kendoComboBox({
        dataTextField: "NombreMotivo",
        dataValueField: "Id",
        filter: "contains",
        autoBind: true,
        dataSource: {
            schema: {
                data: "Data",
                total: "Count"
            },
            transport: {
                read: "/Ticket/ListaMotivoEspera/1?var=" + Math.random()
            }
        }
    }).data("kendoComboBox");

    $("#ID_TYPE_DETA_TICK").val(1);

    $("#AMM_SALE_OPP").kendoNumericTextBox({
        min: 0,
        step: 1
    });

    $("#PRO_SALE_OPP").kendoNumericTextBox({
        min: 0,
        step: 1,
        max: 100
    });

    $("#submit").click(function () {
        winPopUpModalLoad('Guardando Ticket', 'Espere por favor', 300, 130);

    });

    showDetailsIncident();

    @* $.ajax({
        url: "/DetailsTicket/ListByIdTick/" + "@ViewBag.ID_TICK",
        data: "var=" + Math.random(),
        type: "GET",
        dataType: "json",
        success: function (source) {

            data1 = source;
            showDetailsIncident();
        },
        error: function (source) {
        }
    });*@

    //ProgressBar Buenaventura
    if (@Session["ID_ACCO"] == 60) {
        $.ajax({
            url: "/DetailsTicket/ObtenerProgresoSLA/" + "@ViewBag.ID_TICK",
            data: "var=" + Math.random(),
            type: "GET",
            dataType: "json",
            success: function (response) {
                let progreso = response;
                $("#progressSLATicket").removeAttr('hidden');
                $("#progressSLATicket").attr('style', `width:${progreso}%;`);
                $("#progressSLATicket").html(`${progreso}%`);

                if (progreso < 25)
                    $("#progressSLATicket").addClass('bg-success');
                else if (progreso < 50)
                    $("#progressSLATicket").addClass('bg-primary');
                else if (progreso < 75)
                    $("#progressSLATicket").addClass('bg-warning');
                else
                    $("#progressSLATicket").addClass('bg-danger');
            },
            error: function (source) {
            }
        });

        $.ajax({
            contentType: 'application/json; charset=utf-8',
            url: "/Tarea/ListarTareasPorTicketBNV",
            type: "GET",
            data: { idTicket: idTicket },
            datatype: "JSON",
            cache: false,
            success: function (data) {
                if (data.Data) tejerTareasCreadasBNV(data.Data);
            },
            error: function () {
            }
        });
    }

      //  mssgCR;
       // messg;
    });

    if ([56, 57, 58].includes(@Session["ID_ACCO"]) && @ViewBag.CategoriaConTareas == 1) {
        $.ajax({
            url: "/AccountQueue/ListByAcco?var=" + Math.random(),
            type: "GET",
            success: function (data) {
                areaResponsableData = data.Data;
            },
            error: function () {
            }
        });
    }

    var key_atta = $("#KEY_ATTA").val()

    function AdjuntarComentario() {
        $("#lblTitulo").text("Adjuntar Documentos");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-lg");

        $('#modal-content').empty();
        $('#modal-content').load('/DetailsTicket/AdjuntarArchivosComentario/?KEY_ATTA=' + key_atta);
    }

    function tejerTareasCreadasBNV(tareaPendiente) {
        if (parseInt(tareaPendiente.length) > 0) {
            $.each(tareaPendiente, function (index, value) {
                var puedeModificar = parseInt(@Session["ID_PERS_ENTI"]) == tareaPendiente[index].IdUsuario || parseInt(@Session["ID_QUEU"]) == 100 || parseInt(@Session["ID_PERS_ENTI"]) == 1007;

                if (tareaPendiente[index].Estado == 1) {
                    $(".ticketHijoIndexBNV ul").append('<li class="list-group-item"><div class="todo-indicator bg-success"></div>' +
                        '<div class="row"><div class="col-md-12 titulo"><span style="text-transform: capitalice;font-size:12px; color:black;"><b>' + tareaPendiente[index].CodigoTarea + '</b></span></div></div>' +
                        '<div class="row"><div class="col-md-3 titulo">'
                        + '<span style="text-transform: capitalice;font-size:12px; color:black;">' + tareaPendiente[index].Titulo + '</span></br>' + '<span style="text-transform: capitalice; font-size:10px;">' + tareaPendiente[index].Descripcion + '</span>' + '</div><div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;"><span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span> ' + tareaPendiente[index].AreaResponsable +
                        '</div><div class="col-md-3 titulo" style="text-transform:capitalize;font-size:10px; "> Realizado por: ' + tareaPendiente[index].Usuario +
                        '</div><div class="col-md-2">' + '<div class="badge badge-pill badge-success">Procede <i class="fa fa-check"></i ></div> ' +
                        '</div>' +
                        '</div>' +
                        '</li>');

                } else if (tareaPendiente[index].Estado == 2) {
                    $(".ticketHijoIndexBNV ul").append('<li class="list-group-item"><div class="todo-indicator bg-danger"></div>' +
                        '<div class="row"><div class="col-md-12 titulo"><span style="text-transform: capitalice;font-size:12px; color:black;"><b>' + tareaPendiente[index].CodigoTarea + '</b></span></div></div>' +
                        '<div class="row"><div class="col-md-3 titulo">'
                        + '<span style="text-transform: capitalice;font-size:12px; color:black;">' + tareaPendiente[index].Titulo + '</span></br>' + '<span style="text-transform: capitalice; font-size:10px;">' + tareaPendiente[index].Descripcion + '</span>' + '</div><div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;"><span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span> ' + tareaPendiente[index].AreaResponsable +
                        '</div><div class="col-md-3 titulo" style="text-transform:capitalize;font-size:10px; "> Realizado por: ' + tareaPendiente[index].Usuario +
                        '</div><div class="col-md-2">' + '<div class="badge badge-danger ml-2">No procede</div>' +
                        '</div>' +
                        '</div>' +
                        '</li>');
                }
                else if (tareaPendiente[index].Estado == 3 || tareaPendiente[index].Estado == 4) {
                    $(".ticketHijoIndexBNV ul").append(`
                        <li class="list-group-item">
                          <div class="todo-indicator bg-warning"></div>
                          <div class="row">
                            <div class="col-md-12 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">
                                <b>${tareaPendiente[index].CodigoTarea}</b>
                              </span>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-3 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">${tareaPendiente[index].Titulo}</span>
                              </br>
                              <span style="text-transform: capitalice; font-size:10px;">${tareaPendiente[index].Descripcion}</span>
                            </div>
                            <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}
                            </div>
                            <div class="col-md-6 titulo" style="text-transform:capitalize; font-size:12px;">
                              <div class="badge badge-pill badge-warning ml-auto">Pendiente</div>
                              </br>${tareaPendiente[index].Usuario} ${puedeModificar ? `<i onclick="TransferirUsuarioTarea(${tareaPendiente[index].IdTarea},${tareaPendiente[index].IdQueu})" style="cursor:pointer" class="fa fa-pen" data-toggle="modal" data-target="#miModal"></i>` : ''}
                            </div>
                            ${puedeModificar ?
                            `<div class="col-md-6"></div>
                            <div class="col-md-6 mt-2">
                              <button class="mb-2 mr-2 btn btn-primary"  onclick="ActualizarEstadoTareaBNV(${tareaPendiente[index].IdTarea}, 'En Proceso')" type="button" style="vertical-align: middle;">
                                En Proceso
                              </button>
                            </div>`
                            : ''}
                          </div>
                        </li>
                    `);

                }
                else if (tareaPendiente[index].Estado == 5) {
                    $(".ticketHijoIndexBNV ul").append(`
                        <li class="list-group-item">
                          <div class="todo-indicator bg-secondary"></div>
                          <div class="row">
                            <div class="col-md-12 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">
                                <b>${tareaPendiente[index].CodigoTarea}</b>
                              </span>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-3 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">${tareaPendiente[index].Titulo}</span>
                              </br>
                              <span style="text-transform: capitalice; font-size:10px;">${tareaPendiente[index].Descripcion}</span>
                            </div>
                            <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}
                            </div>
                            <div class="col-md-6 titulo" style="text-transform:capitalize; font-size:12px;">
                              <div class="badge badge-pill badge-secondary ml-auto">Sin Asignar</div>
                              </br>
                              <select
                                id_queue="${tareaPendiente[index].IdQueu}"
                                style="margin-left:-7%"
                                name="selectAsignar${tareaPendiente[index].IdTarea}"
                                class="mb-2 mr-2 dropdown-toggle btn btn-link">
                              </select>
                            </div>
                            <div class="col-md-6"></div>
                            <div class="col-md-3 ml-auto" style="margin-left:-10px;">
                              <button
                                class="mb-2 mr-2 btn btn-primary"
                                onclick="ActualizarEstadoTareaBNV(${tareaPendiente[index].IdTarea}, 'Asignar')"
                                type="button"
                                style="vertical-align: middle; float: right;">
                                    <i class="pe-7s-add-user" style="font-weight:900;"></i >
                                    Asignar
                              </button>
                            </div>
                          </div>
                        </li>
                      `);
                }
                else if (tareaPendiente[index].Estado == 6) {
                    $(".ticketHijoIndexBNV ul").append(`
                        <li class="list-group-item">
                          <div class="todo-indicator bg-warning"></div>
                          <div class="row">
                            <div class="col-md-12 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">
                                <b>${tareaPendiente[index].CodigoTarea}</b>
                              </span>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-3 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">${tareaPendiente[index].Titulo}</span>
                              </br>
                              <span style="text-transform: capitalice; font-size:10px;">${tareaPendiente[index].Descripcion}</span>
                            </div>
                            <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}
                            </div>
                            <div class="col-md-6 titulo" style="text-transform:capitalize; font-size:12px;">
                              <div class="badge badge-pill badge-info ml-auto">En Proceso</div>
                              </br>${tareaPendiente[index].Usuario} ${puedeModificar ? `<i onclick="TransferirUsuarioTarea(${tareaPendiente[index].IdTarea},${tareaPendiente[index].IdQueu})" style="cursor:pointer" class="fa fa-pen" data-toggle="modal" data-target="#miModal"></i>` : ''}
                            </div>
                            ${puedeModificar ?
                            `<div class="col-md-6" style="margin-left:-10px;">
                              <select id="select${tareaPendiente[index].IdTarea}" class="mb-2 mr-2 dropdown-toggle btn btn-link">
                                <option class="dropdown-item">Procede</option>
                                <option class="dropdown-item">No Procede</option>
                                <option class="dropdown-item">Programado</option>
                              </select>
                              <button id="btnActEstadoTarea_${tareaPendiente[index].IdTarea}" class="mb-2 ml-5 btn btn-light active" onclick="ActualizarEstadoTareaBNV(${tareaPendiente[index].IdTarea}, 'Resolver')" type="button" style="vertical-align: middle;">
                                <i class="pe-7s-diskette" style="font-weight:900;"></i>
                              </button>
                            </div>`
                            : ''}
                          </div>
                        </li>
                    `);

                }
                else if (tareaPendiente[index].Estado == 7) {
                    $(".ticketHijoIndexBNV ul").append(`
                        <li class="list-group-item">
                          <div class="todo-indicator bg-warning"></div>
                          <div class="row">
                            <div class="col-md-12 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">
                                <b>${tareaPendiente[index].CodigoTarea}</b>
                              </span>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-3 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">${tareaPendiente[index].Titulo}</span>
                              </br>
                              <span style="text-transform: capitalice; font-size:10px;">${tareaPendiente[index].Descripcion}</span>
                            </div>
                            <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}
                            </div>
                            <div class="col-md-6 titulo" style="text-transform:capitalize; font-size:12px;">
                              <div class="badge badge-pill badge-warning ml-auto">Programado</div>
                              </br>Fecha: ${tareaPendiente[index].FechaProgramado}
                              </br>${tareaPendiente[index].Usuario}
                            </div>
                            ${puedeModificar ?
                            `<div class="col-md-6" style="margin-left:-10px;">
                              <select id="select${tareaPendiente[index].IdTarea}" class="mb-2 mr-2 dropdown-toggle btn btn-link">
                                <option class="dropdown-item">En Proceso</option>
                                <option class="dropdown-item">Programado</option>
                              </select>
                              <button id="btnActEstadoTarea_${tareaPendiente[index].IdTarea}" class="mb-2 ml-5 btn btn-light active" onclick="ActualizarEstadoTareaBNV(${tareaPendiente[index].IdTarea}, 'Resolver')" type="button" style="vertical-align: middle;">
                                <i class="pe-7s-diskette" style="font-weight:900;"></i>
                              </button>
                            </div>`
                            : ''}
                          </div>
                        </li>
                    `);

                }
            });

            $('[name^="selectAsignar"]').each(function (index, el) {
                $.ajax({
                    contentType: 'application/json; charset=utf-8',
                    url: "/AccountEntity/AsignadoPorCola/",
                    data: { ID_QUEU: $(el).attr("id_queue"), VALOR: "" },
                    type: "Get",
                    datatype: "json",
                    cache: false,
                    success: function (data) {
                        $(el).append(
                            data.Data.reduce((acc, value) => acc + `<option value="${value.ID_PERS_ENTI}" class="dropdown-item">${value.ASSI}</option>`, "")
                        )
                    },
                    error: function () {
                        toastr.danger("Ocurrió un Error", "Advertencia")
                    }
                });
            });

        }
        else {
            $(".ticketHijoIndexBNV ul").append('<div class="smallField"> No se encontraron tareas pendientes');
        }
    }

    function ActualizarEstadoTareaBNV(idTarea, tipo) {
        if (tipo == "Asignar") {
            var usuario = $(`[name="selectAsignar${idTarea}"]`).find(':selected').val();

            swal({
                title: `¿Deseas asignar esta actividad?`,
                text: `Se asignará la actividad al usuario(a): ${$(`[name="selectAsignar${idTarea}"]`).find(':selected').text()}`,
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Guardar",
                cancelButtonText: "Cancel",
                closeOnConfirm: false,
                closeOnCancel: false
            }, function (dismiss) {
                if (dismiss) {
                    $.ajax({
                        url: '/Tarea/ActualizarEstadoTareaDetalleBNV',
                        data: JSON.stringify({
                            id: idTarea,
                            estado: 'Pendiente',
                            usuario
                        }),
                        type: "POST",
                        contentType: "application/json",
                        success: function (result) {
                            MensajeConfirmacionTareasBNV(result.message);
                        }
                    });

                }
                else {
                    swal("Cancelado", "Ha cancelado la asignación", "error");
                }

            });

        } else if (tipo == "En Proceso") {
            swal({
                title: `¿Deseas iniciar esta actividad?`,
                text: `Se dará inicio a la actividad seleccionada`,
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Guardar",
                cancelButtonText: "Cancel",
                closeOnConfirm: false,
                closeOnCancel: false
            }, function (dismiss) {
                if (dismiss) {
                    $.ajax({
                        url: '/Tarea/ActualizarEstadoTareaDetalleBNV',
                        data: JSON.stringify({
                            id: idTarea,
                            estado: 'En Proceso'
                        }),
                        type: "POST",
                        contentType: "application/json",
                        success: function (result) {
                            MensajeConfirmacionTareasBNV(result.message);
                        }
                    });

                }
                else {
                    swal("Cancelado", "Ha cancelado la operación", "error");
                }

            });

        } else if (tipo == "Resolver") {
            var estado = $('#select' + idTarea + '').val();

            if (estado == 'En Proceso') {
                $("#btnActEstadoTarea_" + idTarea).removeAttr("data-toggle");
                $("#btnActEstadoTarea_" + idTarea).removeAttr("data-target");

                swal({
                    title: `¿Deseas iniciar esta actividad?`,
                    text: `Se dará inicio a la actividad seleccionada`,
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "Guardar",
                    cancelButtonText: "Cancel",
                    closeOnConfirm: false,
                    closeOnCancel: false
                }, function (dismiss) {
                    if (dismiss) {
                        $.ajax({
                            url: '/Tarea/ActualizarEstadoTareaDetalleBNV',
                            data: JSON.stringify({
                                id: idTarea,
                                estado: 'En Proceso'
                            }),
                            type: "POST",
                            contentType: "application/json",
                            success: function (result) {
                                MensajeConfirmacionTareasBNV(result.message);
                            }
                        });

                    }
                    else {
                        swal("Cancelado", "Ha cancelado la operación", "error");
                    }

                });

            } else {
                $("#btnActEstadoTarea_" + idTarea).attr("data-toggle", "modal");
                $("#btnActEstadoTarea_" + idTarea).attr("data-target", "#miModal");

                $("#lblTitulo").text("Actualizar Estado");

                $(".modal-dialog").removeClass("modal-sm");
                $(".modal-dialog").removeClass("modal-md");
                $(".modal-dialog").removeClass("modal-lg");
                $(".modal-dialog").addClass("modal-md");

                $('#modal-content').empty();
                $('#modal-content').load("/Tarea/EstadoTareaBNV", { id: idTarea, estado });
            }
        }
    }

    function MensajeConfirmacionTareasBNV(msgResult) {
        if (msgResult == 'OK') {
            idSetTimeout = setTimeout(function (element) {
                $(".ticketHijoIndexBNV ul").html('');

                $.ajax({
                    contentType: 'application/json; charset=utf-8',
                    url: "/Tarea/ListarTareasPorTicketBNV",
                    type: "GET",
                    data: { idTicket: idTicket },
                    datatype: "JSON",
                    cache: false,
                    success: function (data) {
                        if (data.Data) tejerTareasCreadasBNV(data.Data);
                    },
                    error: function () {
                    }
                });

            }, 2000, $(this));

            swal({
                title: 'Guardando',
                type: 'success',
                text: 'Registro exitoso',
                confirmButtonColor: "#DD6B55",
                focusConfirm: false,
                confirmButtonText: 'Continue',
                confirmButtonAriaLabel: 'Thumbs up, great!'

            });

        } else if (msgResult == 'ERROR') {
            swal({
                title: 'Warning',
                type: 'info',
                text: 'ERROR EN EL REGISTRO',
                confirmButtonColor: "#DD6B55",
                focusConfirm: false,
                confirmButtonText: 'Continue',
                confirmButtonAriaLabel: 'Thumbs up, great!'
            });

        } else if (msgResult == 'REFRESH') {
            swal({
                title: 'Guardando',
                type: 'success',
                text: 'Registro exitoso',
                confirmButtonColor: "#DD6B55",
                focusConfirm: false,
                confirmButtonText: 'Continue',
                confirmButtonAriaLabel: 'Thumbs up, great!'
            }, function (confirm) {
                if (confirm) {
                    location.reload();
                }
            });

        }
    }


    /*################################################################## GCR161203 #######################################################################################*/

    var url = "/KnowledgeManagement/ListLeccionesAprendidasTickets";
    var idTicket = "@ViewBag.ID_TICK";
    /*Carga de las leccioens aprendidas y Tickets*/
    $.ajax({
        contentType: 'application/json; charset=utf-8',
        url: url,
        type: "Get",
        data: { idTicket: idTicket },
        datatype: "json",
        cache: false,
        /*  beforeSend: function () {
              swal({ title: "Procesando información, por favor espere.", text: "Detalle de Tickets", showConfirmButton: false, imageUrl: "/images/search_abs.gif" })
          },*/
        success: function (data) {
            if (data) {
                tejerLeccionesAprendidas(data["lecciones"], data["tickets"]);
                swal.close();
            }
        },
        error: function () {
            //Crear_Failed()
        }
    });
    /*################################################################## GCR161203 #######################################################################################*/


    var FEC_SCHE = $("#FEC_SCHE").kendoDateTimePicker({ change: startChange }).data("kendoDateTimePicker");

    var FEC_END_REAL = $("#FEC_END_REAL").kendoDateTimePicker({ value: today, change: startChange }).data("kendoDateTimePicker");

    //var FEC_SCHE = $("#FEC_SCHE").kendoDateTimePicker().data("kendoDateTimePicker");

    function addMins(theDate, min) {
        return new Date(theDate.getTime() + min * 60 * 1000);
    }

    var today = new Date();
    var newDate = addMins(new Date(), 1);
    //var today = kendo.date.today();

    var time_from = $("#FROM_TIME").kendoDateTimePicker({ value: today, change: startChange }).data("kendoDateTimePicker");
    var time_to = $("#TO_TIME").kendoDateTimePicker({ value: newDate, change: endChange }).data("kendoDateTimePicker");
    //var time_to = $("#TO_TIME").kendoDateTimePicker({ value: today, change: endChange }).data("kendoDateTimePicker");

    /*################################################################## GCR161203 #######################################################################################*/
    function tejerLeccionesAprendidas(lecciones, tickets) {
        tejerTicket(tickets);

        if (parseInt(lecciones.length) > 0) {
            $.each(lecciones, function (index, value) {
                $(".lecciones ul").append('<li><div class="row"><div class="col-md-6 titulo"><a target="_blank"  href="#/KnowledgeManagement/EditLessonLearned/' + lecciones[index].idLeccionAprendida + '"' + ' style="text-decoration:none;"><span class="glyphicon glyphicon-play" aria-hidden="true"></span>' +
                    '<span>' + lecciones[index].Titulo + '</span></a></div>' +
                    '<div class="col-md-6"><div class="stars stars-existing" style="float:right;" title="' + lecciones[index].Puntuacion + ' estrellas' + '"></div></div></div>' +
                    '<div class="row"> <div class="col-md-12">' +
                    ' <span style="display: inline-block; font-size: 11px;margin-left:14px; ">' + lecciones[index].Solucion + '</span></div></div><div class="rayaItms"></div></li>');
                var puntuacion = lecciones[index].Puntuacion;

                $('.stars-existing').starrr({
                    rating: puntuacion
                });
            });
        } else {
            $(".lecciones ul").append('<div class="smallField">No se encontraron Lecciones aprendidas vinculadas');
        }

        var idTicket = "@ViewBag.ID_TICK";
        let idCate = @ViewBag.ID_CATE_MINSUR;

        //Tareas Minsur
        if ([56, 57, 58].includes(@Session["ID_ACCO"])) {
            if (@ViewBag.TieneTarea == 1) {
                $.ajax({
                    contentType: 'application/json; charset=utf-8',
                    url: "/Ticket/ListarTareasMinsur",
                    type: "Get",
                    data: { idTicket: idTicket },
                    datatype: "json",
                    cache: false,
                    success: function (data) {
                        if (data) tejerTareasConfigurables(data);
                    },
                    error: function () {
                    }
                });

            } else if (@ViewBag.CategoriaConTareas == 1) {
                $.ajax({
                    contentType: 'application/json; charset=utf-8',
                    url: "/Tarea/ListarTareasPorTicket",
                    type: "GET",
                    data: { idTicket: idTicket },
                    datatype: "JSON",
                    cache: false,
                    success: function (data) {
                        if (data) tejerTareasCreadas(data);
                    },
                    error: function () {
                    }
                });

            } else {
                $.ajax({
                    contentType: 'application/json; charset=utf-8',
                    url: "/Ticket/ListarTareasPendientes",
                    type: "Get",
                    data: { idTicket: idTicket },
                    datatype: "json",
                    cache: false,
                    success: function (data) {

                        if (data) {
                            if ('@ViewBag.ID_CATE_MINSUR' == 27158 || '@ViewBag.ID_CATE_MINSUR' == 28529 || '@ViewBag.ID_CATE_MINSUR' == 29900) {
                                tejerTareasPendientesMovil(data["tareaPendiente"]);
                            }
                            else if ('@ViewBag.ID_CATE_MINSUR' == 32465 || '@ViewBag.ID_CATE_MINSUR' == 32466) {
                                tejerTareasPendientesContable(data["tareaPendiente"]);
                            }
                            else {
                                tejerTareasPendientes(data["tareaPendiente"]);
                            }

                            swal.close();
                        }
                    },
                    error: function () {
                        //t//Crear_Failed()
                    }
                });
            }
        }
    }

    function tejerTareasCreadas(tareaPendiente) {
        tareasTemp = tareaPendiente;

        if (parseInt(tareaPendiente.length) > 0) {
            $.each(tareaPendiente, function (index, value) {
                if (tareaPendiente[index].Estado == 1) {
                    $(".ticketHijoIndex ul").append('<li class="list-group-item"><div class="todo-indicator bg-success"></div>' +
                        '<div class="row"><div class="col-md-12 titulo"><span style="text-transform: capitalice;font-size:12px; color:black;"><b>' + tareaPendiente[index].CodigoTarea + '</b></span></div></div>' +
                        '<div class="row"><div class="col-md-3 titulo">'
                        + '<span style="text-transform: capitalice;font-size:12px; color:black;"><del>' + tareaPendiente[index].Titulo + '<del></span></br>' + '<span style="text-transform: capitalice; font-size:10px;"><del>' + tareaPendiente[index].Descripcion + '<del></span>' + '</div><div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;"><del><span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span> ' + tareaPendiente[index].AreaResponsable +
                        '<del></div><div class="col-md-3 titulo" style="text-transform:capitalize;font-size:10px; "> Realizado por: ' + tareaPendiente[index].Usuario +
                        '</div><div class="col-md-2">' + '<div class="badge badge-pill badge-success">Terminado <i class="fa fa-check"></i ></div> ' +
                        '</div>' +
                        '</div>' +
                        '</li>');

                }
                else if (tareaPendiente[index].Estado == 2) {
                    $(".ticketHijoIndex ul").append('<li class="list-group-item"><div class="todo-indicator bg-danger"></div>' +
                        '<div class="row"><div class="col-md-12 titulo"><span style="text-transform: capitalice;font-size:12px; color:black;"><b>' + tareaPendiente[index].CodigoTarea + '</b></span></div></div>' +
                        '<div class="row"><div class="col-md-3 titulo">'
                        + '<span style="text-transform: capitalice;font-size:12px; color:black;"><del>' + tareaPendiente[index].Titulo + '<del></span></br>' + '<span style="text-transform: capitalice; font-size:10px;"><del>' + tareaPendiente[index].Descripcion + '<del></span>' + '</div><div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;"><del><span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span> ' + tareaPendiente[index].AreaResponsable +
                        '<del></div><div class="col-md-3 titulo" style="text-transform:capitalize;font-size:10px; "> Realizado por: ' + tareaPendiente[index].Usuario +
                        '</div><div class="col-md-2">' + '<div class="badge badge-danger ml-2">No procede</div>' +
                        '</div>' +
                        '</div>' +
                        '</li>');
                }
                else if (tareaPendiente[index].Estado == 3 || tareaPendiente[index].Estado == 4) {
                    $(".ticketHijoIndex ul").append(`
                        <li class="list-group-item">
                          <div class="todo-indicator bg-warning"></div>
                          <div class="row">
                            <div class="col-md-12 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">
                                <b>${tareaPendiente[index].CodigoTarea}</b>
                              </span>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-3 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">${tareaPendiente[index].Titulo}</span>
                              </br>
                              <span style="text-transform: capitalice; font-size:10px;">${tareaPendiente[index].Descripcion}</span>
                            </div>
                            <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}
                            </div>
                            <div class="col-md-6 titulo" style="text-transform:capitalize; font-size:12px;">
                              <div class="badge badge-pill badge-warning ml-auto">Pendiente ${tareaPendiente[index].DescripcionEstado}</div>
                              </br>${tareaPendiente[index].Usuario} <i onclick="TransferirUsuarioTarea(${tareaPendiente[index].IdTareaDetalle},${tareaPendiente[index].IdQueu})" style="cursor:pointer" class="fa fa-pen" data-toggle="modal" data-target="#miModal"></i>
                            </div>
                            ${tareaPendiente[index].PuedeCerrarTarea == 1 ? `
                                <div class="col-md-6" style="margin-left:-10px;">
                                  <select id="select${tareaPendiente[index].IdTareaDetalle}" aria-haspopup="true" aria-expanded="false" data-toggle="dropdown" class="mb-2 mr-2 dropdown-toggle btn btn-link">
                                    <option class="dropdown-item">Procede</option>
                                    <option class="dropdown-item">No Procede</option>
                                  </select>
                                  <button class="mb-2 ml-4 btn btn-light active"  onclick="GuardarEstadoTarea(${tareaPendiente[index].IdTareaDetalle})" type="submit" style="vertical-align: middle;">
                                    <i class="pe-7s-diskette" style="font-weight:900;"></i>
                                  </button>
                                </div>
                             ` : ''}
                          </div>
                        </li>
                    `);

                }
                else if (tareaPendiente[index].Estado == 5) {
                    if (tareaPendiente[index].IdQueu == null) {
                        $(".ticketHijoIndex ul").append(`
                            <li class="list-group-item">
                              <div class="todo-indicator bg-secondary"></div>
                              <div class="row">
                                <div class="col-md-12 titulo">
                                  <span style="text-transform: capitalice;font-size:12px; color:black;">
                                    <b>${tareaPendiente[index].CodigoTarea}</b>
                                  </span>
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-md-3 titulo">
                                  <span style="text-transform: capitalice;font-size:12px; color:black;">${tareaPendiente[index].Titulo}</span>
                                  </br>
                                  <span style="text-transform: capitalice; font-size:10px;">${tareaPendiente[index].Descripcion}</span>
                                </div>
                                <div class="col-md-9 titulo" style="text-transform:capitalize; font-size:12px;">
                                  <div class="badge badge-pill badge-secondary ml-5">Sin Asignar</div>
                                  </br> </br>
                                  <input id="AreaResponsable_${tareaPendiente[index].IdTareaDetalle}" />
                                  </br> </br>
                                  <input id="UsuarioResponsable_${tareaPendiente[index].IdTareaDetalle}" />
                                  </br> </br>
                                </div>
                                <div class="col-md-6"></div>
                                <div class="col-md-3 ml-auto" style="margin-left:-10px;">
                                  <button
                                    class="mb-2 mr-2 btn btn-primary"
                                    onclick="AsignarUsuarioTarea(${tareaPendiente[index].IdTareaDetalle}, 0)"
                                    type="submit"
                                    style="vertical-align: middle; float: right;">
                                        <i class="pe-7s-add-user" style="font-weight:900;"></i >
                                        Asignar
                                  </button>
                                </div>
                              </div>
                            </li>
                        `);

                        $("#AreaResponsable_" + tareaPendiente[index].IdTareaDetalle).kendoComboBox({
                            autoBind: true,
                            dataValueField: "ID_QUEU",
                            dataTextField: "QUEU",
                            filter: "contains",
                            suggest: true,
                            placeholder: "Area Responsable",
                            template: '<div style="text-transform:capitalize;display:flex; flex-direction: column">' +
                                '<span><strong>${data.QUEU}</strong></span>' +
                                '<span>${data.DES_QUEU}</span></div>',
                            dataSource: areaResponsableData,
                            sort: { field: "QUEU", dir: "asc" }
                        }).data("kendoComboBox");

                        $("#UsuarioResponsable_" + tareaPendiente[index].IdTareaDetalle).kendoComboBox({
                            cascadeFrom: "AreaResponsable_" + tareaPendiente[index].IdTareaDetalle,
                            filter: "contains",
                            dataTextField: "ASSI",
                            dataValueField: "ID_PERS_ENTI",
                            dataSource: {
                                serverFiltering: true,
                                schema: {
                                    data: "Data",
                                    total: "Count"
                                },
                                transport: {
                                    read: "/Tarea/ListarAsignadosMinsur?var=" + Math.random()
                                }
                            }
                        }).data("kendoComboBox");

                    }
                    else {
                        $(".ticketHijoIndex ul").append(`
                            <li class="list-group-item">
                              <div class="todo-indicator bg-secondary"></div>
                              <div class="row">
                                <div class="col-md-12 titulo">
                                  <span style="text-transform: capitalice;font-size:12px; color:black;">
                                    <b>${tareaPendiente[index].CodigoTarea}</b>
                                  </span>
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-md-3 titulo">
                                  <span style="text-transform: capitalice;font-size:12px; color:black;">${tareaPendiente[index].Titulo}</span>
                                  </br>
                                  <span style="text-transform: capitalice; font-size:10px;">${tareaPendiente[index].Descripcion}</span>
                                </div>
                                <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                                  <span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}
                                </div>
                                <div class="col-md-6 titulo" style="text-transform:capitalize; font-size:12px;">
                                  <div class="badge badge-pill badge-secondary ml-auto">Sin Asignar</div>
                                  </br>` +
                            (tareaPendiente[index].FlagDesplegable == 0 ?
                                   /*<input value="AQUI ES"/> */
                            (`<b>Asignar a: </b></br><select
                                    id_queue="${tareaPendiente[index].IdQueu}"
                                    style="margin-left:-7%"
                                    name="selectAsignar${tareaPendiente[index].IdTareaDetalle}"
                                    aria-haspopup="true"
                                    aria-expanded="false"
                                    class="mb-2 mr-2 dropdown-toggle btn btn-link">
                                  </select>`) :
                            (`<b>Solicitante: </b></br><select
                                    id_queue="${tareaPendiente[index].IdQueu}"
                                    style="margin-left:-7%;text-align:left;"
                                    name="selectAsignar${tareaPendiente[index].IdTareaDetalle}"
                                    aria-haspopup="true"
                                    aria-expanded="false"
                                    class="mb-2 mr-2 dropdown-toggle btn btn-link">
                                  </select>`)
                                )
                                +`</div>
                                <div class="col-md-6"></div>
                                <div class="col-md-3 ml-auto" style="margin-left:-10px;">
                                  <button
                                    class="mb-2 mr-2 btn btn-primary"
                                    onclick="AsignarUsuarioTarea(${tareaPendiente[index].IdTareaDetalle}, ${tareaPendiente[index].IdQueu})"
                                    type="submit"
                                    style="vertical-align: middle; float: right;">
                                        <i class="pe-7s-add-user" style="font-weight:900;"></i >
                                        Asignar
                                  </button>
                                </div>
                              </div>
                            </li>`

                        );
                    }
                }
            });

            //$('[name^="selectAsignar"]').each(function (index, el) {
            //    $.ajax({
            //        contentType: 'application/json; charset=utf-8',
            //        url: "/Home/ListaUsuariosPorCola/",
            //        data: { ID_QUEU: $(el).attr("id_queue")},
            //        type: "Get",
            //        datatype: "json",
            //        cache: false,
            //        success: function (data) {
            //            $(el).append(
            //                data.reduce((acc, value) => acc + `<option value="${value.ID_PERS_ENTI}" class="dropdown-item">${value.ASSI}</option>`, "")
            //            )
            //        },
            //        error: function () {
            //            toastr.danger("Ocurrió un Error", "Advertencia")
            //        }
            //    });
            //});
            $('[name^="selectAsignar"]').each(function (index, el) {
                $.ajax({
                    contentType: 'application/json; charset=utf-8',
                    url: "/Tarea/ListarAsignadosMinsur/",
                    data: { AreaResp: $(el).attr("id_queue") },
                    type: "Get",
                    datatype: "json",
                    cache: false,
                    success: function (data) {
                        $(el).append(
                            data.Data.reduce((acc, value) => acc + `<option value="${value.ID_PERS_ENTI}" class="dropdown-item">${value.ASSI}</option>`, "")
                        )
                    },
                    error: function () {
                        toastr.danger("Ocurrió un Error", "Advertencia")
                    }
                });
            });


        }
        else {
            $(".ticketHijoIndex ul").append('<div class="smallField"> No se encontraron tareas pendientes');
        }
    }

    function AsignarUsuarioTarea(id, idQueue) {
        event.preventDefault();

        var usuario = $(`[name="selectAsignar${id}"]`).find(':selected').val();
        var nomUsuario = $(`[name="selectAsignar${id}"]`).find(':selected').text();

        if (usuario == undefined) {
            idQueue = $(`#AreaResponsable_${id}`).val();
            var usuarioKendo = $(`#UsuarioResponsable_${id}`).data("kendoComboBox");
            usuario = usuarioKendo.value();
            nomUsuario = usuarioKendo.text();

            if (usuario == null || usuario == "") {
                toastr.warning("Seleccione un usuario para asignar la tarea");
                return false;
            }
        }

        swal({
            title: `¿Deseas asignar esta actividad?`,
            text: `Se asignará la actividad al usuario(a): ${nomUsuario}`,
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Guardar",
            cancelButtonText: "Cancel",
            closeOnConfirm: false,
            closeOnCancel: false
        }, function (dismiss) {
            if (dismiss) {
                $.ajax({
                    url: '/Tarea/AsignarUsuarioTarea',
                    data: JSON.stringify({
                        id,
                        usuario,
                        idQueue
                    }),
                    type: "POST",
                    contentType: "application/json",
                    success: function (result) {
                        MensajeConfirmacionTareasMinsur(result.message);
                    }
                });

            }
            else {
                swal("Cancelado", "Ha cancelado la asignación", "error");
            }

        });

    }

    function TransferirUsuarioTarea(id, idQueu) {
        $("#lblTitulo").text("Transferir Tarea");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-md");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-md");

        $('#modal-content').empty();
        $('#modal-content').load("/Tarea/TransferirTarea", { id, idQueu });
    }

    function GuardarEstadoTarea(id) {
        event.preventDefault();

        var estado = $('#select' + id + '').val();

        swal({
            title: "¿Deseas guardar esta actividad?",
            text: "¡Verifique la información antes de enviar!",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Guardar",
            cancelButtonText: "Cancel",
            closeOnConfirm: false,
            closeOnCancel: false
        }, function (dismiss) {
            if (dismiss) {
                $.ajax({
                    url: '/Tarea/GuardarEstadoTarea/',
                    data: JSON.stringify({
                        id,
                        estado
                    }),
                    type: "POST",
                    contentType: "application/json",
                    success: function (result) {
                        MensajeConfirmacionTareasMinsur(result.message, result.idTareaDetalle, result.idEstado);
                    }
                });

            }
            else {
                swal("Cancelado", "Ha cancelado el envío de la información", "error");
            }

        });

    }

    function MensajeConfirmacionTareasMinsur(msg, idTareaDetalle, idEstado) {
        if (msg == 'OK') {
            idSetTimeout = setTimeout(function (element) {
                if (@ViewBag.CategoriaConTareas == 1) {
                    $(".ticketHijoIndex ul").html('');

                    $.ajax({
                        contentType: 'application/json; charset=utf-8',
                        url: "/Tarea/ListarTareasPorTicket",
                        type: "GET",
                        data: { idTicket: idTicket },
                        datatype: "JSON",
                        cache: false,
                        success: function (data) {
                            if (data) tejerTareasCreadas(data);
                        },
                        error: function () {
                        }
                    });
                }
                else {
                    $.ajax({
                        contentType: 'application/json; charset=utf-8',
                        url: "/Ticket/ListarTareasPendientes",
                        type: "Get",
                        data: { idTicket: idTicket },
                        datatype: "json",
                        cache: false,
                        success: function (data) {
                            if (data) {
                                if ('@ViewBag.ID_CATE_MINSUR' == 27158 || '@ViewBag.ID_CATE_MINSUR' == 28529 || '@ViewBag.ID_CATE_MINSUR' == 29900) {
                                    $(".ticketHijoIndex ul > .divListTMinsur").html('');
                                    tejerTareasPendientesMovil(data["tareaPendiente"]);
                                }
                                else if ('@ViewBag.ID_CATE_MINSUR' == 32465 || '@ViewBag.ID_CATE_MINSUR' == 32466) {
                                    $(".ticketHijoIndex ul > .divListTMinsur").html('');
                                    tejerTareasPendientesContable(data["tareaPendiente"]);
                                }
                                else {
                                    $(".ticketHijoIndex ul").html('');
                                    tejerTareasPendientes(data["tareaPendiente"]);
                                }

                                swal.close();
                            }
                        },
                        error: function () {
                            //t//Crear_Failed()
                        }
                    });
                }


            }, 2000, $(this));

            swal({
                title: 'Guardando',
                type: 'success',
                text: 'Registro exitoso',
                confirmButtonColor: "#DD6B55",
                focusConfirm: false,
                confirmButtonText: 'Continue',
                confirmButtonAriaLabel: 'Thumbs up, great!'
            });

        } else if (msg == 'REFRESH') {
            swal({
                title: 'Guardando',
                type: 'success',
                text: 'Registro exitoso',
                confirmButtonColor: "#DD6B55",
                focusConfirm: false,
                confirmButtonText: 'Continue',
                confirmButtonAriaLabel: 'Thumbs up, great!'
            }, function (confirm) {
                if (confirm) {
                    location.reload()
                }
            });

        } else if (msg == 'ERROR') {
            swal({
                title: 'Warning',
                type: 'info',
                text: 'ERROR EN EL REGISTRO',
                confirmButtonColor: "#DD6B55",
                focusConfirm: false,
                confirmButtonText: 'Continue',
                confirmButtonAriaLabel: 'Thumbs up, great!'
            });

        } else if (msg == 'RESUELVE') {
            $('#idTareaDetalleResolverTicket').val(idTareaDetalle);
            $('#idEstadoResolverTicket').val(idEstado);
            swal.close();
            $("#btnResolverTicketTareas").click();

        }
    }

    function ResolverTicketTareas(idTick) {
        $("#btnResolverTicketTareas").attr("data-toggle", "modal");
        $("#btnResolverTicketTareas").attr("data-target", "#miModal");

        $("#lblTitulo").text("Motivo de Solución del Ticket");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-md");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-md");

        var idTareaDetalle = $('#idTareaDetalleResolverTicket').val();
        var idEstado = $('#idEstadoResolverTicket').val();
        console.log(idTareaDetalle)

        $('#modal-content').empty();
        $('#modal-content').load("/Tarea/ResolverTicket", { idTick, idTareaDetalle, idEstado });
    }

    function CambiarEstadoTarea(id) {
        event.preventDefault();
        let estado = $('#selectEstadoTarea' + id).val();
        let data = { id, estado };

        swal({
            title: "¿Deseas guardar esta actividad?",
            text: "¡Verifique la información antes de enviar!",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Guardar",
            cancelButtonText: "Cancel",
            closeOnConfirm: false,
            closeOnCancel: false
        }, function (dismiss) {
            if (dismiss) {
                $.ajax({
                    url: "/Ticket/CambiarEstadoTareaMinsur/",
                    data: data,
                    type: "POST",
                    cache: false,
                    dataType: "text",
                    success: function (resp) {
                        if (resp == "OK") {
                            idSetTimeout = setTimeout(function (element) {
                                $(".ticketHijoIndex ul").html('');

                                $.ajax({
                                    contentType: 'application/json; charset=utf-8',
                                    url: "/Ticket/ListarTareasMinsur",
                                    type: "Get",
                                    data: { idTicket: idTicket },
                                    datatype: "json",
                                    cache: false,
                                    success: function (data) {
                                        if (data) tejerTareasConfigurables(data);
                                    },
                                    error: function () {
                                    }
                                });
                            }, 2000, $(this));

                            swal({
                                title: 'Guardado',
                                type: 'success',
                                text: 'Registro exitoso',
                                confirmButtonColor: "#DD6B55",
                                focusConfirm: false,
                                confirmButtonText:
                                    'Continuar',
                                confirmButtonAriaLabel: 'Thumbs up, great!'

                            });
                        }
                        else if (resp == "REFRESH") {
                            swal({
                                title: 'Guardado',
                                type: 'success',
                                text: 'Registro exitoso',
                                confirmButtonColor: "#DD6B55",
                                focusConfirm: false,
                                confirmButtonText:
                                    'Continuar',
                                confirmButtonAriaLabel: 'Thumbs up, great!'

                            }, function (confirm) {
                                if (confirm) {
                                    location.reload()
                                }
                            });
                        } else if (resp == "ERROR") {
                            swal({
                                title: 'Warning',
                                type: 'info',
                                text: 'ERROR EN EL REGISTRO',
                                confirmButtonColor: "#DD6B55",
                                focusConfirm: false,
                                confirmButtonText:
                                    'Continuar',
                                confirmButtonAriaLabel: 'Thumbs up, great!'

                            })
                        }
                        else {
                            alert(resp);
                        }
                    }
                });

            }
            else {
                swal("Cancelado", "Ha cancelado el envío de la información", "error");
            }
        });

    }

    function AsignarTareaConfigurable(id) {
        event.preventDefault();
        let asignado = $('#selectAsignadoTareaConfigurable' + id).val();
        let data = { id, asignado };

        swal({
            title: "¿Deseas asignar esta actividad?",
            text: "¡Verifique la información antes de enviar!",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Guardar",
            cancelButtonText: "Cancel",
            closeOnConfirm: false,
            closeOnCancel: false
        }, function (dismiss) {
            if (dismiss) {
                $.ajax({
                    url: "/Ticket/AsignarTareaMinsur/",
                    data: data,
                    type: "POST",
                    cache: false,
                    dataType: "text",
                    success: function (resp) {
                        if (resp == "OK") {
                            idSetTimeout = setTimeout(function (element) {
                                $(".ticketHijoIndex ul").html('');

                                $.ajax({
                                    contentType: 'application/json; charset=utf-8',
                                    url: "/Ticket/ListarTareasMinsur",
                                    type: "Get",
                                    data: { idTicket: idTicket },
                                    datatype: "json",
                                    cache: false,
                                    success: function (data) {
                                        if (data) tejerTareasConfigurables(data);
                                    },
                                    error: function () {
                                    }
                                });
                            }, 2000, $(this));

                            swal({
                                title: 'Guardado',
                                type: 'success',
                                text: 'Registro exitoso',
                                confirmButtonColor: "#DD6B55",
                                focusConfirm: false,
                                confirmButtonText:
                                    'Continuar',
                                confirmButtonAriaLabel: 'Thumbs up, great!'

                            });
                        }
                        else if (resp == "REFRESH") {
                            swal({
                                title: 'Guardado',
                                type: 'success',
                                text: 'Registro exitoso',
                                confirmButtonColor: "#DD6B55",
                                focusConfirm: false,
                                confirmButtonText:
                                    'Continuar',
                                confirmButtonAriaLabel: 'Thumbs up, great!'

                            }, function (confirm) {
                                if (confirm) {
                                    location.reload()
                                }
                            });
                        } else if (resp == "ERROR") {
                            swal({
                                title: 'Warning',
                                type: 'info',
                                text: 'ERROR EN EL REGISTRO',
                                confirmButtonColor: "#DD6B55",
                                focusConfirm: false,
                                confirmButtonText:
                                    'Continuar',
                                confirmButtonAriaLabel: 'Thumbs up, great!'

                            })
                        }
                        else {
                            alert(resp);
                        }
                    }
                });

            }
            else {
                swal("Cancelado", "Ha cancelado el envío de la información", "error");
            }
        });

    }

    function generarItemTerminado(tarea) {
        let item =
            `<li class="list-group-item">
        <div class="todo-indicator bg-${tarea.Color}"></div>
        <div class="row">
            <div class="col-md-12 titulo">
                <span style="text-transform: capitalice;font-size:12px; color:black;"><b> ${tarea.Codigo}</b></span>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3 titulo">
                <span style="text-transform: capitalice;font-size:12px; color:black;"><del> ${tarea.Titulo}<del></span>
                </br>
                <span style="text-transform: capitalice; font-size:10px;"><del> ${tarea.Descripcion} <del></span>
            </div>
            <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                <del><span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </br> </span> ${tarea.AreaResponsable}<del>
            </div>
            <div class="col-md-3 titulo" style="text-transform:capitalize;font-size:10px; ">
                Realizado por: </br> ${tarea.UsuarioAsignado}
            </div>
            <div class="col-md-2">
                <div class="badge badge-pill badge-${tarea.Color} ml-2">${tarea.Estado}</div>
            </div>
        </div>
    </li>`;
        return item;
    }

    function generarItemPendiente(tarea) {
        let item;
        if (tarea.UsuarioAsignado == null) {
            item =
                `<li class="list-group-item">
                <div class="todo-indicator bg-${tarea.Color}"></div>
                <div class="row">
                <div class="col-md-12 titulo">
                    <span style="text-transform: capitalice;font-size:12px; color:black;">
                    <b>${tarea.Codigo}</b>
                    </span>
                </div>
                </div>
                <div class="row">
                <div class="col-md-3 titulo">
                    <span style="text-transform: capitalice;font-size:12px; color:black;">${tarea.Titulo}</span>
                    </br>
                    <span style="text-transform: capitalice; font-size:10px;">${tarea.Descripcion}</span>
                </div>
                <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                    <span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </br></span>${tarea.AreaResponsable}
                </div>
                <div class="col-md-6 titulo" style="text-transform:capitalize; font-size:12px;">
                    <div class="badge badge-pill badge-${tarea.Color} ml-auto">${tarea.Estado}</div>
                    </br>
                    <select
                        id_tarea="${tarea.Id}"
                        id="selectAsignadoTareaConfigurable${tarea.Id}"
                        style="margin-left:-7%"
                        aria-haspopup="true"
                        aria-expanded="false"
                        data-toggle="dropdown"
                        class="mb-2 mr-2 dropdown-toggle btn btn-link">
                    </select>
                </div>
                <div class="col-md-6" style="margin-left:auto;">
                    <button class="mb-2 ml-4 btn btn-light active" onclick="AsignarTareaConfigurable(${tarea.Id})" type="submit" style="vertical-align: middle;">
                    <i class="pe-7s-add-user" style="font-weight:900;"></i>
                    </button>
                </div>
                </div>
            </li>`
        } else {
            item =
                `<li class="list-group-item">
                <div class="todo-indicator bg-${tarea.Color}"></div>
                <div class="row">
                <div class="col-md-12 titulo">
                    <span style="text-transform: capitalice;font-size:12px; color:black;">
                    <b>${tarea.Codigo}</b>
                    </span>
                </div>
                </div>
                <div class="row">
                <div class="col-md-3 titulo">
                    <span style="text-transform: capitalice;font-size:12px; color:black;">${tarea.Titulo}</span>
                    </br>
                    <span style="text-transform: capitalice; font-size:10px;">${tarea.Descripcion}</span>
                </div>
                <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                    <span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </br></span>${tarea.AreaResponsable}
                </div>
                <div class="col-md-6 titulo" style="text-transform:capitalize; font-size:12px;">
                    <div class="badge badge-pill badge-${tarea.Color} ml-auto">${tarea.Estado}</div>
                    </br>${tarea.UsuarioAsignado}
                </div>
                <div class="col-md-6" style="margin-left:-10px;">
                    <select
                        id_tarea="${tarea.Id}"
                        id="selectEstadoTarea${tarea.Id}"
                        aria-haspopup="true"
                        aria-expanded="false"
                        data-toggle="dropdown"
                        class="mb-2 mr-2 dropdown-toggle btn btn-link">
                    </select>
                    <button class="mb-2 ml-4 btn btn-light active"  onclick="CambiarEstadoTarea(${tarea.Id})" type="submit" style="vertical-align: middle;">
                    <i class="pe-7s-diskette" style="font-weight:900;"></i>
                    </button>
                </div>
                </div>
            </li>`
        }

        return item;
    }

    function generarItemTarea(tarea) {
        $(".ticketHijoIndex ul").append(tarea.Terminado ? generarItemTerminado(tarea) : generarItemPendiente(tarea));
    }

    function tejerTareasConfigurables(listaTareas) {
        tareasTemp = listaTareas;

        if (parseInt(listaTareas.length) > 0) {

            $.each(listaTareas, function (index, tarea) { generarItemTarea(tarea) });

            $('[id^="selectEstadoTarea"]').each(function (index, el) {
                $.ajax({
                    contentType: 'application/json; charset=utf-8',
                    url: "/Ticket/ListaEstadosTareaMinsur/",
                    data: { idTarea: $(el).attr("id_tarea") },
                    type: "Get",
                    datatype: "json",
                    cache: false,
                    success: function (data) {
                        $(el).append(
                            data.reduce((acc, value) => acc + `<option value="${value.Id}" class="dropdown-item">${value.Nombre}</option>`, "")
                        )
                    },
                    error: function () {
                        toastr.danger("Ocurrió un Error", "Advertencia")
                    }
                });
            });

            $('[id^="selectAsignadoTareaConfigurable"]').each(function (index, el) {
                $.ajax({
                    contentType: 'application/json; charset=utf-8',
                    url: "/Ticket/ListaAsignadosTareaMinsur/",
                    data: { idTarea: $(el).attr("id_tarea") },
                    type: "Get",
                    datatype: "json",
                    cache: false,
                    success: function (data) {
                        $(el).append(
                            data.reduce((acc, value) => acc + `<option value="${value.IdPersEnti}" class="dropdown-item">${value.Nombre}</option>`, "")
                        )
                    },
                    error: function () {
                        toastr.danger("Ocurrió un Error", "Advertencia")
                    }
                });
            });

        } else {
            $(".ticketHijoIndex ul").append('<div class="smallField"> No se encontraron tareas pendientes');
        }
    }

    function tejerTareasPendientes(tareaPendiente) {
        tareasTemp = tareaPendiente;
        if (parseInt(tareaPendiente.length) > 0) {

            $.each(tareaPendiente, function (index, value) {

                if (tareaPendiente[index].Estado == 1) {

                    $(".ticketHijoIndex ul").append('<li class="list-group-item"><div class="todo-indicator bg-success"></div>' +
                        '<div class="row"><div class="col-md-12 titulo"><span style="text-transform: capitalice;font-size:12px; color:black;"><b>' + tareaPendiente[index].CodigoTarea + '</b></span></div></div>' +
                        '<div class="row"><div class="col-md-3 titulo">'
                        + '<span style="text-transform: capitalice;font-size:12px; color:black;"><del>' + tareaPendiente[index].Titulo + '<del></span></br>' + '<span style="text-transform: capitalice; font-size:10px;"><del>' + tareaPendiente[index].Descripcion + '<del></span>' + '</div><div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;"><del><span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span> ' + tareaPendiente[index].AreaResponsable +
                        '<del></div><div class="col-md-3 titulo" style="text-transform:capitalize;font-size:10px; "> Realizado por: ' + tareaPendiente[index].Usuario +
                        '</div><div class="col-md-2">' + '<div class="badge badge-pill badge-success">Terminado <i class="fa fa-check"></i ></div> ' +
                        '</div>' +
                        '</div>' +
                        '</li>');

                } else if (tareaPendiente[index].Estado == 2) {
                    $(".ticketHijoIndex ul").append('<li class="list-group-item"><div class="todo-indicator bg-danger"></div>' +
                        '<div class="row"><div class="col-md-12 titulo"><span style="text-transform: capitalice;font-size:12px; color:black;"><b>' + tareaPendiente[index].CodigoTarea + '</b></span></div></div>' +
                        '<div class="row"><div class="col-md-3 titulo">'
                        + '<span style="text-transform: capitalice;font-size:12px; color:black;"><del>' + tareaPendiente[index].Titulo + '<del></span></br>' + '<span style="text-transform: capitalice; font-size:10px;"><del>' + tareaPendiente[index].Descripcion + '<del></span>' + '</div><div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;"><del><span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span> ' + tareaPendiente[index].AreaResponsable +
                        '<del></div><div class="col-md-3 titulo" style="text-transform:capitalize;font-size:10px; "> Realizado por: ' + tareaPendiente[index].Usuario +
                        '</div><div class="col-md-2">' + '<div class="badge badge-danger ml-2">No procede</div>' +
                        '</div>' +
                        '</div>' +
                        '</li>');
                }
                //else if (tareaPendiente[index].Estado == 3) {
                //    var descripcion = "'" + tareaPendiente[index].Descripcion + "'";
                //    //$(".ticketHijoIndex ul").append('<li class="list-group-item"><div class="todo-indicator bg-info"></div><div class="row"><div class="col-md-3 titulo">'
                //    //    + '<span style="text-transform: capitalice;font-size:12px; color:black;">' + tareaPendiente[index].Titulo + '</span></br>' + '<span style="text-transform: capitalice; font-size:10px;">' + tareaPendiente[index].Descripcion + '</span>' + '</div><div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;"><span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>' + tareaPendiente[index].AreaResponsable +
                //    //    '</div><div class="col-md-3"><div class="badge badge-pill badge-info ml-2">Transferido</div><select id="select' + tareaPendiente[index].Id + '" aria-haspopup="true" aria-expanded="false" data-toggle="dropdown" class="mb-2 mr-2 dropdown-toggle btn btn-link"><option class="dropdown-item">Procede</option><option class="dropdown-item">No Procede</option></select></div><div class="col-md-3" style="margin-left:-10px;"><button class="ladda-label" onclick="GuardarTareaRealizada(' + tareaPendiente[index].Id + ',' + descripcion + ')" type="submit" style="vertical-align: middle; float: right;">' +
                //    //        '<i class="pe-7s-diskette"></i ></button>' +
                //    //        '</div>' +
                //    //        '</div>' +
                //    //    '</li>');

                //    if (tareaPendiente[index].Usuario == null) {
                //        $(".ticketHijoIndex ul").append(`
                //        <li class="list-group-item">
                //          <div class="todo-indicator bg-secondary"></div>
                //          <div class="row">
                //            <div class="col-md-3 titulo">
                //              <span style="text-transform: capitalice;font-size:12px; color:black;">${tareaPendiente[index].Titulo}</span>
                //              </br>
                //              <span style="text-transform: capitalice; font-size:10px;">${tareaPendiente[index].Descripcion}</span>
                //            </div>
                //            <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                //              <span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}
                //            </div>
                //            <div class="col-md-6 titulo" style="text-transform:capitalize; font-size:12px;">
                //              <div class="badge badge-pill badge-secondary ml-auto">Sin Asignar</div>
                //              </br>
                //              <select style="margin-left:-7%" name="selectAsignar${tareaPendiente[index].Id}" aria-haspopup="true" aria-expanded="false" data-toggle="dropdown" class="mb-2 mr-2 dropdown-toggle btn btn-link">
                //              </select>
                //            </div>
                //            <div class="col-md-6"></div>
                //            <div class="col-md-3 ml-auto" style="margin-left:-10px;">
                //              <button class="mb-2 mr-2 btn btn-primary" onclick="GuardarTareaRealizada(${tareaPendiente[index].Id},${descripcion})" type="submit" style="vertical-align: middle; float: right;">
                //                <i class="pe-7s-add-user" style="font-weight:900;"></i > Asignar
                //              </button>
                //            </div>
                //          </div>
                //        </li>
                //      `);
                //    } else {
                //        $(".ticketHijoIndex ul").append(`
                //        <li class="list-group-item">
                //          <div class="todo-indicator bg-warning"></div>
                //          <div class="row">
                //            <div class="col-md-3 titulo">
                //              <span style="text-transform: capitalice;font-size:12px; color:black;">${tareaPendiente[index].Titulo}</span>
                //              </br>
                //              <span style="text-transform: capitalice; font-size:10px;">${tareaPendiente[index].Descripcion}</span>
                //            </div>
                //            <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                //              <span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}
                //            </div>
                //            <div class="col-md-6 titulo" style="text-transform:capitalize; font-size:12px;">
                //              <div class="badge badge-pill badge-warning ml-auto">Pendiente</div>
                //              </br>${tareaPendiente[index].Usuario} <i onclick="TransferirTareaParaUsuario(${tareaPendiente[index].Id})" style="cursor:pointer" class="fa fa-pen" data-toggle="modal" data-target="#miModal"></i>
                //            </div>
                //            <div class="col-md-6" style="margin-left:-10px;">
                //              <select id="select${tareaPendiente[index].Id}" aria-haspopup="true" aria-expanded="false" data-toggle="dropdown" class="mb-2 mr-2 dropdown-toggle btn btn-link">
                //                <option class="dropdown-item">Procede</option>
                //                <option class="dropdown-item">No Procede</option>
                //              </select>
                //              <button class="mb-2 ml-4 btn btn-light active"  onclick="GuardarTareaRealizada(${tareaPendiente[index].Id},${descripcion})" type="submit" style="vertical-align: middle;">
                //                <i class="pe-7s-diskette" style="font-weight:900;"></i>
                //              </button>
                //            </div>
                //          </div>
                //        </li>
                //      `);
                //    }
                //}
                else if (tareaPendiente[index].Estado == 3 || tareaPendiente[index].Estado == 4) {
                    var descripcion = "'" + tareaPendiente[index].Descripcion + "'";
                    //$(".ticketHijoIndex ul").append('<li class="list-group-item"><div class="todo-indicator bg-warning"></div><div class="row"><div class="col-md-3 titulo">'
                    //    + '<span style="text-transform: capitalice;font-size:12px; color:black;">' + tareaPendiente[index].Titulo + '</span></br>' + '<span style="text-transform: capitalice; font-size:10px;">' + tareaPendiente[index].Descripcion + '</span>' + '</div><div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;"><span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>' + tareaPendiente[index].AreaResponsable +
                    //    '</div><div class="col-md-3"><select id="select' + tareaPendiente[index].Id + '" aria-haspopup="true" aria-expanded="false" data-toggle="dropdown" class="mb-2 mr-2 dropdown-toggle btn btn-link"><option class="dropdown-item">Procede</option><option class="dropdown-item">No Procede</option></select></div><div class="col-md-3" style="margin-left:-10px;"><button class="mb-2 mr-2 btn btn-light active"  onclick="GuardarTareaRealizada(' + tareaPendiente[index].Id + ',' + descripcion+ ')" type="submit" style="vertical-align: middle; float: right;">' +
                    //    '<i class="pe-7s-diskette" style="font-weight:900;"></i ></button>' +
                    //    '</div>' +
                    //    '</div>' +
                    //    '</li>');
                    if (tareaPendiente[index].Usuario == null) {
                        if (parseInt(@Session["GESTOR_TAREAS_MINSUR_MARCOBRE_RAURA"]) == 1) {
                $(".ticketHijoIndex ul").append(`
                            <li class="list-group-item">
                              <div class="todo-indicator bg-secondary"></div>
                              <div class="row">
                                <div class="col-md-12 titulo">
                                  <span style="text-transform: capitalice;font-size:12px; color:black;">
                                    <b>${tareaPendiente[index].CodigoTarea}</b>
                                  </span>
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-md-3 titulo">
                                  <span style="text-transform: capitalice;font-size:12px; color:black;">${tareaPendiente[index].Titulo}</span>
                                  </br>
                                  <span style="text-transform: capitalice; font-size:10px;">${tareaPendiente[index].Descripcion}</span>
                                </div>
                                <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                                  <span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}
                                </div>
                                <div class="col-md-6 titulo" style="text-transform:capitalize; font-size:12px;">
                                  <div class="badge badge-pill badge-secondary ml-auto">Sin Asignar</div>
                                  </br>
                                  <select
                                    id_queue="${tareaPendiente[index].IdQueu}"
                                    style="margin-left:-7%"
                                    name="selectAsignar${tareaPendiente[index].IdTareaDetalle}"
                                    aria-haspopup="true"
                                    aria-expanded="false"
                                    data-toggle="dropdown"
                                    class="mb-2 mr-2 dropdown-toggle btn btn-link">
                                  </select>
                                </div>
                                <div class="col-md-6"></div>
                                <div class="col-md-3 ml-auto" style="margin-left:-10px;">
                                  <button
                                    class="mb-2 mr-2 btn btn-primary"
                                    onclick="AsignarUsuarioParaTarea(${tareaPendiente[index].IdTareaDetalle})"
                                    type="submit"
                                    style="vertical-align: middle; float: right;">
                                        <i class="pe-7s-add-user" style="font-weight:900;"></i >
                                        Asignar
                                  </button>
                                </div>
                              </div>
                            </li>
                          `);
            }
                        else if (parseInt(@Session["EJECUTOR_TAREAS_MINSUR_MARCOBRE_RAURA"]) == 1) {
                $(".ticketHijoIndex ul").append(`
                            <li class="list-group-item">
                              <div class="todo-indicator bg-secondary"></div>
                              <div class="row">
                                <div class="col-md-12 titulo">
                                  <span style="text-transform: capitalice;font-size:12px; color:black;">
                                    <b>${tareaPendiente[index].CodigoTarea}</b>
                                  </span>
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-md-3 titulo">
                                  <span style="text-transform: capitalice;font-size:12px; color:black;">${tareaPendiente[index].Titulo}</span>
                                  </br>
                                  <span style="text-transform: capitalice; font-size:10px;">${tareaPendiente[index].Descripcion}</span>
                                </div>
                                <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                                  <span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}
                                </div>
                                <div class="col-md-6 titulo" style="text-transform:capitalize; font-size:12px;">
                                  <div class="badge badge-pill badge-secondary ml-auto">Sin Asignar</div>
                                  </br>`
                    +
                    (parseInt(@Session["ID_QUEU"]) == tareaPendiente[index].IdQueu ?
                        `<select
                                        id_queue="${tareaPendiente[index].IdQueu}"
                                        style="margin-left:-7%"
                                        name="selectAsignar${tareaPendiente[index].IdTareaDetalle}"
                                        aria-haspopup="true"
                                        aria-expanded="false"
                                        data-toggle="dropdown"
                                        class="mb-2 mr-2 dropdown-toggle btn btn-link">
                                        </select>`
                        :
                        ``
                                )
                +
                    `</div>
                                <div class="col-md-6"></div>
                                <div class="col-md-3 ml-auto" style="margin-left:-10px;">`
                    +
                    (parseInt(@Session["ID_QUEU"]) == tareaPendiente[index].IdQueu ?
                        `<button
                                        class="mb-2 mr-2 btn btn-primary"
                                        onclick="AsignarUsuarioParaTarea(${tareaPendiente[index].IdTareaDetalle})"
                                        type="submit"
                                        style="vertical-align: middle; float: right;">
                                            <i class="pe-7s-add-user" style="font-weight:900;"></i >
                                            Asignar
                                  </button>`
                        :
                        ``
                                )
                +
                    `</div>
                              </div>
                            </li>
                          `);
            }
        } else {
            $(".ticketHijoIndex ul").append(`
                        <li class="list-group-item">
                          <div class="todo-indicator bg-warning"></div>
                          <div class="row">
                            <div class="col-md-12 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">
                                <b>${tareaPendiente[index].CodigoTarea}</b>
                              </span>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-3 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">${tareaPendiente[index].Titulo}</span>
                              </br>
                              <span style="text-transform: capitalice; font-size:10px;">${tareaPendiente[index].Descripcion}</span>
                            </div>
                            <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}
                            </div>
                            <div class="col-md-6 titulo" style="text-transform:capitalize; font-size:12px;">
                              <div class="badge badge-pill badge-warning ml-auto">Pendiente</div>
                              </br>${tareaPendiente[index].Usuario} <i onclick="TransferirTareaParaUsuario(${tareaPendiente[index].IdTareaDetalle},${tareaPendiente[index].IdQueu},${descripcion})" style="cursor:pointer" class="fa fa-pen" data-toggle="modal" data-target="#miModal"></i>
                            </div>
                            <div class="col-md-6" style="margin-left:-10px;">
                              <select id="select${tareaPendiente[index].Id}" aria-haspopup="true" aria-expanded="false" data-toggle="dropdown" class="mb-2 mr-2 dropdown-toggle btn btn-link">
                                <option class="dropdown-item">Procede</option>
                                <option class="dropdown-item">No Procede</option>
                              </select>
                              <button class="mb-2 ml-4 btn btn-light active"  onclick="GuardarTareaRealizada(${tareaPendiente[index].Id},${descripcion})" type="submit" style="vertical-align: middle;">
                                <i class="pe-7s-diskette" style="font-weight:900;"></i>
                              </button>
                            </div>
                          </div>
                        </li>
                      `);
        }

    }
                else if (tareaPendiente[index].Estado == 5) {
        var descripcion = "'" + tareaPendiente[index].Descripcion + "'";

        if (parseInt(@Session["GESTOR_TAREAS_MINSUR_MARCOBRE_RAURA"]) == 1) {
            $(".ticketHijoIndex ul").append(`
                        <li class="list-group-item">
                          <div class="todo-indicator bg-secondary"></div>
                          <div class="row">
                            <div class="col-md-12 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">
                                <b>${tareaPendiente[index].CodigoTarea}</b>
                              </span>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-3 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">${tareaPendiente[index].Titulo}</span>
                              </br>
                              <span style="text-transform: capitalice; font-size:10px;">${tareaPendiente[index].Descripcion}</span>
                            </div>
                            <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}
                            </div>
                            <div class="col-md-6 titulo" style="text-transform:capitalize; font-size:12px;">
                              <div class="badge badge-pill badge-secondary ml-auto">Sin Asignar</div>
                              </br>
                              <select
                                id_queue="${tareaPendiente[index].IdQueu}"
                                style="margin-left:-7%"
                                name="selectAsignar${tareaPendiente[index].IdTareaDetalle}"
                                aria-haspopup="true"
                                aria-expanded="false"
                                data-toggle="dropdown"
                                class="mb-2 mr-2 dropdown-toggle btn btn-link">
                              </select>
                            </div>
                            <div class="col-md-6"></div>
                            <div class="col-md-3 ml-auto" style="margin-left:-10px;">
                              <button
                                class="mb-2 mr-2 btn btn-primary"
                                onclick="AsignarUsuarioParaTarea(${tareaPendiente[index].IdTareaDetalle})"
                                type="submit"
                                style="vertical-align: middle; float: right;">
                                    <i class="pe-7s-add-user" style="font-weight:900;"></i >
                                    Asignar
                              </button>
                            </div>
                          </div>
                        </li>
                      `);
        }
                    else if (parseInt(@Session["EJECUTOR_TAREAS_MINSUR_MARCOBRE_RAURA"]) == 1) {
            $(".ticketHijoIndex ul").append(`
                        <li class="list-group-item">
                          <div class="todo-indicator bg-secondary"></div>
                          <div class="row">
                            <div class="col-md-12 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">
                                <b>${tareaPendiente[index].CodigoTarea}</b>
                              </span>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-3 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">${tareaPendiente[index].Titulo}</span>
                              </br>
                              <span style="text-transform: capitalice; font-size:10px;">${tareaPendiente[index].Descripcion}</span>
                            </div>
                            <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}
                            </div>
                            <div class="col-md-6 titulo" style="text-transform:capitalize; font-size:12px;">
                              <div class="badge badge-pill badge-secondary ml-auto">Sin Asignar</div>
                              </br>`
                +
                (parseInt(@Session["ID_QUEU"]) == tareaPendiente[index].IdQueu ?
                    `<select
                                    id_queue="${tareaPendiente[index].IdQueu}"
                                    style="margin-left:-7%"
                                    name="selectAsignar${tareaPendiente[index].IdTareaDetalle}"
                                    aria-haspopup="true"
                                    aria-expanded="false"
                                    data-toggle="dropdown"
                                    class="mb-2 mr-2 dropdown-toggle btn btn-link">
                                    </select>`
                    :
                    ``
                            )
            +
                `</div>
                            <div class="col-md-6"></div>
                            <div class="col-md-3 ml-auto" style="margin-left:-10px;">`
                +
                (parseInt(@Session["ID_QUEU"]) == tareaPendiente[index].IdQueu ?
                    `<button
                                    class="mb-2 mr-2 btn btn-primary"
                                    onclick="AsignarUsuarioParaTarea(${tareaPendiente[index].IdTareaDetalle})"
                                    type="submit"
                                    style="vertical-align: middle; float: right;">
                                        <i class="pe-7s-add-user" style="font-weight:900;"></i >
                                        Asignar
                              </button>`
                    :
                    ``
                            )
            +
                `</div>
                          </div>
                        </li>
                      `);
        }
    }
            });

    //Usuarios para asignacion
    //$.ajax({
    //    contentType: 'application/json; charset=utf-8',
    //    url: "/Home/ListaUsuariosPorCola",
    //    type: "Get",
    //    datatype: "json",
    //    cache: false,
    //    success: function (data) {
    //        console.log(data);
    //        $('[name^="selectAsignar"]').append(
    //            data.reduce((acc, value) => acc + `<option value="${value.ID_PERS_ENTI}" class="dropdown-item">${value.ASSI}</option>`, "")
    //        )
    //    },
    //    error: function () {
    //        toastr.danger("Ocurrió un Error", "Advertencia")
    //    }
    //});

    $('[name^="selectAsignar"]').each(function (index, el) {
        $.ajax({
            contentType: 'application/json; charset=utf-8',
            url: "/Home/ListaUsuariosPorCola/",
            data: { ID_QUEU: $(el).attr("id_queue") },
            type: "Get",
            datatype: "json",
            cache: false,
            success: function (data) {
                $(el).append(
                    data.reduce((acc, value) => acc + `<option value="${value.ID_PERS_ENTI}" class="dropdown-item">${value.ASSI}</option>`, "")
                )
            },
            error: function () {
                toastr.danger("Ocurrió un Error", "Advertencia")
            }
        });
    });

        } else {
        $(".ticketHijoIndex ul").append('<div class="smallField"> No se encontraron tareas pendientes');
    }



    }

    function tejerTareasPendientesContable(tareaPendiente) {
        tareasTemp = tareaPendiente;
        if (parseInt(tareaPendiente.length) > 0) {
            $.each(tareaPendiente, function (index, value) {
                if (tareaPendiente[index].Estado == 1) {
                    $(".ticketHijoIndex ul > .divListTMinsur").append(`
                        <div class="list-group-item">
                            <div class="todo-indicator bg-success"></div>
                            <div class="row">
                                <div class="col-md-12 titulo">
                                    <span style="text-transform: capitalice;font-size:12px; color:black;">
                                        <b>${tareaPendiente[index].CodigoTarea}</b>
                                    </span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 titulo">
                                    <span style="text-transform: capitalice;font-size:12px; color:black;">
                                        <del>${tareaPendiente[index].Titulo}</del>
                                    </span>
                                    </br>
                                    <span style="text-transform: capitalice; font-size:10px;">
                                        <del>Usuario SAP: ${tareaPendiente[index].UsuarioSAP}</del>
                                    </span>
                                    </br>
                                    <span style="text-transform: capitalice; font-size:10px;">
                                        <del>Grupo de Autorización: ${tareaPendiente[index].GrupoAutoriza}</del>
                                    </span>
                                    </br>
                                    <span style="text-transform: capitalice; font-size:10px;">
                                        <del>Desde: ${tareaPendiente[index].FechaDesde}</del>
                                    </span>
                                    </br>
                                    <span style="text-transform: capitalice; font-size:10px;">
                                        <del>Hasta: ${tareaPendiente[index].FechaHasta}</del>
                                    </span>
                                </div>
                                <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                                    <del><span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}</del>
                                </div>
                                <div class="col-md-3 titulo" style="text-transform:capitalize;font-size:10px; "> Realizado por: ${tareaPendiente[index].Usuario}</div>
                                <div class="col-md-2">
                                    <div class="badge badge-pill badge-success">Terminado <i class="fa fa-check"></i ></div>
                                </div>
                            </div>
                        </div>
                    `);
                } else if (tareaPendiente[index].Estado == 2) {
                    $(".ticketHijoIndex ul > .divListTMinsur").append(`
                        <div class="list-group-item">
                            <div class="todo-indicator bg-danger"></div>
                            <div class="row">
                                <div class="col-md-12 titulo">
                                    <span style="text-transform: capitalice;font-size:12px; color:black;">
                                        <b>${tareaPendiente[index].CodigoTarea}</b>
                                    </span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 titulo">
                                    <span style="text-transform: capitalice;font-size:12px; color:black;">
                                        <del>${tareaPendiente[index].Titulo}</del>
                                    </span>
                                    </br>
                                    <span style="text-transform: capitalice; font-size:10px;">
                                        <del>Usuario SAP: ${tareaPendiente[index].UsuarioSAP}</del>
                                    </span>
                                    </br>
                                    <span style="text-transform: capitalice; font-size:10px;">
                                        <del>Grupo de Autorización: ${tareaPendiente[index].GrupoAutoriza}</del>
                                    </span>
                                    </br>
                                    <span style="text-transform: capitalice; font-size:10px;">
                                        <del>Desde: ${tareaPendiente[index].FechaDesde}</del>
                                    </span>
                                    </br>
                                    <span style="text-transform: capitalice; font-size:10px;">
                                        <del>Hasta: ${tareaPendiente[index].FechaHasta}</del>
                                    </span>
                                </div>
                                <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                                    <del><span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}</del>
                                </div>
                                <div class="col-md-3 titulo" style="text-transform:capitalize;font-size:10px; "> Realizado por: ${tareaPendiente[index].Usuario}</div>
                                <div class="col-md-2">
                                    <div class="badge badge-danger ml-2">No procede</div>
                                </div>
                            </div>
                        </div>
                    `);
                } else if (tareaPendiente[index].Estado == 4) {
                    $(".ticketHijoIndex ul > .divListTMinsur").append(`
                        <div class="list-group-item tMinsurGuardarMasiva">
                          <div class="todo-indicator bg-warning"></div>
                          <div class="row">
                            <div class="col-md-12 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">
                                <b>${tareaPendiente[index].CodigoTarea}</b>
                              </span>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-3 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">${tareaPendiente[index].Titulo}</span>
                              </br>
                              <span style="text-transform: capitalice; font-size:10px;">Usuario SAP: ${tareaPendiente[index].UsuarioSAP}</span>
                              </br>
                              <span style="text-transform: capitalice; font-size:10px;">Grupo de Autorización: ${tareaPendiente[index].GrupoAutoriza}</span>
                              </br>
                              <span style="text-transform: capitalice; font-size:10px;">Desde: ${tareaPendiente[index].FechaDesde}</span>
                              </br>
                              <span style="text-transform: capitalice; font-size:10px;">Hasta: ${tareaPendiente[index].FechaHasta}</span>
                            </div>
                            <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}
                            </div>
                            <div class="col-md-6 titulo" style="text-transform:capitalize; font-size:12px;">
                              <div class="badge badge-pill badge-warning ml-auto">Pendiente</div>
                              </br>${tareaPendiente[index].Usuario} <i onclick="TransferirUsuarioTarea(${tareaPendiente[index].IdTareaDetalle},${tareaPendiente[index].IdQueu})" style="cursor:pointer" class="fa fa-pen" data-toggle="modal" data-target="#miModal"></i>
                            </div>
                            <div class="col-md-6" style="margin-left:-10px;">
                              <select data-idtareadetalle="${tareaPendiente[index].IdTareaDetalle}" id="selectGuardar${tareaPendiente[index].IdTareaDetalle}" aria-haspopup="true" aria-expanded="false" data-toggle="dropdown" class="mb-2 mr-2 dropdown-toggle btn btn-link gEstadoTMasiva">
                                <option class="dropdown-item">Procede</option>
                                <option class="dropdown-item">No Procede</option>
                              </select>
                              <div>
                                  <button class="mb-2 ml-4 btn btn-light active"  onclick="EditarTareaMasiva(${tareaPendiente[index].IdTareaDetalle})" data-toggle="modal" data-target="#miModal" style="vertical-align: middle;">
                                    <i class="pe-7s-pen" style="font-weight:900;"></i>
                                  </button>
                              </div>
                            </div>
                          </div>
                        </div>
                    `);
                }
            });
        } else {
            $(".ticketHijoIndex ul > .divCrearTMinsur").append(`<div id="formCrearTareaMinsur_0" class="mt-2"> <div class="form-row mr-3">
                <div class="col-md-10">
                </div>
                <div class="col-md-2">
                    <button type="button" class="close" onclick="EliminarFormTareaMinsur(0)">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
            </div>
            <div class="form-row mr-3">
                <div class="col-md-7">
                    <div class="form-group">
                        Usuario SAP <span style="color:red">*</span>
                        <input id="TContableUsuarioSAP_0" type="text" name="TContableUsuarioSAP" />
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="form-group">
                        Grupo de Autorización <span style="color:red">*</span>
                        <input id="TContableGrupoAutoriza_0" type="text" name="TContableGrupoAutoriza" />
                    </div>
                </div>
            </div>
            <div class="form-row mr-3">
                <div class="col-md-6">
                    <div class="form-group">
                        Desde <span style="color:red">*</span>
                        <input id="TContableFechaDesde_0" type="text" name="TContableFechaDesde" />
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        Hasta <span style="color:red">*</span>
                        <input id="TContableFechaHasta_0" type="text" name="TContableFechaHasta" />
                    </div>
                </div>
            </div> </div>`);

            $("#TContableUsuarioSAP_0").kendoComboBox({
                dataTextField: "Usuario",
                dataValueField: "ID_PERS_ENTI",
                dataSource: {
                    schema: {
                        data: "Data",
                        count: "Count"
                    },
                    transport: {
                        read: "/Tarea/ListarUsuariosSAPContable?var=" + Math.random()
                    }
                },
                filter: "contains",
            }).data("kendoComboBox");
            $("#TContableFechaDesde_0").kendoDateTimePicker({
                format: "dd/MM/yyyy HH:mm",
            });
            $("#TContableFechaHasta_0").kendoDateTimePicker({
                format: "dd/MM/yyyy HH:mm",
            });
            $("#TContableGrupoAutoriza_0").kendoComboBox({
                dataTextField: "Nombre",
                dataValueField: "Id",
                dataSource: {
                    schema: {
                        data: "Data",
                        count: "Count"
                    },
                    transport: {
                        read: "/Tarea/ListarGrupoAutorizaContable?var=" + Math.random()
                    }
                },
                filter: "contains",
            }).data("kendoComboBox");
        }
    }

    function tejerTareasPendientesMovil(tareaPendiente) {
        tareasTemp = tareaPendiente;
        if (parseInt(tareaPendiente.length) > 0) {
            $.each(tareaPendiente, function (index, value) {
                var monto = tareaPendiente[index].Monto + " " + tareaPendiente[index].Moneda;
                if (tareaPendiente[index].Estado == 1) {
                    $(".ticketHijoIndex ul > .divListTMinsur").append(`
                        <div class="list-group-item">
                            <div class="todo-indicator bg-success"></div>
                            <div class="row">
                                <div class="col-md-12 titulo">
                                    <span style="text-transform: capitalice;font-size:12px; color:black;">
                                        <b>${tareaPendiente[index].CodigoTarea}</b>
                                    </span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 titulo">
                                    <span style="text-transform: capitalice;font-size:12px; color:black;">
                                        <del>${tareaPendiente[index].Descripcion}</del>
                                    </span>
                                    </br>
                                    <span style="text-transform: capitalice; font-size:10px;">
                                        <del>Sede: ${tareaPendiente[index].SedeImputado}</del>
                                    </span>
                                    </br>
                                    <span style="text-transform: capitalice; font-size:10px;">
                                        <del>Monto: ${monto}</del>
                                    </span>
                                    </br>
                                    <span style="text-transform: capitalice; font-size:10px;">
                                        <del>Fecha: ${tareaPendiente[index].FechaEjecutada}</del>
                                    </span>
                                    </br>
                                    <span style="text-transform: capitalice; font-size:10px;">
                                        <del>CeCo: ${tareaPendiente[index].CeCoImputado}</del>
                                    </span>
                                    </br>
                                    <span style="text-transform: capitalice; font-size:10px;">
                                        <del>Partida: ${tareaPendiente[index].PartidaPresupuestal}</del>
                                    </span>
                                </div>
                                <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                                    <del><span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}</del>
                                </div>
                                <div class="col-md-3 titulo" style="text-transform:capitalize;font-size:10px; "> Realizado por: ${tareaPendiente[index].Usuario}</div>
                                <div class="col-md-2">
                                    <div class="badge badge-pill badge-success">Terminado <i class="fa fa-check"></i ></div>
                                </div>
                            </div>
                        </div>
                    `);
                } else if (tareaPendiente[index].Estado == 2) {
                    $(".ticketHijoIndex ul > .divListTMinsur").append(`
                        <div class="list-group-item">
                            <div class="todo-indicator bg-danger"></div>
                            <div class="row">
                                <div class="col-md-12 titulo">
                                    <span style="text-transform: capitalice;font-size:12px; color:black;">
                                        <b>${tareaPendiente[index].CodigoTarea}</b>
                                    </span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 titulo">
                                    <span style="text-transform: capitalice;font-size:12px; color:black;">
                                        <del>${tareaPendiente[index].Descripcion}</del>
                                    </span>
                                    </br>
                                    <span style="text-transform: capitalice; font-size:10px;">
                                        <del>Sede: ${tareaPendiente[index].SedeImputado}</del>
                                    </span>
                                    </br>
                                    <span style="text-transform: capitalice; font-size:10px;">
                                        <del>Monto: ${monto}</del>
                                    </span>
                                    </br>
                                    <span style="text-transform: capitalice; font-size:10px;">
                                        <del>Fecha: ${tareaPendiente[index].FechaEjecutada}</del>
                                    </span>
                                    </br>
                                    <span style="text-transform: capitalice; font-size:10px;">
                                        <del>CeCo: ${tareaPendiente[index].CeCoImputado}</del>
                                    </span>
                                    </br>
                                    <span style="text-transform: capitalice; font-size:10px;">
                                        <del>Partida: ${tareaPendiente[index].PartidaPresupuestal}</del>
                                    </span>
                                </div>
                                <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                                    <del><span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}</del>
                                </div>
                                <div class="col-md-3 titulo" style="text-transform:capitalize;font-size:10px; "> Realizado por: ${tareaPendiente[index].Usuario}</div>
                                <div class="col-md-2">
                                    <div class="badge badge-danger ml-2">No procede</div>
                                </div>
                            </div>
                        </div>
                    `);
                } else if (tareaPendiente[index].Estado == 4) {
                    $(".ticketHijoIndex ul > .divListTMinsur").append(`
                        <div class="list-group-item tMinsurGuardarMasiva">
                          <div class="todo-indicator bg-warning"></div>
                          <div class="row">
                            <div class="col-md-12 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">
                                <b>${tareaPendiente[index].CodigoTarea}</b>
                              </span>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-3 titulo">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">${tareaPendiente[index].Descripcion}</span>
                              </br>
                              <span style="text-transform: capitalice; font-size:10px;">Sede: ${tareaPendiente[index].SedeImputado}</span>
                              </br>
                              <span style="text-transform: capitalice; font-size:10px;">Monto: ${monto}</span>
                              </br>
                              <span style="text-transform: capitalice; font-size:10px;">Fecha: ${tareaPendiente[index].FechaEjecutada}</span>
                              </br>
                              <span style="text-transform: capitalice; font-size:10px;">CeCo: ${tareaPendiente[index].CeCoImputado}</span>
                              </br>
                              <span style="text-transform: capitalice; font-size:10px;">Partida: ${tareaPendiente[index].PartidaPresupuestal}</span>
                            </div>
                            <div class="col-md-3 titulo" style="text-transform:capitalize; font-size:12px;">
                              <span style="text-transform: capitalice;font-size:12px; color:black;">Area Responsable: </span>${tareaPendiente[index].AreaResponsable}
                            </div>
                            <div class="col-md-6 titulo" style="text-transform:capitalize; font-size:12px;">
                              <div class="badge badge-pill badge-warning ml-auto">Pendiente</div>
                              </br>${tareaPendiente[index].Usuario} <i onclick="TransferirUsuarioTarea(${tareaPendiente[index].IdTareaDetalle},${tareaPendiente[index].IdQueu})" style="cursor:pointer" class="fa fa-pen" data-toggle="modal" data-target="#miModal"></i>
                            </div>
                            <div class="col-md-6" style="margin-left:-10px;">
                              <select data-idtareadetalle="${tareaPendiente[index].IdTareaDetalle}" id="selectGuardar${tareaPendiente[index].IdTareaDetalle}" aria-haspopup="true" aria-expanded="false" data-toggle="dropdown" class="mb-2 mr-2 dropdown-toggle btn btn-link gEstadoTMasiva">
                                <option class="dropdown-item">Procede</option>
                                <option class="dropdown-item">No Procede</option>
                              </select>
                              <div>
                                  <button class="mb-2 ml-4 btn btn-light active"  onclick="EditarTareaMasiva(${tareaPendiente[index].IdTareaDetalle})" data-toggle="modal" data-target="#miModal" style="vertical-align: middle;">
                                    <i class="pe-7s-pen" style="font-weight:900;"></i>
                                  </button>
                              </div>
                            </div>
                          </div>
                        </div>
                    `);
                }
            });
        } else {
            $(".ticketHijoIndex ul > .divCrearTMinsur").append(`<div id="formCrearTareaMinsur_0"> <div class="form-row mr-3">
                <div class="col-md-6">
                    <div class="form-group">
                        Tipo de Servicio<span style="color:red">*</span>
                        <input id="TipoServicio_0" type="text" name="TipoServicio" />
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        Moneda<span style="color:red">*</span>
                        <input id="Moneda_0" type="text" name="Moneda" />
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-row">
                        <div class="col-md-10">
                            <div class="form-group">
                                Monto<span style="color:red">*</span>
                                <input id="Monto_0" type="text" name="Monto" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="close" onclick="EliminarFormTareaMinsur(0)">
                                <span aria-hidden="true">×</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-row mr-3">
                <div class="col-md-6">
                    <div class="form-group">
                        Sede Imputado<span style="color:red">*</span>
                        <input id="SedeImputado_0" type="text" name="SedeImputado" />
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        CeCo Imputado
                        <input id="CeCoImputado_0" type="text" name="CeCoImputado" class="k-textbox" style="width:100%; height:30px;" />
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        Partida Presupuestal
                        <input id="PartidaPresupuestal_0" type="text" name="PartidaPresupuestal" class="k-textbox" style="width:100%; height:30px;" />
                    </div>
                </div>
            </div>
            <div class="form-row mr-3">
                <div class="col-md-6">
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        Fecha Ejecutada<span style="color:red">*</span>
                        <input id="FechaEjecutada_0" type="text" name="FechaEjecutada" />
                    </div>
                </div>
            </div> </div>`);

            $("#SedeImputado_0").kendoComboBox({
                dataTextField: "Nombre",
                dataValueField: "Id",
                dataSource: {
                    schema: {
                        data: "Data"
                    },
                    transport: {
                        read: "/Ticket/ListarTareaMovilSedes?var=" + Math.random()
                    }
                },
                filter: "contains",
            }).data("kendoComboBox");
            $("#TipoServicio_0").kendoComboBox({
                dataTextField: "Nombre",
                dataValueField: "Id",
                dataSource: {
                    schema: {
                        data: "Data"
                    },
                    transport: {
                        read: "/Ticket/ListarTareaMovilTipo?var=" + Math.random()
                    }
                },
                filter: "contains",
            }).data("kendoComboBox");
            $("#FechaEjecutada_0").kendoDateTimePicker({
                format: "dd/MM/yyyy HH:mm",
            });
            $("#Moneda_0").kendoComboBox({
                dataTextField: "text",
                dataValueField: "value",
                dataSource: [{
                    text: "PEN",
                    value: "1"
                }, {
                    text: "USD",
                    value: "2"
                }],
                filter: "contains",
            }).data("kendoComboBox");
            $("#Monto_0").kendoNumericTextBox({
                format: "n2",
                decimals: 2,
                spinners: false
            });
        }
    }

    function AgregarFormTareaMinsur(idCate) {
        var i = $(".ticketHijoIndex ul .divCrearTMinsur > div").length;

        if (idCate == 27158 || idCate == 28529 || idCate == 29900) {
            FormTareaMovil(i);
        }
        else if (idCate == 32465 || idCate == 32466) {
            FormTareaContable(i);
        }
    }

    function FormTareaContable(i) {
        $(".ticketHijoIndex ul > .divCrearTMinsur").append(`<div id="formCrearTareaMinsur_${i}" class="mt-2"> <div class="form-row mr-3">
                <div class="col-md-10">
                </div>
                <div class="col-md-2">
                    <button type="button" class="close" onclick="EliminarFormTareaMinsur(${i})">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
            </div>
            <div class="form-row mr-3">
                <div class="col-md-7">
                    <div class="form-group">
                        Usuario SAP <span style="color:red">*</span>
                        <input id="TContableUsuarioSAP_${i}" type="text" name="TContableUsuarioSAP" />
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="form-group">
                        Grupo de Autorización <span style="color:red">*</span>
                        <input id="TContableGrupoAutoriza_${i}" type="text" name="TContableGrupoAutoriza" />
                    </div>
                </div>
            </div>
            <div class="form-row mr-3">
                <div class="col-md-6">
                    <div class="form-group">
                        Desde <span style="color:red">*</span>
                        <input id="TContableFechaDesde_${i}" type="text" name="TContableFechaDesde" />
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        Hasta <span style="color:red">*</span>
                        <input id="TContableFechaHasta_${i}" type="text" name="TContableFechaHasta" />
                    </div>
                </div>
            </div> </div>`);

        $("#TContableUsuarioSAP_" + i).kendoComboBox({
            dataTextField: "Usuario",
            dataValueField: "ID_PERS_ENTI",
            dataSource: {
                schema: {
                    data: "Data",
                    count: "Count"
                },
                transport: {
                    read: "/Tarea/ListarUsuariosSAPContable?var=" + Math.random()
                }
            },
            filter: "contains",
        }).data("kendoComboBox");
        $("#TContableFechaDesde_" + i).kendoDateTimePicker({
            format: "dd/MM/yyyy HH:mm",
        });
        $("#TContableFechaHasta_" + i).kendoDateTimePicker({
            format: "dd/MM/yyyy HH:mm",
        });
        $("#TContableGrupoAutoriza_" + i).kendoComboBox({
            dataTextField: "Nombre",
            dataValueField: "Id",
            dataSource: {
                schema: {
                    data: "Data",
                    count: "Count"
                },
                transport: {
                    read: "/Tarea/ListarGrupoAutorizaContable?var=" + Math.random()
                }
            },
            filter: "contains",
        }).data("kendoComboBox");
    }

    function FormTareaMovil(i) {
        $(".ticketHijoIndex ul > .divCrearTMinsur").append(`<div id="formCrearTareaMinsur_${i}" class="mt-4"> <div class="form-row mr-3">
                <div class="col-md-6">
                    <div class="form-group">
                        Tipo de Servicio<span style="color:red">*</span>
                        <input id="TipoServicio_${i}" type="text" name="TipoServicio" />
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        Moneda<span style="color:red">*</span>
                        <input id="Moneda_${i}" type="text" name="Moneda" />
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-row">
                        <div class="col-md-10">
                            <div class="form-group">
                                Monto<span style="color:red">*</span>
                                <input id="Monto_${i}" type="text" name="Monto" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="close" onclick="EliminarFormTareaMinsur(${i})">
                                <span aria-hidden="true">×</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-row mr-3">
                <div class="col-md-6">
                    <div class="form-group">
                        Sede Imputado<span style="color:red">*</span>
                        <input id="SedeImputado_${i}" type="text" name="SedeImputado" />
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        CeCo Imputado
                        <input id="CeCoImputado_${i}" type="text" name="CeCoImputado" class="k-textbox" style="width:100%; height:30px;" />
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        Partida Presupuestal
                        <input id="PartidaPresupuestal_${i}" type="text" name="PartidaPresupuestal" class="k-textbox" style="width:100%; height:30px;" />
                    </div>
                </div>
            </div>
            <div class="form-row mr-3">
                <div class="col-md-6">
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        Fecha Ejecutada<span style="color:red">*</span>
                        <input id="FechaEjecutada_${i}" type="text" name="FechaEjecutada" />
                    </div>
                </div>
            </div> </div>`);

        $("#SedeImputado_" + i).kendoComboBox({
            dataTextField: "Nombre",
            dataValueField: "Id",
            dataSource: {
                schema: {
                    data: "Data"
                },
                transport: {
                    read: "/Ticket/ListarTareaMovilSedes?var=" + Math.random()
                }
            },
            filter: "contains",
        }).data("kendoComboBox");
        $("#TipoServicio_" + i).kendoComboBox({
            dataTextField: "Nombre",
            dataValueField: "Id",
            dataSource: {
                schema: {
                    data: "Data"
                },
                transport: {
                    read: "/Ticket/ListarTareaMovilTipo?var=" + Math.random()
                }
            },
            filter: "contains",
        }).data("kendoComboBox");
        $("#FechaEjecutada_" + i).kendoDateTimePicker({
            format: "dd/MM/yyyy HH:mm",
        });
        $("#Moneda_" + i).kendoComboBox({
            dataTextField: "text",
            dataValueField: "value",
            dataSource: [{
                text: "PEN",
                value: "1"
            }, {
                text: "USD",
                value: "2"
            }],
            filter: "contains",
        }).data("kendoComboBox");
        $("#Monto_" + i).kendoNumericTextBox({
            format: "n2",
            decimals: 2,
            spinners: false
        });
    }

    function CrearTareasMasivas(idCate) {
        var tareasMasivas = [];

        $(".ticketHijoIndex ul .divCrearTMinsur > div").each(function (index) {

            if (idCate == 27158 || idCate == 28529 || idCate == 29900) {
                var sedeImputado = $(this).find("input[name='SedeImputado']").val();
                var moneda = $(this).find("input[name='Moneda']").val();
                var monto = $(this).find("input[name='Monto']").val();
                var ceCoImputado = $(this).find("input[name='CeCoImputado']").val();
                var partidaPresupuestal = $(this).find("input[name='PartidaPresupuestal']").val();
                var tipoServicio = $(this).find("input[name='TipoServicio']").val();
                var fechaEjecutada = $(this).find("input[name='FechaEjecutada']").val();

                if (tipoServicio && moneda && monto && sedeImputado && fechaEjecutada) {
                    var fechaEjecutadaISO = ConvertirAFechaTarea(fechaEjecutada);

                    var formulario = {
                        IdSedeImpu: sedeImputado,
                        IdMoneda: moneda,
                        Monto: monto,
                        CeCoImpu: ceCoImputado,
                        PartPresup: partidaPresupuestal,
                        IdTarea: tipoServicio,
                        FechaEjecutada: fechaEjecutadaISO
                    };
                    tareasMasivas.push(formulario);

                    $(this).addClass("creadaT");
                }

            }
            else if (idCate == 32465 || idCate == 32466) {
                var usuarioSAP = $(this).find("input[name='TContableUsuarioSAP']").val();
                var grupoAutoriza = $(this).find("input[name='TContableGrupoAutoriza']").val();
                var desde = $(this).find("input[name='TContableFechaDesde']").val();
                var hasta = $(this).find("input[name='TContableFechaHasta']").val();

                if (usuarioSAP && grupoAutoriza && desde && hasta) {
                    var fechaDesdeISO = ConvertirAFechaTarea(desde);
                    var fechaHastaISO = ConvertirAFechaTarea(hasta);

                    var formulario = {
                        IdUsuarioSap: usuarioSAP,
                        IdGrupoAutoriza: grupoAutoriza,
                        FechaDesde: fechaDesdeISO,
                        FechaEjecutada: fechaHastaISO
                    };
                    tareasMasivas.push(formulario);

                    $(this).addClass("creadaT");
                }
            }

        });

        if (tareasMasivas.length > 0) {
            swal({
                title: `¿Deseas crear estas tareas?`,
                text: `Se crearán las tareas con todos los campos obligatorios llenos`,
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Guardar",
                cancelButtonText: "Cancel",
                closeOnConfirm: false,
                closeOnCancel: false
            }, function (dismiss) {
                if (dismiss) {
                    $.ajax({
                        url: '/Tarea/CrearTareasMasivas?idTicket=' + idTicket,
                        type: 'POST',
                        data: JSON.stringify(tareasMasivas),
                        contentType: "application/json",
                        success: function (response) {
                            if (response.message == 'OK') {
                                idSetTimeout = setTimeout(function (element) {
                                    $(".ticketHijoIndex ul > .divListTMinsur").html('');

                                    $.ajax({
                                        contentType: 'application/json; charset=utf-8',
                                        url: "/Ticket/ListarTareasPendientes",
                                        type: "Get",
                                        data: { idTicket: idTicket },
                                        datatype: "json",
                                        cache: false,
                                        success: function (data) {
                                            if (data) {
                                                if (idCate == 27158 || idCate == 28529 || idCate == 29900) {
                                                    tejerTareasPendientesMovil(data["tareaPendiente"]);

                                                } else if (idCate == 32465 || idCate == 32466) {
                                                    tejerTareasPendientesContable(data["tareaPendiente"]);
                                                }

                                                swal.close();
                                            }
                                        }
                                    });
                                }, 2000, $(this));

                                if ($(".ticketHijoIndex ul .divCrearTMinsur > div:not(.creadaT)").length == 0) {
                                    $(".ticketHijoIndex ul > .divCrearTMinsur").html('');

                                    swal({
                                        title: 'Se crearon las tareas',
                                        type: 'success',
                                        text: 'Todas las tareas han sido creadas',
                                        confirmButtonColor: "#DD6B55",
                                        focusConfirm: false,
                                        confirmButtonText:
                                            'Continue',
                                        confirmButtonAriaLabel: 'Thumbs up, great!'
                                    });
                                } else {
                                    swal({
                                        title: 'Quedan tareas por crear',
                                        type: 'info',
                                        text: 'COMPLETE LOS CAMPOS OBLIGATORIOS',
                                        confirmButtonColor: "#DD6B55",
                                        focusConfirm: false,
                                        confirmButtonText: 'Continue',
                                        confirmButtonAriaLabel: 'Thumbs up, great!'
                                    })
                                    $(".ticketHijoIndex ul .divCrearTMinsur > div.creadaT").remove();
                                }
                            }
                            else {
                                swal({
                                    title: 'Warning',
                                    type: 'info',
                                    text: 'ERROR EN LA CREACIÓN',
                                    confirmButtonColor: "#DD6B55",
                                    focusConfirm: false,
                                    confirmButtonText: 'Continue',
                                    confirmButtonAriaLabel: 'Thumbs up, great!'
                                })
                            }
                        }
                    });
                }
                else {
                    swal("Cancelado", "Ha cancelado la creación", "error");
                }
            });
        } else {
            toastr.warning("Ninguna tarea para crear", "No hay tareas disponibles");
        }
    }

    function ConvertirAFechaTarea(fechaInicial) {
        var fechaHora = fechaInicial.split(' ');
        var fecha = fechaHora[0].split('/');
        var hora = fechaHora[1].split(':');

        var fechaConvertida = new Date(
            parseInt(fecha[2], 10),
            parseInt(fecha[1], 10) - 1,
            parseInt(fecha[0], 10),
            parseInt(hora[0], 10),
            parseInt(hora[1], 10)
        );

        return fechaConvertida.toISOString();
    }

    function EliminarFormTareaMinsur(index) {
        $("#formCrearTareaMinsur_" + index).remove();
    }

    function MostrarAlertTMasivas() {
        if ($(".ticketHijoIndex .divListTMinsur .tMinsurGuardarMasiva select.gEstadoTMasiva").length > 0) {
            $("#alertaMinsurTMasiva").show();
        } else {
            toastr.warning("Ninguna tarea para guardar", "No hay tareas disponibles");
        }
    }

    function GuardarTMasivasRealizadas(idCate) {
        var estadosTMasivas = [];
        $("#alertaMovil").hide();

        $(".ticketHijoIndex .divListTMinsur .tMinsurGuardarMasiva select.gEstadoTMasiva").each(function (index) {
            var idTareaDetalle = $(this).data("idtareadetalle");
            var estado = $(this).val();

            var data = {
                IdTareaDetalle: idTareaDetalle,
                Estado: estado
            };
            estadosTMasivas.push(data);
        });

        if (estadosTMasivas.length > 0) {
            $.ajax({
                url: '/Tarea/GuardarEstadoTareasMasivas',
                type: 'POST',
                data: JSON.stringify(estadosTMasivas),
                contentType: "application/json",
                success: function (response) {
                    if (response.message == 'OK') {
                        swal({
                            title: `¿Desea cerrar el ticket?`,
                            text: `Se cambiará el estado del ticket a 'Resuelto'`,
                            type: "warning",
                            showCancelButton: true,
                            confirmButtonColor: "#DD6B55",
                            confirmButtonText: "Guardar",
                            cancelButtonText: "Cancel",
                            closeOnConfirm: false,
                            closeOnCancel: false
                        }, function (dismiss) {
                            if (dismiss) {
                                $.ajax({
                                    url: '/Tarea/CerrarTicket?idTicket=' + idTicket,
                                    type: 'POST',
                                    success: function (response) {
                                        if (response.message == 'OK') {
                                            swal({
                                                title: 'Guardando',
                                                type: 'success',
                                                text: 'Registro exitoso',
                                                confirmButtonColor: "#DD6B55",
                                                focusConfirm: false,
                                                confirmButtonText:
                                                    'Continue',
                                                confirmButtonAriaLabel: 'Thumbs up, great!'

                                            }, function (confirm) {
                                                if (confirm) {
                                                    location.reload()
                                                }
                                            });
                                        } else if (response.message == 'ERROR') {
                                            swal({
                                                title: 'Warning',
                                                type: 'info',
                                                text: 'ERROR EN EL CIERRE DEL TICKET',
                                                confirmButtonColor: "#DD6B55",
                                                focusConfirm: false,
                                                confirmButtonText: 'Continue',
                                                confirmButtonAriaLabel: 'Thumbs up, great!'
                                            })
                                        }
                                    }
                                });
                            }
                            else {
                                $("#alertaMinsurTMasiva").hide();
                                idSetTimeout = setTimeout(function (element) {
                                    $(".ticketHijoIndex ul > .divListTMinsur").html('');

                                    $.ajax({
                                        contentType: 'application/json; charset=utf-8',
                                        url: "/Ticket/ListarTareasPendientes",
                                        type: "Get",
                                        data: { idTicket: idTicket },
                                        datatype: "json",
                                        cache: false,
                                        success: function (data) {
                                            if (data) {
                                                if (idCate == 27158 || idCate == 28529 || idCate == 29900) {
                                                    tejerTareasPendientesMovil(data["tareaPendiente"]);

                                                } else if (idCate == 32465 || idCate == 32466) {
                                                    tejerTareasPendientesContable(data["tareaPendiente"]);
                                                }

                                                swal.close();
                                            }
                                        }
                                    });
                                }, 2000, $(this));
                            }
                        });
                    } else if (response.message == 'ERROR') {
                        swal({
                            title: 'Warning',
                            type: 'info',
                            text: 'ERROR EN EL GUARDADO',
                            confirmButtonColor: "#DD6B55",
                            focusConfirm: false,
                            confirmButtonText: 'Continue',
                            confirmButtonAriaLabel: 'Thumbs up, great!'
                        })
                    }
                }
            });
        } else {
            toastr.warning("Ninguna tarea para guardar", "No hay tareas disponibles");
        }
    }

    function GuardarTareaRealizada(id, descripcion) {
        event.preventDefault();

        var url = "/Ticket/CrearTareaRealizada/";
        var estado = $('#select' + id + '').val();
        var descripcion = descripcion;
        var idticket = "@ViewBag.ID_TICK";
        var data = { id: id, descripcion: descripcion, idticket: idticket, estado: estado };

        @*if ((descripcion == 'Registro de licencia Mcafee/ EDR/ SCCM' || descripcion == 'Registro de licencia Absolute' || descripcion == 'Eliminacón de Licencia Mcafee / EDR / SCCM') && @ViewBag.ID_QUEU_TAREA == 1 ) {

            $("#COM_DETA_TICK").data('kendoEditor').value("Serie del equipo:</br></br>"
                + "Hostname:</br></br>"
                + "Ip:");
            swal({
                title: "¡NO OLVIDES COMENTAR EL TICKET DEBIDAMENTE PARA QUE LA OPERACIÓN PUEDA CONTINUAR CON EL DEBIDO PROCESO.!",
                text: "EN CASO DE NO DOCUMENTAR, NOS VEREMOS OBLIGADOS A PROCEDER CON UNA AMONESTACIÓN.",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Guardar",
                cancelButtonText: "Cancel",
                closeOnConfirm: false,
                closeOnCancel: false
            }, function (dismiss) {
                if (dismiss) {
                    swal({
                        title: "¿Deseas guardar esta actividad?",
                        text: "¡Verifique la información antes de enviar!",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "Guardar",
                        cancelButtonText: "Cancel",
                        closeOnConfirm: false,
                        closeOnCancel: false
                    }, function (dismiss) {
                        if (dismiss) {
                            $.ajax({
                                url: url,
                                data: data,
                                type: "POST",
                                cache: false,
                                dataType: "text",
                                success: function (resp) {
                                    if (resp == "OK") {

                                        idSetTimeout = setTimeout(function (element) {
                                            $(".ticketHijoIndex ul").html('');

                                            $.ajax({
                                                contentType: 'application/json; charset=utf-8',
                                                url: "/Ticket/ListarTareasPendientes",
                                                type: "Get",
                                                data: { idTicket: idTicket },
                                                datatype: "json",
                                                cache: false,

                                                success: function (data) {

                                                    if (data) {
                                                        tejerTareasPendientes(data["tareaPendiente"]);

                                                        swal.close();
                                                    }
                                                },
                                                error: function () {
                                                    //Crear_Failed()
                                                }
                                            });
                                        }, 2000, $(this));

                                        swal({
                                            title: 'Guardando',
                                            type: 'success',
                                            text: 'Registro exitoso',
                                            confirmButtonColor: "#DD6B55",
                                            focusConfirm: false,
                                            confirmButtonText:
                                                'Continue',
                                            confirmButtonAriaLabel: 'Thumbs up, great!'

                                        });


                                    } else if (resp == "REFRESH") {
                                        swal({
                                            title: 'Guardando',
                                            type: 'success',
                                            text: 'Registro exitoso',
                                            confirmButtonColor: "#DD6B55",
                                            focusConfirm: false,
                                            confirmButtonText:
                                                'Continue',
                                            confirmButtonAriaLabel: 'Thumbs up, great!'

                                        }, function (confirm) {
                                            if (confirm) {
                                                location.reload()
                                            }
                                        });
                                    } else if (resp == "ERROR") {

                                        //alert("The survey was sent");
                                        swal({
                                            title: 'Warning',
                                            type: 'info',
                                            text: 'ERROR EN EL REGISTRO',
                                            confirmButtonColor: "#DD6B55",
                                            focusConfirm: false,
                                            confirmButtonText:
                                                'Continue',
                                            confirmButtonAriaLabel: 'Thumbs up, great!'

                                        });

                                    }
                                    else {
                                        alert(resp);

                                    }
                                }
                            });

                        }
                        else {
                            swal("Cancelado", "Ha cancelado el envío de la información", "error");
                        }
                    });
                } else {
                    swal("Cancelado", "Ha cancelado el envío de la información", "error");
                }
            });



        } else {
            swal({
                title: "¿Deseas guardar esta actividad?",
                text: "¡Verifique la información antes de enviar!",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Guardar",
                cancelButtonText: "Cancel",
                closeOnConfirm: false,
                closeOnCancel: false
            }, function (dismiss) {
                if (dismiss) {
                    $.ajax({
                        url: url,
                        data: data,
                        type: "POST",
                        cache: false,
                        dataType: "text",
                        success: function (resp) {
                            if (resp == "OK") {
                                idSetTimeout = setTimeout(function (element) {
                                    $(".ticketHijoIndex ul").html('');

                                    $.ajax({
                                        contentType: 'application/json; charset=utf-8',
                                        url: "/Ticket/ListarTareasPendientes",
                                        type: "Get",
                                        data: { idTicket: idTicket },
                                        datatype: "json",
                                        cache: false,

                                        success: function (data) {

                                            if (data) {
                                                tejerTareasPendientes(data["tareaPendiente"]);

                                                swal.close();
                                            }
                                        },
                                        error: function () {
                                            //Crear_Failed()
                                        }
                                    });
                                }, 2000, $(this));

                                swal({
                                    title: 'Guardando',
                                    type: 'success',
                                    text: 'Registro exitoso',
                                    confirmButtonColor: "#DD6B55",
                                    focusConfirm: false,
                                    confirmButtonText:
                                        'Continue',
                                    confirmButtonAriaLabel: 'Thumbs up, great!'

                                });
                            }
                            else if (resp == "REFRESH") {
                                swal({
                                    title: 'Guardando',
                                    type: 'success',
                                    text: 'Registro exitoso',
                                    confirmButtonColor: "#DD6B55",
                                    focusConfirm: false,
                                    confirmButtonText:
                                        'Continue',
                                    confirmButtonAriaLabel: 'Thumbs up, great!'

                                }, function (confirm) {
                                    if (confirm) {
                                        location.reload()
                                    }
                                });
                            } else if (resp == "ERROR") {

                                //alert("The survey was sent");
                                swal({
                                    title: 'Warning',
                                    type: 'info',
                                    text: 'ERROR EN EL REGISTRO',
                                    confirmButtonColor: "#DD6B55",
                                    focusConfirm: false,
                                    confirmButtonText:
                                        'Continue',
                                    confirmButtonAriaLabel: 'Thumbs up, great!'

                                })


                            }
                            else {
                                alert(resp);

                            }
                        }
                    });

                }
                else {
                    swal("Cancelado", "Ha cancelado el envío de la información", "error");
                }

            });

        }*@

        swal({
            title: "¿Deseas guardar esta actividad?",
            text: "¡Verifique la información antes de enviar!",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Guardar",
            cancelButtonText: "Cancel",
            closeOnConfirm: false,
            closeOnCancel: false
        }, function (dismiss) {
            if (dismiss) {
                $.ajax({
                    url: url,
                    data: data,
                    type: "POST",
                    cache: false,
                    dataType: "text",
                    success: function (resp) {
                        if (resp == "OK") {
                            idSetTimeout = setTimeout(function (element) {
                                $(".ticketHijoIndex ul").html('');

                                $.ajax({
                                    contentType: 'application/json; charset=utf-8',
                                    url: "/Ticket/ListarTareasPendientes",
                                    type: "Get",
                                    data: { idTicket: idTicket },
                                    datatype: "json",
                                    cache: false,

                                    success: function (data) {

                                        if (data) {
                                            tejerTareasPendientes(data["tareaPendiente"]);

                                            swal.close();
                                        }
                                    },
                                    error: function () {
                                        //Crear_Failed()
                                    }
                                });
                            }, 2000, $(this));

                            swal({
                                title: 'Guardando',
                                type: 'success',
                                text: 'Registro exitoso',
                                confirmButtonColor: "#DD6B55",
                                focusConfirm: false,
                                confirmButtonText:
                                    'Continue',
                                confirmButtonAriaLabel: 'Thumbs up, great!'

                            });
                        }
                        else if (resp == "REFRESH") {
                            swal({
                                title: 'Guardando',
                                type: 'success',
                                text: 'Registro exitoso',
                                confirmButtonColor: "#DD6B55",
                                focusConfirm: false,
                                confirmButtonText:
                                    'Continue',
                                confirmButtonAriaLabel: 'Thumbs up, great!'

                            }, function (confirm) {
                                if (confirm) {
                                    location.reload()
                                }
                            });
                        } else if (resp == "ERROR") {

                            //alert("The survey was sent");
                            swal({
                                title: 'Warning',
                                type: 'info',
                                text: 'ERROR EN EL REGISTRO',
                                confirmButtonColor: "#DD6B55",
                                focusConfirm: false,
                                confirmButtonText:
                                    'Continue',
                                confirmButtonAriaLabel: 'Thumbs up, great!'

                            })


                        }
                        else {
                            alert(resp);

                        }
                    }
                });

            }
            else {
                swal("Cancelado", "Ha cancelado el envío de la información", "error");
            }

        });

    }

    function AsignarUsuarioParaTarea(id) {
        event.preventDefault();

        var url = "/Ticket/AsignarTarea/";
        var usuario = $(`[name="selectAsignar${id}"]`).find(':selected').val();
        var descripcion = descripcion;
        var idticket = "@ViewBag.ID_TICK";
        var data = { id: id, idticket: idticket, descripcion: descripcion, usuario: usuario };

        swal({
            title: `¿Deseas asignar esta actividad?`,
            text: `Se asignará la actividad al usuario(a): ${$(`[name="selectAsignar${id}"]`).find(':selected').text()}`,
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Guardar",
            cancelButtonText: "Cancel",
            closeOnConfirm: false,
            closeOnCancel: false
        }, function (dismiss) {
            if (dismiss) {
                $.ajax({
                    url: url,
                    data: data,
                    type: "POST",
                    cache: false,
                    dataType: "text",
                    success: function (resp) {
                        if (resp == "OK") {
                            idSetTimeout = setTimeout(function (element) {
                                $(".ticketHijoIndex ul").html('');

                                $.ajax({
                                    contentType: 'application/json; charset=utf-8',
                                    url: "/Ticket/ListarTareasPendientes",
                                    type: "Get",
                                    data: { idTicket: idTicket },
                                    datatype: "json",
                                    cache: false,

                                    success: function (data) {

                                        if (data) {
                                            if ('@ViewBag.ID_CATE_MOVIL' != 27158 && '@ViewBag.ID_CATE_MOVIL' != 28529 && '@ViewBag.ID_CATE_MOVIL' != 29900) {
                                                tejerTareasPendientes(data["tareaPendiente"]);
                                            } else {
                                                tejerTareasPendientesMovil(data["tareaPendiente"]);
                                            }

                                            swal.close();
                                        }
                                    },
                                    error: function () {
                                        //Crear_Failed()
                                    }
                                });
                            }, 2000, $(this));

                            swal({
                                title: 'Guardando',
                                type: 'success',
                                text: 'Registro exitoso',
                                confirmButtonColor: "#DD6B55",
                                focusConfirm: false,
                                confirmButtonText:
                                    'Continue',
                                confirmButtonAriaLabel: 'Thumbs up, great!'

                            });

                        } else if (resp == "ERROR") {

                            //alert("The survey was sent");
                            swal({
                                title: 'Warning',
                                type: 'info',
                                text: 'ERROR EN EL REGISTRO',
                                confirmButtonColor: "#DD6B55",
                                focusConfirm: false,
                                confirmButtonText:
                                    'Continue',
                                confirmButtonAriaLabel: 'Thumbs up, great!'

                            })


                        }
                        else {
                            alert(Error);

                        }
                    }
                });

            }
            else {
                swal("Cancelado", "Ha cancelado la asignación", "error");
            }

        });

    }

    function TransferirTareaParaUsuario(id, idqueu, descripcion, movil) {
        $("#lblTitulo").text("Transferir Tarea");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-md");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-md");

        $('#modal-content').empty();
        $('#modal-content').load("/Ticket/viewTransferirTarea", { id: id, idqueu: idqueu, movil: movil });
    }

    function ImportarTareasMinsur(idCate) {
        $("#lblTitulo").text("Importar Tareas");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-md");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-lg");

        $('#modal-content').empty();

        if (idCate == 27158 || idCate == 28529 || idCate == 29900) {
            $('#modal-content').load("/Ticket/viewImportarTareasMovil");
        } else {
            $('#modal-content').load("/Tarea/ImportarTareasMinsur?idCate=" + idCate + "&idTick=@ViewBag.ID_TICK");
        }
    }

    function EditarTareaMasiva(id) {
        $("#lblTitulo").text("Editar Tarea");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-md");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-lg");

        $('#modal-content').empty();

        if ('@ViewBag.ID_CATE_MINSUR' == 27158 || '@ViewBag.ID_CATE_MINSUR' == 28529 || '@ViewBag.ID_CATE_MINSUR' == 29900) {
            $('#modal-content').load("/Ticket/viewEditarTareaMovil", { id: id });
        } else {
            $('#modal-content').load("/Tarea/EditarTareaMinsur", { id: id, idCate: @ViewBag.ID_CATE_MINSUR });
        }
    }

    /*################################################################## GCR161203 #######################################################################################*/
    function tejerTicket(tickets) {
        if (parseInt(tickets.length) > 0) {
            $.each(tickets, function (index, value) {

                $(".tickets ul").append('<li><div class="row"><div class="col-md-6 titulo"><a target="_blank" href="/DetailsTicket/Index/' + tickets[index].idTicket + '"' + ' style="text-decoration:none;"><span class="glyphicon glyphicon-play" aria-hidden="true"></span>' +
                    '<span>' + tickets[index].nombreCategoria + '</span></a></div>' +
                    '</div>' +
                    '<div class="row"> <div class="col-md-12">' +
                    ' <span style="display: inline-block; font-size: 11px;margin-left:14px; ">' + tickets[index].ComentarioTicket + '</span></div></div><div class="rayaItms"></div></li>');
            });
        } else {
            $(".lecciones ul").append('<div class="smallField">No se encontraron Lecciones aprendidas vinculadas');
        }
    }
    /*################################################################## GCR161203 #######################################################################################*/
    function Crear_Failed() {
        swal("¡Error al intentar obtener información!", "Cierre de Tickets", "error");
    }
    /*################################################################## GCR161203 #######################################################################################*/
    function startChange() {
        var startDate = time_from.value(),
            endDate = time_to.value();

        if (startDate) {
            startDate = new Date(startDate);
            startDate.setDate(startDate.getDate());
            time_to.min(startDate);
        } else if (endDate) {
            time_from.max(new Date(endDate));
        } else {
            endDate = new Date();
            time_from.max(endDate);
            time_to.min(endDate);
        }
    }

    function endChange() {
        var endDate = time_to.value(),
            startDate = time_from.value();

        if (endDate) {
            endDate = new Date(endDate);
            endDate.setDate(endDate.getDate());
            time_from.max(endDate);
        } else if (startDate) {
            time_to.min(new Date(startDate));
        } else {
            endDate = new Date();
            time_from.max(endDate);
            time_to.min(endDate);
        }
    }

    time_from.max(time_to.value());
    time_to.max(time_to.value());
    //time_to.min(time_from.value());

    jQuery('#IDPLAN').on('change', function () {

        $.ajax({
            url: '/Plantilla/ObtenerDescripcionPlantilla/',
            data: { IdGrupo: $("#IDGRUPO").val(), IdPlan: $("#IDPLAN").val() },
            type: 'GET',
            dataType: 'text',
            success: function (data) {


                $("#COM_DETA_TICK").data('kendoEditor').value(data);
                //alert(data);
                //jQuery("#SUM_TICK").data('kendoEditor').value(data);

            },
            error: function (data) {
            },
        });
    });

    var IDGRUPO = $("#IDGRUPO").kendoComboBox({
        autoBind: true,
        dataTextField: "NOMBRE",
        dataValueField: "IDGRUPO",
        //placeholder: "Seleccione un grupo",
        filter: "contains",
        delay: 500,
        minLength: 0,
        suggest: true,
        dataSource: {
            schema: {
                data: "Data",
                total: "Count"
            },
            transport: {
                read: "/Grupo/ListarCboGrupoCuentaEstado?ID_ACCO=" + @Session["ID_ACCO"] + "&var=" + Math.random()
                }
            }
        }).data("kendoComboBox");


    var IDPLAN = $("#IDPLAN").kendoComboBox({
        autoBind: true,
        cascadeFrom: "IDGRUPO",
        /*placeholder: "",*/
        dataTextField: "NOMBRE",
        dataValueField: "ID_PLAN",
        filter: "contains",
        delay: 500,
        minLength: 0,
        suggest: true,
        dataSource: {
            serverFiltering: true,
            schema: {
                data: "Data",
                total: "Count"
            },
            transport: {

                read: "/Plantilla/ListarPlantillaGrupo?ID_TIPOPLAN=2"

            }
        }
    }).data("kendoComboBox");

    @*var ID_RAZON = $("#IdRazon").kendoComboBox({
        autoBind: true,
        //cascadeFrom: "ID_STAT",
        dataTextField: "text",
        dataValueField: "id",
        filter: "contains",
        index: 1,
        delay: 500,
        minLength: 0,
        suggest: true,
        dataSource: {
            serverFiltering: true,
            schema: {
                data: "Data",
                total: "Count"
            },
            transport: {
                read: "/StatusTicket/ListarRazonxEstado?IDESTADO=" + @ViewBag.Estado + "&Tipo=" + 2 + "&var=" + Math.random()

                }
            }
        }).data("kendoComboBox");*@

    $("#COM_DETA_TICK").kendoEditor({
        tools: [
            "bold",
            "italic",
            "underline",
            "strikethrough",
            "foreColor",
            "backColor",
            "justifyLeft",
            "justifyCenter",
            "justifyRight",
            "justifyFull",
            "insertUnorderedList",
            "insertOrderedList",
            "indent",
            "outdent",
            "createLink",
            "unlink",
            "subscript",
            "superscript"
        ], encoded: false,
        paste: OnPaste
    });
    if (@Session["ID_ACCO"] == 60) {
        var ID_STAT = $("#ID_STAT").kendoDropDownList({
            autoBind: true,
            index: -1,
            dataTextField: "NAM_STAT",
            dataValueField: "ID_STAT",
            dataSource: {
                //type: "odata",
                serverFiltering: false,
                schema: {
                    data: "Data",
                    total: "Count"
                },
                transport: {
                    read: "/StatusTicket/StatusConditionBnv/?id=@ViewBag.ID_TICK&horaRegistrada=@ViewBag.FechaInicioReal"
                },
                sort: { field: "NAM_STAT", dir: "asc" }
            },
            dataBound: function (e) {
                var existe = e.sender.dataSource.data().filter(function (item) {
                    return item.ID_STAT == 0
                })
                if (existe.length == 0) {
                    e.sender.dataSource.add({
                        ID_STAT: 0,
                        NAM_STAT: ""
                    })
                }
            }
        }).data("kendoDropDownList")

        ID_STAT.bind("change", function (e) {
            console.log('cambio')
            if (ID_STAT.dataItem().ID_STAT == 5) {
                $("#fechaScheduled").removeClass('divHide');
                $("#fechaRealTermino").addClass('divHide');
                $("#divControlRemoto").addClass('divHide');
                $("#divTipoResolucion").addClass('divHide');
            }
            else {
                if (ID_STAT.dataItem().ID_STAT == 4) {
                    $("#fechaScheduled").addClass('divHide');
                    $("#fechaRealTermino").removeClass('divHide');
                    $("#divControlRemoto").removeClass('divHide');
                    $("#divTipoResolucion").removeClass('divHide');
                    //IniciarLeccionAprendida();
                    //$("#submit").trigger('click');
                }
                else {
                    $("#fechaScheduled").addClass('divHide');
                    $("#fechaRealTermino").addClass('divHide');
                    $("#divControlRemoto").addClass('divHide');
                    $("#divTipoResolucion").addClass('divHide');
                }
            }
        });
    }
    else {
        var ID_STAT = $("#ID_STAT").kendoComboBox({
            autoBind: true,
            dataTextField: "NAM_STAT",
            dataValueField: "ID_STAT",
            dataSource: {
                //type: "odata",
                serverFiltering: false,
                schema: {
                    data: "Data",
                    total: "Count"
                },
                transport: {
                    read: "/StatusTicket/StatusCondition/@ViewBag.ID_TICK"
                }
            }
        }).data("kendoComboBox");
        ID_STAT.bind("change", function (e) {
            if (ID_STAT.dataItem().ID_STAT == 5) {
                $("#fechaScheduled").removeClass('divHide');
                $("#fechaRealTermino").addClass('divHide');
                $("#divControlRemoto").addClass('divHide');
                $("#divTipoResolucion").addClass('divHide');
            }
            else {
                if (ID_STAT.dataItem().ID_STAT == 4) {
                    $("#fechaScheduled").addClass('divHide');
                    $("#fechaRealTermino").removeClass('divHide');
                    $("#divControlRemoto").removeClass('divHide');
                    $("#divTipoResolucion").removeClass('divHide');

                    //IniciarLeccionAprendida();
                    //$("#submit").trigger('click');
                }
                else {
                    $("#fechaScheduled").addClass('divHide');
                    $("#fechaRealTermino").addClass('divHide');
                    $("#divControlRemoto").addClass('divHide');
                    $("#divTipoResolucion").addClass('divHide');
                }
            }
        });
    }





    //status sale
    $("#ID_STAT_SALE_OPP").kendoComboBox({
        dataTextField: "NAM_STAT_SALE_OPPO",
        dataValueField: "ID_STAT_SALE_OPPO",
        filter: "contains",
        autoBind: false,
        delay: 500,
        minLength: 0,
        suggest: true,
        dataSource: {
            schema: {
                data: "Data",
                total: "Count"
            },
            transport: {
                read: "/StatusSalesOpportunities/ListAll?var=" + Math.random()
            }
        }
    }).data("kendoComboBox");

    $("#ID_QUEU").kendoComboBox({
        dataTextField: "DES_QUEU",
        dataValueField: "ID_QUEU",
        filter: "contains",
        autoBind: false,
        //template: '<div style="text-transform:capitalize">' +
        //    '${data.DES_QUEU}</div>',
        dataSource: {
            serverFiltering: false,
            schema: {
                data: "Data",
                total: "Count"
            },
            transport: {
                read: "/AccountQueue/ListByAcco?var=" + Math.random()
            },
            sort: { field: "DES_QUEU", dir: "asc" }
        }
    }).data("kendoComboBox");




    //$("#ID_PERS_ENTI").kendoComboBox({
    //    autoBind: false,
    //    //index: 1,
    //    cascadeFrom: "ID_QUEU",
    //    filter: "contains",
    //    minLength: 0,
    //    suggest: true,
    //    dataTextField: "ASSI",
    //    template: '<div style="text-transform:capitalize; display: inline-block; width:100%;">' +
    //                              '<div style="float:left;">${data.ASSI}</div>' +
    //                              '<div style="float:right; ">(WL ${data.WorkLoad})</div>' +
    //                          '</div>',
    //    dataValueField: "ID_PERS_ENTI",
    //    dataSource: {
    //        //type: "odata",
    //        serverFiltering: true,
    //        schema: {
    //            data: "Data",
    //            total: "Count"
    //        },
    //        transport: {
    //            read: {
    //                url: function () {
    //                    var ruta = "/AccountEntity/AsignadoPorCola?ID_QUEU=" + $("#ID_QUEU").val()
    //                    console.log($("#ID_QUEU").val())
    //                    console.log(ruta)
    //                    return ruta
    //                }
    //            }

    //        },
    //        sort: { field: "ASSI", dir: "asc" }
    //    }
    //}).data("kendoComboBox");

    $("#ID_PERS_ENTI").kendoComboBox({
        autoBind: false,
        filter: "contains",
        cascadeFrom: "ID_QUEU",
        dataTextField: "ASSI",
        dataValueField: "ID_PERS_ENTI",
        delay: 500,
        placeholder: "Seleccionar ... ",
        dataSource: {
            serverFiltering: true,
            schema: {
                data: "Data",
                total: "Count"
            },
            transport: {
                read: {
                    url: function () {
                        var valor = $('#ID_PERS_ENTI').data('kendoComboBox')._prev;
                        if (valor == undefined) {
                            valor = ""
                        }
                        var ruta = "/AccountEntity/AsignadoPorCola?ID_QUEU=" + $("#ID_QUEU").val() + "&VALOR=" + valor;
                        return ruta
                    }
                }
            },
            sort: { field: "ASSI", dir: "asc" }
        }
    }).data("kendoComboBox");

    if (@ViewBag.TicketProyecto == 1) {
        $("#subcategorizacionPry").removeClass("divHide");
        $("#divCtrlRemot").removeClass("divHide");
    } else {
        $("#subcategorizacionPry").addClass("divHide");
        $("#divCtrlRemot").addClass('divHide');
    }
    //Subcategorización de proyectos
    var cboEtapa = $("#cboEtapa").kendoComboBox({
        placeholder: "",
        dataTextField: "Nombre",
        dataValueField: "Id",
        filter: "contains",
        autoBind: true,
        delay: 500,
        minLength: 0,
        suggest: true,
        dataSource: {
            schema: {
                data: "Data",
                total: "Count"
            },
            transport: {
                read: "/Proyectos_Etapa/CboListarEtapa"
            }
        }
    });
    var cboActividad = $("#cboActividad").kendoComboBox({
        placeholder: "",
        dataTextField: "Nombre",
        dataValueField: "Id",
        filter: "contains",
        autoBind: true,
        delay: 500,
        minLength: 0,
        suggest: true,
        dataSource: {
            schema: {
                data: "Data",
                total: "Count"
            },
            transport: {
                read: "/Proyectos_Actividad/CboListarActividad"
            }
        }
    });
    var cboSubcategoria = $("#cboSubcategoria").kendoComboBox({
        placeholder: "",
        dataTextField: "Nombre",
        dataValueField: "Id",
        filter: "contains",
        autoBind: true,
        delay: 500,
        minLength: 0,
        suggest: true,
        dataSource: {
            schema: {
                data: "Data",
                total: "Count"
            },
            transport: {
                read: "/Proyectos_SubCategoria/CboListarSubcategoria"
            }
        }
    });

    var ID_RAZON = $("#IdRazon").kendoComboBox({
        autoBind: true,
        cascadeFrom: "ID_STAT",
        dataTextField: "text",
        dataValueField: "id",
        filter: "contains",
        index: 0,
        delay: 500,
        minLength: 0,
        suggest: true,
        dataSource: {
            serverFiltering: true,
            schema: {
                data: "Data",
                total: "Count"
            },
            transport: {
                read: "/StatusTicket/ListarRazonxEstado?IDESTADO=" + 0 + "&Tipo=" + 1 + "&var=" + Math.random()

            }
        }
    }).data("kendoComboBox");


    @* function uploadDone(conf, msg, nivel1, nivel2, nivel3, nivel4, idTema, idtick, nameNivel1, nameNivel2, nameNivel3, nameNivel4, nameTema, idEstado) {

        closeWinModalPopUpLoad();
        if (conf == 'OK') {
            var title = 'Información Guardada';
            var body = "<div style='border-bottom:1px dotted #dadada;padding:0px 0px 20px 0px;'>"
                + "<div style='padding:10px 0px 10px 0px;'>Detail Ticket information was succesfully saved</div>"
                + "<div style='padding:10px 0px 10px 0px;'>Code: " + msg + "</div>" +
                "<div style='float:right; padding:30px 6px 0px 6px; font-size:0.9em;'>" +
                "<button id='btnContinues' class='k-button'>Continue</button>" +
                "</div></div>";

            winPopUpModal(title, body, 400, 185);

            $("#closebtnmodal").click(function () {
                location.reload(true);
            });

            $("#btnContinues").click(function () {
                location.reload(true);
            });
        }
        else {
            var title = '@ResourceLanguaje.Resource.InformationMissing';
            var body = "<div style='border-bottom:1px dotted #dadada;padding:0px 0px 20px 0px;'>" +
                "<div style='padding:10px 0px 10px 0px;'>" + msg + "</div>" +
                "<div style='float:right; padding:30px 6px 0px 6px; font-size:0.9em;'>" +
                "<button id='btnContinuee' class='k-button'>Continue</button>" +
                "</div></div>";

            winPopUpModal(title, body, 400, 150);

            $("#btnContinuee").click(function () {
                $("#dlg").hide('200', "swing", function () {
                    $("#bkg").fadeOut("300");
                });
            });
        }
    } *@

        function IniciarLeccionAprendida() {

            //$("#miModal").show();
            var htmlForm = '<div id="FormLeccionAprendida"></div>';
            var id = $("#ID_TICK").val();
            winFormPopup("Nueva lección Aprendida", htmlForm);
            $("#FormLeccionAprendida").load("/KnowledgeManagement/GenerarLeccionTicketProblema?id=" + id + "&var=" + Math.random());
            //load("/Ticket/viewDetalleUsuario?id=" + idUsuario + "&var=" + Math.random());
            @*/*?id=" + "@ViewBag.ID_COMP" + "&var=" + Math.random()*/*@
    }


    /*Modificado para la gestión de conocimiento y problemas*/
    function uploadDone(conf, msg, nivel1, nivel2, nivel3, nivel4, idTema, idtick, nameNivel1, nameNivel2, nameNivel3, nameNivel4, nameTema, idEstado, Flagproblema) {

        closeWinModalPopUpLoad();
        if (conf == 'OK') {
            /*################################################################## GCR161203 #######################################################################################*/
            if (idEstado == 4) {

                if (Flagproblema == "True") {

                    var title = 'Información Guardada';
                    var body = "<div style='border-bottom:1px dotted #dadada;padding:0px 0px 20px 0px;'>"
                        + "<div style='padding:10px 0px 10px 0px;'>Detail Ticket information was succesfully saved</div>"
                        + "<div style='padding:10px 0px 10px 0px;'>Code: " + msg + "</div>" +
                        "<div style='float:right; padding:30px 6px 0px 6px; font-size:0.9em;'>" +
                        "<button id='btnContinues' class='k-button'>Continue</button>" +
                        "</div></div>";
                    swal({
                        title: title,
                        type: 'success',
                        text: 'Code: ' + msg,
                        focusConfirm: false,
                        confirmButtonText:
                            'Continue',
                        confirmButtonAriaLabel: 'Thumbs up, great!'

                    }, function () {
                        location.reload();
                    })
                    //winPopUpModal(title, body, 400, 185);

                    $("#closebtnmodal").click(function () {

                        //location.reload(true);
                        location.reload(true);
                        // var url = "http://" + location.host + "/#/NewLessonLearned?nivel1=" + nivel1 + "&nivel2=" + nivel2 + "&nivel3=" + nivel3 + "&nivel4=" + nivel4 + "&idTema=" + idTema + "&idtick=" + idtick + "&nameNivel1=" + nameNivel1 + "&nameNivel2=" + nameNivel2 + "&nameNivel3=" + nameNivel3 + "&nameNivel4=" + nameNivel4 + "&nameTema=" + nameTema;
                        // window.open(url, '_blank');
                    });
                    $("#btnContinues").click(function () {
                        location.reload(true);
                        //var url = "http://" + location.host + "/#/NewLessonLearned?nivel1=" + nivel1 + "&nivel2=" + nivel2 + "&nivel3=" + nivel3 + "&nivel4=" + nivel4 + "&idTema=" + idTema + "&idtick=" + idtick + "&nameNivel1=" + nameNivel1 + "&nameNivel2=" + nameNivel2 + "&nameNivel3=" + nameNivel3 + "&nameNivel4=" + nameNivel4 + "&nameTema=" + nameTema;
                        //window.open(url, '_blank');
                    });
                } else {
                    var title = 'Información Guardada';
                    var body = "<div style='border-bottom:1px dotted #dadada;padding:0px 0px 20px 0px;'>"
                        + "<div style='padding:10px 0px 10px 0px;'>Detail Ticket information was succesfully saved</div>"
                        + "<div style='padding:10px 0px 10px 0px;'>Code: " + msg + "</div>" +
                        "<div style='float:right; padding:30px 6px 0px 6px; font-size:0.9em;'>" +
                        "<button id='btnContinues' class='k-button'>Continue</button>" +
                        "</div></div>";

                    //winPopUpModal(title, body, 400, 185);

                    $("#closebtnmodal").click(function () {

                        location.reload(true);
                        var url = "http://" + location.host + "/KnowledgeManagement/NewLessonLearned?nivel1=" + nivel1 + "&nivel2=" + nivel2 + "&nivel3=" + nivel3 + "&nivel4=" + nivel4 + "&idTema=" + idTema + "&idtick=" + idtick + "&nameNivel1=" + nameNivel1 + "&nameNivel2=" + nameNivel2 + "&nameNivel3=" + nameNivel3 + "&nameNivel4=" + nameNivel4 + "&nameTema=" + nameTema;
                        window.open(url, '_blank');
                    });

                    swal({
                        title: title,
                        text: 'Code: ' + msg,
                        type: "success",
                        //showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "Continue",
                        //cancelButtonText: "No, cancel plx!",
                        closeOnConfirm: false,
                        //closeOnCancel: false
                    },
                        function (isConfirm) {
                            if (isConfirm) {
                                swal({
                                    title: "¿Desea agregar una lección aprendida a esta operación realizada?",
                                    type: "info",
                                    showCancelButton: true,
                                    confirmButtonColor: "#DD6B55",
                                    cancelButtonText: "No",
                                    confirmButtonText: "Sí",
                                    closeOnConfirm: false
                                }, function (dismiss) {
                                    if (dismiss) {
                                        var url = "http://" + location.host + "/KnowledgeManagement/NewLessonLearned?nivel1=" + nivel1 + "&nivel2=" + nivel2 + "&nivel3=" + nivel3 + "&nivel4=" + nivel4 + "&idTema=" + idTema + "&idtick=" + idtick + "&nameNivel1=" + nameNivel1 + "&nameNivel2=" + nameNivel2 + "&nameNivel3=" + nameNivel3 + "&nameNivel4=" + nameNivel4 + "&nameTema=" + nameTema;
                                        window.open(url, '_blank');
                                        location.reload(true);

                                    } else
                                        location.reload(true);
                                })
                            }
                        }
                    );

                    $("#btnContinues").click(function () {
                        swal({
                            title: "¿Desea agregar una lección aprendida a esta operación realizada?",
                            type: "info",
                            showCancelButton: true,
                            confirmButtonColor: "#DD6B55",
                            cancelButtonText: "No",
                            confirmButtonText: "Sí",
                            closeOnConfirm: false
                        }, function (dismiss) {
                            if (dismiss) {

                                location.reload(true);
                                var url = "http://" + location.host + "/KnowledgeManagement/NewLessonLearned?nivel1=" + nivel1 + "&nivel2=" + nivel2 + "&nivel3=" + nivel3 + "&nivel4=" + nivel4 + "&idTema=" + idTema + "&idtick=" + idtick + "&nameNivel1=" + nameNivel1 + "&nameNivel2=" + nameNivel2 + "&nameNivel3=" + nameNivel3 + "&nameNivel4=" + nameNivel4 + "&nameTema=" + nameTema;
                                window.open(url, '_blank');
                            } else
                                location.reload(true);
                        })
                    });
                }
            } else {

                var title = 'Información Guardada';
                var body = "<div style='border-bottom:1px dotted #dadada;padding:0px 0px 20px 0px;'>"
                    + "<div style='padding:10px 0px 10px 0px;'>Detail Ticket information was succesfully saved</div>"
                    + "<div style='padding:10px 0px 10px 0px;'>Code: " + msg + "</div>" +
                    "<div style='float:right; padding:30px 6px 0px 6px; font-size:0.9em;'>" +
                    "<button id='btnContinues' class='k-button'>Continue</button>" +
                    "</div></div>";

                swal({
                    title: title,
                    type: 'success',
                    text: 'Code: ' + msg,
                    focusConfirm: false,
                    confirmButtonText:
                        'Continue',
                    confirmButtonAriaLabel: 'Thumbs up, great!'

                }, function () {
                    location.reload();
                })

                //winPopUpModal(title, body, 400, 185);

                $("#closebtnmodal").click(function () {

                    location.reload(true);
                });
                $("#btnContinues").click(function () {
                    location.reload(true);
                });
            }

        }
        else if (conf == 'TieneHijosGF') {
            swal({
                type: 'info',
                title: 'Tickets Hijos Activos',
                text: msg,
                confirmButtonText:
                    'Continue',
            })
        }
        else {
            swal({
                type: 'info',
                title: '@ResourceLanguaje.Resource.InformationMissing',
                text: msg,
                confirmButtonText:
                    'Continue',
            })
            @*var title = '@ResourceLanguaje.Resource.InformationMissing';
            var body = "<div style='border-bottom:1px dotted #dadada;padding:0px 0px 20px 0px;'>" +
                "<div style='padding:10px 0px 10px 0px;'>" + msg + "</div>" +
                "<div style='float:right; padding:30px 6px 0px 6px; font-size:0.9em;'>" +
                "<button id='btnContinuee' class='k-button'>Continue</button>" +
                "</div></div>";

            winPopUpModal(title, body, 400, 150);*@

            //$("#btnContinuee").click(function () {
            //    $("#dlg").hide('200', "swing", function () {
            //        $("#bkg").fadeOut("300");
            //    });
            //});

            /*################################################################## GCR161203 #######################################################################################*/
        }
    }

    function perdioSesion() {
        alert('perdio sesion')
        swal({
            title: 'Algo salio mal',
            type: 'error',
            text: 'Se perdió la conexión',
            focusConfirm: false,
            confirmButtonText: 'Continuar',
        }, function () {

            location = "http://" + location.host + `/Home/Principal`;
        })
    }
    function MensajeError(conf, msga) {

        alert(1);
    }

    function detailUser(id) {
        var dataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    url: "/AccountEntity/DetailPerson/" + id,
                    type: "GET",
                    dataType: "json",
                    data: {
                        ran: Math.random()
                    }
                }
            },
            autoSync: true,
            serverFiltering: true,
            filter: { field: "Status", operator: "eq", value: 0 },
            serverPaging: true,
            pageSize: 15,
            schema: {
                data: "Data",
                total: "Count"
            }
        });

        $("#divDetu").empty();

        $("#divDetu").kendoListView({
            dataSource: dataSource,
            template: kendo.template($("#templdu").html())
        });
    }

    function ListAllAttach() {

        $("#divAttachFiles").kendoGrid({
            dataSource: {
                transport: {
                    read: {
                        url: "/DetailsTicket/AttaAllTick/" + "@ViewBag.ID_TICK",
                        type: "GET",
                        dataType: "json",
                        data: {
                            ran: Math.random()
                        }
                    }
                },
                schema: {
                    data: "Data",
                    total: "Count",
                    model: {
                        fields: {
                            NAM_ATTA: { type: "string" },
                            ID_ATTA: { type: "number" },
                            EXT_ATTA: { type: "string" },
                            NAM_TYPE_DOCU_ATTA: { type: "string" }
                        }
                    }
                },
                group: {
                    field: "NAM_TYPE_DOCU_ATTA", aggregates: [
                        { field: "NAM_ATTA", aggregate: "count" }
                        , { field: "NAM_TYPE_DOCU_ATTA", aggregate: "count" }
                    ]
                }
            },
            sortable: true,
            filterable: true,
            pageable: false,
            //height: 185,
            //columns: [
            //    { field: "NAM_ATTA", title: "File Name", template: "<a href='#: NAM_ATTA #_#: ID_ATTA ##: EXT_ATTA #' target='_blank'>#: NAM_ATTA # </a>" }
            columns: [
                {
                    field: "NAM_ATTA", title: "File Name", template: function (query2) {
                        if (query2.EXT_ATTA == '.pdf' || query2.EXT_ATTA == '.jpg' || query2.EXT_ATTA == '.png' || query2.EXT_ATTA == '.txt') {
                            //return "<a href='DetailsTicket/VerDocumento/#: NAM_ATTA #' target='_blank'>#: NAM_ATTA # </a>"
                            return "<a href='/DetailsTicket/VerDocumento/" + query2.NAM_ATTA + '_' + query2.ID_ATTA + query2.EXT_ATTA + "' target='_blank'>" + query2.NAM_ATTA + "</a>"
                        }
                        else {
                            return "<a href='/DetailsTicket/DescargarArchivo/" + query2.NAM_ATTA + '_' + query2.ID_ATTA + query2.EXT_ATTA + "' target='_blank'>" + query2.NAM_ATTA + "</a>"
                        }
                    }

                }
                , { field: "NAM_TYPE_DOCU_ATTA", title: "Type Attach", groupHeaderTemplate: "#= value # (#= count#)" }
            ]
        });
    }

    function showDetailsIncident() {

        $.ajax({
            url: "/DetailsTicket/ListByIdTick/" + "@ViewBag.ID_TICK",
            data: "var=" + Math.random(),
            type: "GET",
            dataType: "json",
            success: function (source) {
                data1 = source;

                $("#divDetaTicket").empty();
                $("#divComentario").empty();
                $("#divActivities").empty();
                $("#divDetails").empty();

                // datos actualizados


                $.each(data1['datadeta'], function (index, value) {


                    $("#divDetaTicket").append(
                        ("@ViewBag.ID_ACCO" == 60 || "@ViewBag.ID_ACCO" == 56 || "@ViewBag.ID_ACCO" == 57 || "@ViewBag.ID_ACCO" == 58 ?
                            '<div>' +
                            '<label class="smallTitulo">Titulo de solicitud:  ' +
                            '</label>' +
                            '<label class="font-weight-bold">  @ViewBag.TITLE_TICK </label >' +
                            '</div>'
                            : '') +
                        '<div class="form-row">' +
                        '<div class="col-xs-1">' +
                        '<div class="form-group">' +
                        '<label id="" for="" class="smallTitulo">Estado </label>' +
                        '<p id="" for="" class="smallCampo"> ' + (data1['datadeta'][index]['NAM_STAT']) + ' </p>' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-xs-2">' +
                        '<div class="form-group">' +
                        '<label id="" for="" class="smallTitulo">Usuario Solicitante </label>' +
                        '<p id="" for="" class="smallCampo"> ' + (data1['datadeta'][index]['Sol']) + ' </p>' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-xs-2">' +
                        '<div class="form-group">' +
                        '<label id="" for="" class="smallTitulo">Usuario Afectado </label>' +
                        '<p id="" for="" class="smallCampo">' + (data1['datadeta'][index]['AEU']) + '</p>' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-xs-1">' +
                        '<div class="form-group">' +
                        '<label id="" for="" class="smallTitulo">Nivel de Servicio </label>' +
                        '<p id="" for="" class="smallCampo">' + (data1['datadeta'][index]['TipoSLA']) + ' - ' + (data1['datadeta'][index]['SLA']) + ' Horas </p>' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-xs-2">' +
                        '<div class="form-group">' +
                        '<label id="" for="" class="smallTitulo">Tiempo de Expiración </label>' +
                        '<p id="" for="" class="smallCampo">' + (data1['datadeta'][index]['EXP_TIME']) + '</p>' +
                        '</div>' +
                        '</div>' +
                        ("@ViewBag.ID_ACCO" == 60 ?
                        '<div class="col-xs-2">' +
                            '<div class="form-group">' +
                                '<label id="" for="" class="smallTitulo">Usuario VIP</label>' +
                                '<p id="" for="" class="smallCampo">' + (data1['datadeta'][index]['UsuarioVIP']) + '</p>' +
                            '</div>' +
                         '</div>' +
                         '<div class="col-xs-2">' +
                            '<div class="form-group">' +
                                '<label id="" for="" class="smallTitulo">Positivo - Falso Positivo</label>' +
                                '<p id="" for="" class="smallCampo">' + (data1['datadeta'][index]['FalsoPositivo']) + '</p>' +
                            '</div>' +
                        '</div>': '') +
                        ("@ViewBag.ACCESO_EDIT" == 1 && parseInt(@Session["ID_ACCO"]) == 17 ?
                    '<div class="col-xs-1">' +
                    '<div class="form-group">' +
                    '<label id="" for="" class="smallTitulo">Tiempo transcurrido </label>' +
                    '<p id="" for="" class="smallCampo">' + (data1['datadeta'][index]['TIME_USED']) + '</p>' +
                    '</div>' +
                    '</div>' : '') +
            ((data1['datadeta'][index]['ID_DOCU_SALE']) != 0 ?
                '<div class="col-xs-1">' +
                '<div class="form-group">' +
                '<label id="" for="" class="smallTitulo">OP </label>' +
                '<p id="" for="" class="smallCampo"><a href="/OrderForm/Details/' + (data1['datadeta'][index]['ID_DOCU_SALE']) + '" target="_blank" style="text-decoration:none;" title="View OP">' + (data1['datadeta'][index]['COD_TYPE_DOCU_SALE']) + ' ' + (data1['datadeta'][index]['NUM_OP']) + '</a></p>' +
                '</div>' +
                '</div>' : '') +
            ((data1['datadeta'][index]['ID_QUEU']) == 26 ?
                '<div class="col-xs-1">' +
                '<div class="form-group">' +
                '<label id="" for="" class="smallTitulo">Monto </label>' +
                '<p id="" for="" class="smallCampo">$ ' + (data1['datadeta'][index]['AMM']) + '</p>' +
                '</div>' +
                '</div>' : '') +
            ((data1['datadeta'][index]['ID_QUEU']) == 26 ?
                '<div class="col-xs-1">' +
                '<div class="form-group">' +
                '<label id="" for="" class="smallTitulo">Ganancia </label>' +
                '<p id="" for="" class="smallCampo">' + (data1['datadeta'][index]['PROF']) + ' % </p>' +
                '</div>' +
                '</div>' : '') +
            '</div>' +
            '<div class="form-row">' +
            ("@ViewBag.ID_ACCO" == 56 || "@ViewBag.ID_ACCO" == 57 || "@ViewBag.ID_ACCO" == 58 ?
                "" :
                '<div class="col-xs-2">' +
                '<div class="form-group">' +
                '<label id="" for="" class="smallTitulo">Tema </label>' +
                '<p id="" for="" class="smallCampo">' + (data1['datadeta'][index]['NAME_TEMA']) + '</p>' +
                '</div>' +
                '</div>') +

            '<div class="col-xs-2">' +
            '<div class="form-group">' +
            '<label id="" for="" class="smallTitulo">Prioridad </label>' +
            '<p id="" for="" class="smallCampo"> ' + (data1['datadeta'][index]['NAM_PRIO']) + ' </p>' +
            '</div>' +
            '</div>' +
            '<div class="col-xs-2">' +
            '<div class="form-group">' +
            ("@ViewBag.ID_ACCO" == 56 || "@ViewBag.ID_ACCO" == 57 || "@ViewBag.ID_ACCO" == 58 ?
                '<label id="" for="" class="smallTitulo">Categoría 1</label>' +
                '<p id="" for="" class="smallCampo"> ' +
                "@ViewBag.Cate1"
                :
                '<label id="" for="" class="smallTitulo">Unidad de Negocio</label>' +
                '<p id="" for="" class="smallCampo"> ' +
                (data1['datadeta'][index]['CATE_1'])) +
            '</p>' +
            '</div>' +
            '</div>' +
            '<div class="col-xs-2">' +
            '<div class="form-group">' +
            ("@ViewBag.ID_ACCO" == 56 || "@ViewBag.ID_ACCO" == 57 || "@ViewBag.ID_ACCO" == 58 ?
                '<label id="" for="" class="smallTitulo">Categoría 2</label>' +
                '<p id="" for="" class="smallCampo"> ' +
                "@ViewBag.Cate2"
                :
                '<label id="" for="" class="smallTitulo">Macroservicio </label>' +
                '<p id="" for="" class="smallCampo"> ' +
                (data1['datadeta'][index]['CATE_2'])) +
            ' </p>' +
            '</div>' +
            '</div>' +
            '<div class="col-xs-2">' +
            '<div class="form-group">' +

            ("@ViewBag.ID_ACCO" == 56 || "@ViewBag.ID_ACCO" == 57 || "@ViewBag.ID_ACCO" == 58 ?
                '<label id="" for="" class="smallTitulo">Categoría 3</label>' +
                '<p id="" for="" class="smallCampo"> ' +
                "@ViewBag.Cate3"
                :
                '<label id="" for="" class="smallTitulo">Servicio </label>' +
                '<p id="" for="" class="smallCampo"> ' +
                (data1['datadeta'][index]['CATE_3'])) +
            ' </p>' +
            '</div>' +
            '</div>' +
            '<div class="col-xs-2">' +
            '<div class="form-group">' +

            ("@ViewBag.ID_ACCO" == 56 || "@ViewBag.ID_ACCO" == 57 || "@ViewBag.ID_ACCO" == 58 ?
                '<label id="" for="" class="smallTitulo">Categoría 4</label>' +
                '<p id="" for="" class="smallCampo"> ' +
                "@ViewBag.Cate4"
                :
                '<label id="" for="" class="smallTitulo">Incidente/Requerimiento </label>' +
                '<p id="" for="" class="smallCampo"> ' +
                (data1['datadeta'][index]['CATE_4'])) +

            ' </p>' +
            '</div>' +
            '</div>' +

            ("@ViewBag.ID_ACCO" == 56 || "@ViewBag.ID_ACCO" == 57 || "@ViewBag.ID_ACCO" == 58 ?
                ("@ViewBag.Cate5" != "" ?
                    '<div class="col-xs-2">' +
                    '<div class="form-group">' +
                    '<label id="" for="" class="smallTitulo">Categoria 5 </label>' +
                    '<p id="" for="" class="smallCampo">' + '@ViewBag.Cate5' + '</p>' +
                    '</div>' +
                    '</div>' :
                    "") +
                ("@ViewBag.Cate6" != "" ?
                    '<div class="col-xs-2">' +
                    '<div class="form-group">' +
                    '<label id="" for="" class="smallTitulo">Categoria 6 </label>' +
                    '<p id="" for="" class="smallCampo">' + '@ViewBag.Cate6' + '</p>' +
                    '</div>' +
                    '</div>' :
                    "") +
                ("@ViewBag.ID_CATE_MOVIL" == 27158 || "@ViewBag.ID_CATE_MOVIL" == 28529 || "@ViewBag.ID_CATE_MOVIL" == 29900 ?
                    '<div class="col-xs-2">' +
                    '<div class="form-group">' +
                    '<label id="" for="" class="smallTitulo">Proveedor </label>' +
                    '<p id="" for="" class="smallCampo">Claro</p>' +
                    '</div>' +
                    '</div>' :
                    "") +
                '</div>' :
                '</div>') +

            '<div class="form-row">' +
            '<div class="col-xs-1">' +
            '<div class="form-group">' +
            '<label id="" for="" class="smallTitulo">Fuente </label>' +
            '<p id="" for="" class="smallCampo"> ' + (data1['datadeta'][index]['NAM_SOUR']) + ' </p>' +
            '</div>' +
            '</div>' +
            ("@ViewBag.ID_ACCO" == 60 && (data1['datadeta'][index]['MotivoSource']) != '' ?
                '<div class="col-xs-2">' +
                '<div class="form-group">' +
                '<label id="" for="" class="smallTitulo">Motivo Regularización</label>' +
                            '<p id="" for="" class="smallCampo">' + (data1['datadeta'][index]['MotivoSource']) + '</p>' +
                '</div>' +
                '</div>' : '') +
            '<div class="col-xs-2">' +
            '<div class="form-group">' +
            '<label id="" for="" class="smallTitulo">Fecha Creación </label>' +
            '<p id="" for="" class="smallCampo"> ' + (data1['datadeta'][index]['CREATE_TICK']) + ' </p>' +
            '</div>' +
            '</div>' +
            '<div class="col-xs-2">' +
            '<div class="form-group">' +
            '<label id="" for="" class="smallTitulo">Fecha Modificación</label>' +
            '<p id="" for="" class="smallCampo">' + (data1['datadeta'][index]['MODIFIED_TICK']) + '</p>' +
            '</div>' +
            '</div>' +
            ((data1['datadeta'][index]['ID_STAT']) == 5 ?
                '<div class="col-xs-2">' +
                '<div class="form-group">' +
                '<label id="" for="" class="smallTitulo">Fecha Programación</label>' +
                '<p id="" for="" class="smallCampo">' + (data1['datadeta'][index]['DATE_SCHE']) + '</p>' +
                '</div>' +
                '</div>' : '') +
            '<div class="col-xs-1">' +
            '<div class="form-group">' +
            '<label id="" for="" class="smallTitulo">Adjuntos </label>' +
            '<p id="" for="" class="smallCampo">' + (data1['datadeta'][index]['ATTA_TOT']) + ' </p>' +
            '</div>' +
            '</div>' +
            '<div class="col-xs-1">' +
            '<div class="form-group">' +
            '<label id="" for="" class="smallTitulo">Control Remoto </label>' +
            '<p id="" for="" class="smallCampo">' + (data1['datadeta'][index]['REM_CONT']) + '</p>' +
            '</div>' +
            '</div>' +
            '<div class="col-xs-1">' +
            '<div class="form-group">' +
            '<label id="" for="" class="smallTitulo">Servicio </label>' +
            '<p id="" for="" class="smallCampo">' + (data1['datadeta'][index]['SERVICE']) + '</p>' +
            '</div>' +
            '</div>' +
            '<div class="col-xs-2">' +
            '<div class="form-group">' +
            '<label id="" for="" class="smallTitulo">Fecha Recepción De Solicitud </label>' +
            '<p id="" for="" class="smallCampo">' + (data1['datadeta'][index]['FechaRecepcionSolicitud']) + '</p>' +
            '</div>' +
            '</div>' +
            (parseInt(@Session["ID_ACCO"]) == 60 ?
                '<div class="col-xs-2">' +
                '<div class="form-group">' +
                '<label class="smallTitulo">TAG</label>' +
                '<p class="smallCampo">' + (data1['datadeta'][index]['TAG']) + '</p>' +
                '</div>' +
                '</div>' : '') +

                    (parseInt(@Session["ID_ACCO"]) == 60 ?
                        '<div class="col-xs-2">' +
                        '<div class="form-group">' +
                        '<label class="smallTitulo">Impacto del Servicio</label>' +
                        '<p class="smallCampo">' + (data1['datadeta'][index]['ImpactoServicio']) + '</p>' +
                        '</div>' +
                            '</div>' : '') +

                      (parseInt(@Session["ID_ACCO"]) == 60 ?
                        '<div class="col-xs-2">' +
                        '<div class="form-group">' +
                        '<label class="smallTitulo">Ticket - Garantia Proveedor</label>' +
                            '<p class="smallCampo">' + (data1['datadeta'][index]['GarantiaProveedor']) + '</p>' +
                        '</div>' +
                            '</div>' : '')
                        +

                        (parseInt(@Session["ID_ACCO"]) == 60 ?
                            '<div class="col-xs-2">' +
                            '<div class="form-group">' +
                            '<label class="smallTitulo">Días Laborales Transcurridos</label>' +
                            '<p class="smallCampo">' + (data1['datadeta'][index]['Dias_Laboral_Transcurridos']) + '</p>' +
                            '</div>' +
                            '</div>' : '')
                                +

                            (parseInt(@Session["ID_ACCO"]) == 1 || parseInt(@Session["ID_ACCO"]) == 25 ?
                                '<div class="col-xs-2">' +
                                '<div class="form-group">' +
                                '<label class="smallTitulo" id="TicketExterno">Ticket Externo</label>' +
                                '<p class="smallCampo">' + (data1['datadeta'][index]['TicketExterno']) + '</p>' +
                                '</div>' +
                                '</div>' : '') +
                                    (![56, 57, 58, 60].includes(parseInt(@Session["ID_ACCO"])) && data1['datadeta'][index]['MotivoEspera'] != '' && data1['datadeta'][index]['ID_STAT'] == 5 ?
                                        '<div class="col-xs-2">' +
                                        '<div class="form-group">' +
                                        '<label class="smallTitulo">Motivo de Espera</label>' +
                                        '<p class="smallCampo">' + (data1['datadeta'][index]['MotivoEspera']) + '</p>' +
                                        '</div>' +
                                        '</div>' : '') +
                                            '</div>' +
                                            (parseInt(@Session["ID_ACCO"]) == 3 ?
                                                '<div class="form-row">' +
                                                '<div class="col-xs-2">' +
                                                '<div class="form-group">' +
                                                '<label id="" for="" class="smallTitulo">Fecha de Inicio Real </label>' +
                                                '<p id="" for="" class="smallCampo"> ' + (data1['datadeta'][index]['FEC_INI_REAL']) + ' </p>' +
                                                '</div>' +
                                                '</div>' +
                                                '<div class="col-xs-2">' +
                                                '<div class="form-group">' +
                                                '<label id="" for="" class="smallTitulo">Fecha Fin Real </label>' +
                                                '<p id="" for="" class="smallCampo"> ' + (data1['datadeta'][index]['FEC_END_REAL']) + ' </p>' +
                                                '</div>' +
                                                '</div>' +
                                                '</div>' : '') +
                                                    (parseInt(@Session["ID_ACCO"]) == 60 ?
                                                        '<div class="form-row">' +
                                                        '<div class="col-xs-2">' +
                                                        '<div class="form-group">' +
                                                        '<label id="" for="" class="smallTitulo">Locación </label>' +
                                                        '<p id="" for="" class="smallCampo"> ' + (data1['datadeta'][index]['LOCATION']) + ' </p>' +
                                                        '</div>' +
                                                        '</div>' +
                                                        '<div class="col-xs-2">' +
                                                        '<div class="form-group">' +
                                                        '<label id="" for="" class="smallTitulo">Razón </label>' +
                                                        '<p id="" for="" class="smallCampo"> ' + (data1['datadeta'][index]['RAZON']) + ' </p>' +
                                                        '</div>' +
                                                        '</div>' +
                                                        '<div class="col-xs-2">' +
                                                        '<div class="form-group">' +
                                                        '<label id="" for="" class="smallTitulo">Solman  </label>' +
                                                        '<p id="" for="" class="smallCampo"> ' + (data1['datadeta'][index]['SOLMAN']) + ' </p>' +
                                                        '</div>' +
                                                        '</div>' +
                                                        '<div class="col-xs-2">' +
                                                        '<div class="form-group">' +
                                                        '<label id="" for="" class="smallTitulo">Tipo de Pase  </label>' +
                                                        '<p id="" for="" class="smallCampo"> ' + (data1['datadeta'][index]['TIPOPASE']) + ' </p>' +
                                                        '</div>' +
                                                        '</div>' +
                                                        '<div class="col-xs-2">' +
                                                        '<div class="form-group">' +
                                                        '<label id="" for="" class="smallTitulo">Analista  </label>' +
                                                        '<p id="" for="" class="smallCampo"> ' + (data1['datadeta'][index]['ANALISTA']) + ' </p>' +
                                                        '</div>' +
                                                        '</div>' +
                                                        '<div class="col-xs-2">' +
                                                        '<div class="form-group">' +
                                                        '<label id="" for="" class="smallTitulo">Modalidad de Trabajo  </label>' +
                                                        '<p id="" for="" class="smallCampo"> ' + (data1['datadeta'][index]['MODALIDAD_TRABAJO']) + ' </p>' +
                                                        '</div>' +
                                                        '</div>' +
                                                        '<div class="col-xs-2">' +
                                                        '<div class="form-group">' +
                                                        '<label id="" for="" class="smallTitulo">Reportado por  </label>' +
                                                        '<p id="" for="" class="smallCampo"> @ViewBag.GrupoReportador  </p>' +
                                                        '</div>' +
                                                        '</div>' +
                                                        '</div>' : '') +
                                                            '<div class="form-row">' +
                                                            '<div class="col-xs-2">' +
                                                            '<div class="form-group">' +
                                                            '<a><img width="80" class="rounded-circle" src="/Content/Fotos/' + (data1['datadeta'][index]['PHOTO']) + '.jpg"/></a>' +
                                                            '</div>' +
                                                            '</div>' +
                                                            '<div class="col-md-10">' +
                                                            '<div class="main-card mb-3 card mr-1" style="overflow:auto;">' +
                                                            '<div class="card-header">' +
                                                            '<i class="header-icon lnr-laptop-phone icon-gradient bg-plum-plate"> </i>Creado por ' + (data1['datadeta'][index]['CREA_BY']) +
                                                            '<div style="padding-top:3px; padding-right:1%; float:right; width:64%; text-transform:capitalize; text-align:right;">' +
                                                            '<div >' +
                                                            'Asignado A ' +
                                                            (data1['datadeta'][index]['ASSI_TO']) +
                                                            ("@ViewBag.ACCESO_EDIT" == 1 ?
                                                                '|<a style="cursor:pointer; color:#369;" href="javascript:void(0)" data-toggle="modal" data-target="#miModal"  onclick="EditComment(@ViewBag.ID_TICK)"> Editar </a>'
                                                                : '') +
                                                            ("@ViewBag.ACCESO_SEND_SURVEY" == 1 && (data1['datadeta'][index]['ID_STAT']) == 6 ?
                                                                '|<a style="cursor:pointer; color:#369;" href="javascript:void(0)" onclick="FcnSendSurvey(@ViewBag.ID_TICK)"> Enviar Encuesta </a>'
                                                                : '') +
                                                            '</div>' +
                                                            ("@ViewBag.ID_ACCO" == 60 ?
                                                                '<div style="text-transform:capitalize">Area Responsable: @ViewBag.NOM_AREA</div>'

                                                                : '') +
                                                            '</div>' +
                                                            '</div>' +
                                                            '<div class="card-body">' +
                                                            '<p>' + (data1['datadeta'][index]['SUM_TICK']) + '</p>' +
                                                            '<p>' + (data1['datadeta'][index]['Adicional1']) + '</p>' +
                                                            '<p>' + (data1['datadeta'][index]['Adicional2']) + '</p>' +
                                                            '</div>' +
                                                            '<div class="card-footer">' +
                                                            (data1['datadeta'][index]['ATTA']) +
                                                            '</div>' +
                                                            '</div>' +
                                                            '</div>' +
                                                            '</div>'

            );
        $("#divComentario").append(
            (parseInt(@Session["ID_ACCO"]) == 60 && (data1['datadeta'][index]['ID_STAT']) == 4 ?
                '<div class="form-row">' +
                '<div class="col-xs-2>' +
                '</div>' +
                '<div class="col-md-6">' +
                '<div class="main-card mb-3 card mr-1" style="overflow:auto;">' +
                '<div class="card-header">' +
                'Solución ' +
                '</div>' +
                '<div class="card-body">' +
                '<p>' + (data1['datadeta'][index]['Solucion']) + '</p>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>'
                : '')
            );


        if ((data1['datadeta'][index]['ID_ACCO']) == 4) {
            $("#divCIA").html(data1['datadeta'][index]['CIA'] + ' - ' + data1['datadeta'][index]['COMPEND']);
            $("#divCIA").attr("title", data1['datadeta'][index]['COMP'] + ' - ' + data1['datadeta'][index]['COMPEND']);
        }

        /*Gestión del Conocimiento*/
        //detailUser(data1['datadeta'][index]['ID_PERS_ENTI_END']);
        /*Fin*/

        $("#idUsuario").val(data1['datadeta'][index]['ID_PERS_ENTI_END']);
        ListAllAttach();

        //GetIdioma();


    });

    $.each(data1['data'], function (index, value) {
        $("#divActivities").append(
            '<a href="#" onclick="mover(' + (data1['data'][index]['ID_DETA_TICK']) + ')"><div class="listActCont">' +
            '<div class="form-row">' +
            '<div class="col-md-4">' +
            '<div class="form-group">' +
            '<label id="" for="" class="" style="text-transform:capitalize">' + (data1['data'][index]['NAM_TYPE_DETA_TICK']) + '-' + (data1['data'][index]['MinutosTranscurridos']) + ' m' + '</label>' +
            '</div>' +
            '</div>' +
            '<div class="col-md-4">' +
            '<div class="form-group">' +
            '<label id="" for="" class="" style="text-transform:capitalize">' + (data1['data'][index]['CREATE_DETA_INCI']) + '</label>' +
            '</div>' +
            '</div>' +
            '<div class="col-md-4">' +
            '<div class="form-group">' +
            '<label id="" for="" class="" style="text-transform:capitalize">' + (data1['data'][index]['PERS']) + '</label>' +
            '</div>' +
            '</div>' +
            '</div>' +
            '</a>'
        );

        $("#divDetails").append(

            '<div class="chat-wrapper" id="' + (data1['data'][index]['ID_DETA_TICK']) + '">' +
            '<div class="chat-box-wrapper" >' +
            '<div>' +
            '<div class="avatar-icon-wrapper mr-1">' +
            '<div class="avatar-icon avatar-icon-lg rounded">' +
            '<img src="/Content/Fotos/' + (data1['data'][index]['PHOTO']) + '.jpg" />' +
            '</div>' +
            '</div>' +
            '</div>' +
            '<div>' +
            (("@ViewBag.ACCESO_EDIT" == 1 || "@ViewBag.UserId" == (data1['data'][index]['UserId'])) ?
                '<div class="float-right text-muted small">' +
                '<a style="color:#369; cursor:pointer;" data-toggle="modal" data-target="#miModal" onclick="EditDetailComment(' + data1['data'][index]['INEX'] + ')"> Edit</a>' +
                '</div>' : '') +
            '<label href="javascript:void(0)" style="color:#336699;text-transform:capitalize">' + (data1['data'][index]['PERS']).toLowerCase() + ' </label> <label> ' + (data1['data'][index]['CREATE_DETA_INCI']) + ' ' + (data1['data'][index]['Causa']) + '</label>' +
            '<div class="text-muted small">Inicio Actividad: ' + (data1['data'][index]['DATE_INIC']) + ' &nbsp; &nbsp; &nbsp; &nbsp; Fin Actividad: ' + (data1['data'][index]['DATE_END']) + '</div>' +
            '<div class="text-muted small" style="text-transform:capitalize">' + (data1['data'][index]['NAM_TYPE_DETA_TICK']).toLowerCase() + ' ' +
            ((data1['data'][index]['ID_TYPE_DETA_TICK']) == 3 ? (": " + (data1['data'][index]['NAM_STAT']).toLowerCase() + " " + (data1['data'][index]['FEC_SCHE'])) : '') +
            ((data1['data'][index]['ID_TYPE_DETA_TICK']) == 2 ? (": " + data1['data'][index]['ASSI']).toLowerCase() : '') +
            ((data1['data'][index]['ID_TYPE_DETA_TICK']) == 8 ? (": " + data1['data'][index]['NAM_STAT_SALE_OPPO']).toLowerCase() + " | Ammount: $ " + (data1['data'][index]['AMM_SALE_OPP']) + " | Profit:" + (data1['data'][index]['PRO_SALE_OPP']) + " %" : '') +
            ((data1['data'][index]['ID_TYPE_DETA_TICK']) == 9 ? (": " + data1['data'][index]['FROM_TIME'] + " - " + data1['data'][index]['TO_TIME']) : '') +
            '</div>' +
            ((data1['data'][index]['ID_TYPE_DETA_TICK']) == 3 && (data1['data'][index]['NAM_STAT']).toLowerCase() == 'programado' && (data1['data'][index]['MotivoEspera']) != '' ? '<div class="text-muted small">Motivo de Espera: ' + (data1['data'][index]['MotivoEspera']) + '</div>' : '') +
            '<div class="chat-box">' +
            '<div class="form" id="clipboard' + (data1['data'][index]['ID_DETA_TICK']) + '">' +
            (data1['data'][index]['COM_DETA_INCI']) +
            '</div>' +
            '</div>' +
            '<div class="small mt-2">' +
            (data1['data'][index]['ADJ']) +
            '</div>' +
            '</div>' +
            '</div>' +
            '</div>' +
            '</div>');

    });

    $.each(data1['listaLeccionAprendida'], function (index, value) {

        /*Gestión de problemas*/
        $("#divLeccionAprendida").append('<div class="detailsSummary">' +
            '<div id="detSummary">' +
            '<div class="containerdt">' +
            '<div class="userData">' +
            '<div class="asignedImage"><div ><img src="/Content/Fotos/prueba.jpg"/></div></div>' +
            '</div>' +

            '<div class="messageData">' +
            '<div class="messageArrow"></div>' +
            '<div class ="messageBoxDet">' +
            '<label>Lección aprendida Ticket problema</label> <a target="_blank" href="#/KnowledgeManagement/EditLessonLearned/' + data1['listaLeccionAprendida'][index]['idLeccionAprendida'] + '"' + ' style="text-decoration:none;"><span class="glyphicon glyphicon-play" aria-hidden="true"></span><span>' + data1['listaLeccionAprendida'][index]['idLeccionAprendida'] + '</span></a>' +
            '</div>' +
            '<div class="msgBoxBody">' +
            '<spam><label>Título</label><p>' +
            (data1['listaLeccionAprendida'][index]['Titulo']) +
            '</p><label>Categoría</label><p>' +
            (data1['listaLeccionAprendida'][index]['Categoria']) +
            '</p></spam>' +
            '</p><label>Descripción</label><p>' +
            (data1['listaLeccionAprendida'][index]['Descripcion']) +
            '</p></spam>' +
            //   '</p><label>Solución Aplicada</label><p>' +
            //(data1['listaLeccionAprendida'][index]['SolucionAplicada']) +
            //'</p></spam>' +
            '</p><label>Impacto</label><p>' +
            (data1['listaLeccionAprendida'][index]['Impacto']) +
            '</p></spam>' +
            '</p><label>Solución Temporal</label><p>' +
            (data1['listaLeccionAprendida'][index]['SolucionTemporal']) +
            '</p></spam>' +
            '</p><label>Solución Definitiva</label><p>' +
            (data1['listaLeccionAprendida'][index]['SolucionDefinitiva']) +
            '</p></spam>' +
            '</div>' +
            '</div>' +//message Data
            '</div>' +
            '</div>' +
            '</div>');
        /*Fin*/
    });

        if ("@ViewBag.ID_ACCO" == 60) {
            ListarComentariosTareas();
        }
    },
    error: function (source) {
        console.error("Error al obtener datos del incidente:", source);
    }
    });

    }

    function ListarComentariosTareas() {
        $.ajax({
            contentType: 'application/json; charset=utf-8',
            url: "/Tarea/ListarComentariosTareasBNV?idTicket=@ViewBag.ID_TICK",
            type: "GET",
            datatype: "JSON",
            cache: false,
            success: function (data) {
                var comentarios = data.Data;
                if (comentarios.length > 0) {
                    $.each(comentarios, function (index, value) {
                        $("#divDetails").append(
                            '<div class="chat-wrapper" id="' + (comentarios[index]['IdTareaDetalle']) + '">' +
                                '<div class="chat-box-wrapper" >' +
                                    '<div>' +
                                        '<div class="avatar-icon-wrapper mr-1">' +
                                            '<div class="avatar-icon avatar-icon-lg rounded">' +
                                                '<img src="/Content/Fotos/' + (comentarios[index]['Foto']) + '.jpg" />' +
                                            '</div>' +
                                        '</div>' +
                                    '</div>' +
                                    '<div>' +
                                        '<label style="color:#336699;text-transform:capitalize">' + (comentarios[index]['Usuario']).toLowerCase() + ' </label> <label> ' + (comentarios[index]['FechaCreacion']) + '</label>' +
                                        '<div class="text-muted small">Tarea: ' + (comentarios[index]['CodigoTarea']) + '</div>' +
                                        '<div class="text-muted small">Estado : ' + (comentarios[index]['Estado']) + '</div>' +
                                        '<div class="chat-box">' +
                                            '<div class="form" id="clipboard' + (comentarios[index]['IdTareaDetalle']) + '">' +
                                                (comentarios[index]['Comentario']) +
                                            '</div>' +
                                        '</div>' +
                                    '</div>' +
                                '</div>' +
                            '</div>');
                    });
                }
            },
            error: function () {
            }
        });
    }


    @* urlGet = "@Url.Content("~/Account/cambioIdiomaxLlave2 / ")";
    function GetIdioma() {

        //fetch(urlGet)
        //    .then(function (response) {
        //        return response.text();
        //    })
        //    .then((data) => {
        //        console.log(data)
        //    })
        const data = new URLSearchParams("llave=Estado|UsuarioSolicitante|UsuarioAfectado|NivelDeServicio|TiempoDeExpiración|Prioridad|UnidaddeNegocio|Macroservicio|Servicio|Incidente/Requerimiento|" +
            "Tema|Fuente|FechaCreación|FechaModificación|Adjuntos|ControlRemoto|Servicio2|FechaRecepciónDeSolicitud|Creadopor|Asignadoa|TicketExterno");
        fetch(urlGet, {
            method: 'POST',
            body: data
        })
            .then(function (response) {
                if (response.ok) {
                    return response.json()

                } else {
                    throw "Error en la llamada Ajax";
                }

            })
            .then(function (response) {
                //localStorage.setItem("palabras", JSON.stringify(response));
                document.getElementById(response[0].llave).innerHTML = response[0].texto;
                document.getElementById(response[1].llave).innerHTML = response[1].texto;
                document.getElementById(response[2].llave).innerHTML = response[2].texto;
                document.getElementById(response[3].llave).innerHTML = response[3].texto;
                document.getElementById(response[4].llave).innerHTML = response[4].texto;
                document.getElementById(response[5].llave).innerHTML = response[5].texto;
                document.getElementById(response[6].llave).innerHTML = response[6].texto;
                document.getElementById(response[7].llave).innerHTML = response[7].texto;
                document.getElementById(response[8].llave).innerHTML = response[8].texto;
                document.getElementById(response[9].llave).innerHTML = response[9].texto;
                document.getElementById(response[10].llave).innerHTML = response[10].texto;
                document.getElementById(response[11].llave).innerHTML = response[11].texto;
                document.getElementById(response[12].llave).innerHTML = response[12].texto;
                document.getElementById(response[13].llave).innerHTML = response[13].texto;
                document.getElementById(response[14].llave).innerHTML = response[14].texto;
                document.getElementById(response[15].llave).innerHTML = response[15].texto;
                document.getElementById(response[16].llave).innerHTML = response[16].texto;
                document.getElementById(response[17].llave).innerHTML = response[17].texto;
                document.getElementById(response[18].llave).innerHTML = response[18].texto;
                document.getElementById(response[19].llave).innerHTML = response[19].texto;
                document.getElementById(response[20].llave).innerHTML = response[20].texto;
                //response.forEach(palabras => {
                //    var llave = `"${palabras.llave}"`;
                //    console.log(llave);

                //    var texto = "";
                //    texto += `${palabras.texto}`;
                //    let pal = JSON.parse( )
                //    document.getElementById(llave).innerHTML = texto;
                //});
            })
            .catch(function (err) {
                console.log(err);
            });


    };*@

        function obtenerlocal() {

            $myLocalStorage = JSON.parse(localStorage.getItem("palabras"));
            //let clave = palabras.length;
            //palas.forEach(function (palabras) {
            //    let vllave = palabras.llave;
            //    let vtexto = palabras.texto;
            //    let pal = document.getElementById(vllave);
            //pal.innerHTML = "<label>" + vtexto + "</label>";
            //var llave = palas[0].llave;
            //var uno = palas[0].texto;
            //console.log($myLocalStorage.get('palabras');
            ////document.getElementById(palas[0].llave).innerHTML = palas[0].texto;
            ////document.getElementById(palas[1].llave).innerHTML = palas[1].texto;
            ////document.getElementById(palas[2].llave).innerHTML = palas[2].texto;
            //localStorage.removeItem('palabras');
            //console.log($myLocalStorage);
            //console.log(uno);
            //});
        }


    function removestorage() {
        var item_detail = JSON.parse(localStorage.getItem("palabras")) || [];
        $.each(item_detail, function (index, obj) {
            if (key_id == data('palabras')) {
                item_detail.splice(index, 1);
                localStorage["palabras"] = JSON.stringify(item_detail);
                return false;
            }
        });
    }

    function EditComment(id) {

        $("#lblTitulo").text("Editar Descripción");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-lg");

        $('#modal-content').empty();
        if (@ViewBag.ID_ACCO == 56 || @ViewBag.ID_ACCO == 57 || @ViewBag.ID_ACCO == 58) {
            $('#modal-content').load("/Ticket/UpdateDateTicketMinsur/" + id + "?_=" + Math.random());
        } else {
            $('#modal-content').load("/Ticket/UpdateDateTicket/" + id + "?_=" + Math.random());
        }

        //$("#divFrmLoadSummary").empty();

        //if (parseInt(@Session["ID_ACCO"]) == 17) {
        //$("#divFrmLoadSummary").load("/Ticket/UpdateDateTicket/" + id + "?_=" + Math.random());
        //}
        //else {
        //    $("#divFrmLoadSummary").load("/Ticket/EditSummary/" + id + "?_=" + Math.random());
        //}

    }

    function EditDetailComment(id) {
        $("#lblTitulo").text("Editar Comentario");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-lg");

        $('#modal-content').empty();
        $('#modal-content').load("/DetailsTicket/UpdateDatesDetailsTicket/" + id + "?_=" + Math.random());

        //$("#divFrmLoadSummary").empty();
        @*if (parseInt(@Session["ID_ACCO"]) == 17 )
        *@//{
        //$("#divFrmLoadSummary").load("/DetailsTicket/UpdateDatesDetailsTicket/" + id + "?_=" + Math.random());
        //}
        //else {
        //$("#divFrmLoadSummary").load("/DetailsTicket/EditSummary/" + id + "?_=" + Math.random());
        //}
    }

    function winPopUpModal(title, contHtml, ancho, alto) {

        var altobkg = 0;
        var top = 0;
        altpan = $(window).height(); // devuelve la altura del viewport del navegador
        altobkg = $(document).height(); // devuelve la altura del documento HTML
        altbar = $(window).scrollTop(); // devuelve la posición vertical actual de la barra de scroll
        top = altbar + (altpan / 2);
        $("#divpopupmodal").prepend("<div id='bkg' class='backgroundcad' style='z-index: 999; display: visibility; height: " + altobkg + "px;'>" +
            "<div id='dlg' class='modalcad' style='z-index: 999; display: none; top: " + a_entero(top) + "px; width: " + a_entero(ancho) + "px; margin-left: -" + a_entero(ancho) / 2 + "px; height: " + a_entero(alto) + "px; margin-top: -" + a_entero(alto) / 2 + "px;'>" +
            "<div id='titulomodal' class='titlemodalcad'>" +
            "<div id='closebtnmodal' class='closebtnmodalcad' title='Cerrar'>X</div>" +
            "</div><div id='contenidomodal' class='contenidomodal'></div></div></div>");

        if ($('#bkg').css("visibility") == 'hidden') {
            document.getElementById('bkg').style.visibility = '';
            $("#bkg").hide();
        }
        if ($('#bkg').css("visibility") == 'hidden') {
            document.getElementById('dlg').style.visibility = '';
            $("#dlg").hide();
        }
        $("#bkg").fadeIn(300, "linear", function () {
            $("#dlg").show(200, "swing");
            $("#titulomodal").prepend(title)
            $("#contenidomodal").prepend('<div style="text-align:justify">' + contHtml + '</div>')
        });
        $("#closebtnmodal").click(function () {
            $("#dlg").hide('200', "swing", function () {
                $("#bkg").fadeOut("300");
            });
        });
    }

    function fxNewComment(obj) {
        ChangeX();

        $("#linkNC").addClass("activeNavDT");
        $("#divCausa").removeClass("divHide");
        if (@ViewBag.TicketProyecto == 1) {
            $("#subcategorizacionPry").removeClass("divHide");
            $("#divCtrlRemot").removeClass("divHide");
        } else {
            $("#subcategorizacionPry").addClass("divHide");
            $("#divCtrlRemot").addClass('divHide');
        }
        $("#ID_TYPE_DETA_TICK").val(1);

        $("#FEC_END_REAL").val('');
        //$("#divTypeTicket5").removeClass("divHide");
    }
    function fxSchedule(obj, eve) {
        ChangeX();
        $("#linkSCH").addClass("activeNavDT");
        $("#ID_TYPE_DETA_TICK").val(3);
        $("#ID_STAT").val(5);

        $("#fechaScheduled").removeClass("divHide");
        $("#divEsperaPorCliente").removeClass("divHide");
        $("#divTypeTicket3").removeClass("divHide");
        $("#fechaRealTermino").addClass("divHide");
        $("#divCausa").addClass("divHide");
        //Subcategorizacion de proyecto
        $("#subcategorizacionPry").addClass("divHide");
        $("#divCtrlRemot").addClass("divHide");
    }

    function fxUpdateStatus() {
        ChangeX();
        $("#linkUS").addClass("activeNavDT");
        $("#divCausa").addClass("divHide");
        //Subcategorizacion de proyecto
        $("#subcategorizacionPry").addClass("divHide");
        $("#divCtrlRemot").addClass("divHide");

        $("#ID_TYPE_DETA_TICK").val(3);

        $("#divStatus").removeClass("divHide");
        $("#divTypeTicket3").removeClass("divHide");

        if ($("#ID_STAT").val() == 5) {
            if (@Session["ID_ACCO"] == 60) {
                $("#ID_STAT").data("kendoComboBox").value(5);
            } else {
                $("#ID_STAT").data("kendoComboBox").value(5);
            }


            $("#fechaScheduled").removeClass("divHide");
            $("#divEsperaPorCliente").removeClass("divHide");
        }
    }

    function fxTransferTo() {
        ChangeX();
        $("#linkTT").addClass("activeNavDT");
        $("#divCausa").addClass("divHide");
        //Subcategorizacion de proyecto
        $("#subcategorizacionPry").addClass("divHide");
        $("#divCtrlRemot").addClass("divHide");

        $("#divTypeTicket2").removeClass("divHide");
        $("#ID_TYPE_DETA_TICK").val(2);
    }

    function fxTimer() {
        ChangeX();
        $("#linkTimer").addClass("activeNavDT");

        $("#ID_TYPE_DETA_TICK").val(9);
    }

    function fxOptions() {
        ChangeX();
        $("#linkOptions").addClass("activeNavDT");

        if (i_conf == 0) {
            $("#divDTOptions").css("height", 135);
            $("#divDTOptions").css("border", "1px solid #e2e2e2");
            i_conf = 1;
        }
        else {
            $("#divDTOptions").css("height", 0);
            $("#divDTOptions").css("border", "0px solid #e2e2e2");
            i_conf = 0;
        }
    }

    function ChangeX() {
        $("#linkSCH").removeClass("activeNavDT");
        $("#linkNC").removeClass("activeNavDT");
        $("#linkUS").removeClass("activeNavDT");
        $("#linkTT").removeClass("activeNavDT");
        $("#linkTimer").removeClass("activeNavDT");
        $("#linkOptions").removeClass("activeNavDT");
        $("#divTypeTicket2").addClass("divHide");
        $("#divTypeTicket3").addClass("divHide");
        $("#fechaScheduled").addClass("divHide");
        $("#divStatus").addClass("divHide");
        $("#divEsperaPorCliente").addClass("divHide");
        $("#divControlRemoto").addClass("divHide");
        //$("#divTypeTicket5").addClass("divHide");

        $("#ID_QUEU").data("kendoComboBox").value("");
    }

    function FcnSendSurvey(id) {

        swal({
            title: 'Warning',
            text: 'Are you sure to send survey',
            type: "info",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "No",
            confirmButtonText: "Sí",
            closeOnConfirm: false
        }, function (dismiss) {
            if (dismiss) {
                $.ajax({
                    url: "/Ticket/SendSurveyTicket/",
                    data: "ID_TICK=" + id + "&var=" + Math.random(),
                    type: "POST",
                    cache: false,
                    dataType: "text",
                    success: function (resp) {
                        if (resp == "OK") {


                            swal({
                                title: 'Warning',
                                type: 'success',
                                text: 'Sent successfully',
                                focusConfirm: false,
                                confirmButtonText:
                                    'Continue',
                                confirmButtonAriaLabel: 'Thumbs up, great!'

                            })
                        }
                        else if (resp == "EXISTE") {

                            //alert("The survey was sent");
                            swal({
                                title: 'Warning',
                                type: 'info',
                                text: 'The survey was sent',
                                focusConfirm: false,
                                confirmButtonText:
                                    'Continue',
                                confirmButtonAriaLabel: 'Thumbs up, great!'

                            })

                        }
                        else {
                            alert(Error);
                        }
                    }
                });

            }

        })

    }

    function mover(IdTicketDetalle) {
        event.preventDefault();
        //$('html,body').animate({
        //    scrollTop: $("#" + IdTicketDetalle).offset().top
        //}, 1000);
        var elemento = document.getElementById("clipboard" + IdTicketDetalle);
        elemento.scrollIntoView({ behavior: "smooth", block: "end" });
        seleccionarTexto(IdTicketDetalle)
    }
    function seleccionarTexto(IdTicketDetalle) {
        var elemento = document.getElementById("clipboard" + IdTicketDetalle);
        var range = document.createRange();
        range.selectNodeContents(elemento);
        var seleccion = window.getSelection();
        seleccion.removeAllRanges();
        seleccion.addRange(range);
    }
    function GenerarCambio(id) {

        $("#lblTitulo").text("Gestión de Cambios");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-lg");

        $('#modal-content').empty();
        if (@ViewBag.ID_ACCO == 60) {
            //  $('#modal-content').load("/ChangeRequest/RegistrarGestionCambioBNV/" + @ViewBag.ID_TICK);
        } else {
            $('#modal-content').load("/ChangeRequest/RegistrarGestionCambio/" + @ViewBag.ID_TICK);
        }


        @* $("#divGenerarCambio").empty();
        $("#divGenerarCambio").load("/ChangeRequest/RegistrarGestionCambio/" + @ViewBag.ID_TICK);*@
    }
    function IrCambio(id) {
        if (@ViewBag.ID_ACCO == 60) {
            window.open("http://" + location.host + "/ResumenGestionCambioBNV/" + id)
        }
        else { window.open("http://" + location.host + "/ChangeRequest/ResumenGestionCambio/" + id) }
    }

    function OnPaste(e) {
        //var texto = e.html
        //if ((/^<img src="/).test(e.html)) {
        //    toastr.warning("No se permiten imágenes en este campo.");
        //    e.html = "";
        //}
        //if (texto.includes('<img data-imagetype=')) {
        //    toastr.warning("No se permiten imágenes en este campo.");
        //    e.html = "";
        //}
        if (/<img\s+[^>]*>/i.test(e.html)) {
            toastr.warning("No se permiten imágenes en este campo.");
            e.html = "";
        } else if ((/^<img src="data:image/).test(e.html)) {
            toastr.warning("No se permiten imágenes en este campo.");
            e.html = "";
        }
    }

    function RegistrarHoraReal() { // registrar hora real para Bnv
        $.ajax({
            url: "/Ticket/RegistrarHoraReal/",
            data: { ID_TICK: @ViewBag.ID_TICK
    },
    type: "GET",
        dataType: "text",
            success: function (source) {
                $("#fechaInicioReal").append('<div>' +
                    '<p class="smallTitulo">' +
                    'Fecha de inicio real:' +
                    '</p>' +
                    source +
                    '</div>')
                document.getElementById("BotonFechaReal").style.display = 'none'

                $("#ID_STAT").kendoDropDownList({
                    autoBind: true,
                    dataTextField: "NAM_STAT",
                    dataValueField: "ID_STAT",
                    index: -1,
                    dataSource: {
                        //type: "odata",
                        serverFiltering: false,
                        schema: {
                            data: "Data",
                            total: "Count"
                        },
                        transport: {
                            read: "/StatusTicket/StatusConditionBnv/?id=@ViewBag.ID_TICK&horaRegistrada=" + source
                        },
                        sort: { field: "NAM_STAT", dir: "asc" }
                    },
                    dataBound: function (e) {
                        var existe = e.sender.dataSource.data().filter(function (item) {
                            return item.ID_STAT == 0
                        })
                        if (existe.length == 0) {
                            e.sender.dataSource.add({
                                ID_STAT: 0,
                                NAM_STAT: ""
                            })
                        }
                    }
                }).data("kendoDropDownList").select(0);

            },
    error: function (source) {
    }
        });
    }
    function Mensaje(msg, msnErr) {
        if (msg == 'OK') {
            toastr.success(msnErr);

            //$("#id").submit();

        }
        else {
            toastr.warning(msnErr);
        }
    }
    function ValidarFechaReal() { // Fecha Real para Bnv

        $.ajax({
            url: "/Ticket/ValidarFechaReal/",
            data: { ID_TICK: @ViewBag.ID_TICK
    },
    type: "GET",
        dataType: "text",
            success: function (source) {
                data = source;
                //alert(data);

                if (data == "OK") {
                    $("#BotonFechaReal").attr("hidden", true);
                }
                else {
                    $("#BotonFechaReal").removeClass("active");
                }

            },
    error: function (source) {
    }
        });

    }

</script>
<script type="text/javascript">

    function ReportexTicket(id) {
        window.open("http://" + location.host + "/Ticket/ReporteTicketTarea/" + id)
    }


</script>

<script type="text/javascript">
    $(document).ready(function () {
        if (@ViewBag.ID_ACCO == 60) {
        //CargarPorcentaje()
    }
    });
    function CargarPorcentaje() {
        let progressBar = document.querySelector(".circular-progress");
        let valueContainer = document.querySelector(".value-container");

        let progressValue = 0;
        let progressEndValue = @ViewBag.PorcentajeTicket;
        let speed = 0;
        if (progressEndValue <= 500 && progressEndValue > 0) {
            speed = 10
            let progress = setInterval(() => {
                progressValue++;
                valueContainer.textContent = `${progressValue}%`;
                progressBar.style.background = `conic-gradient(
                      #4d5bf9 ${progressValue * 3.6}deg,
                      #cadcff ${progressValue * 3.6}deg
                  )`;
                if (progressValue == progressEndValue) {
                    clearInterval(progress);
                }
            }, speed);
        } else {
            valueContainer.textContent = `${progressEndValue}%`;
            progressBar.style.background = `conic-gradient(
                      #4d5bf9 ${progressEndValue * 3.6}deg,
                      #cadcff ${progressEndValue * 3.6}deg
                  )`
        }
    }


</script>
@model ERPElectrodata.Models.ACCOUNT_TYPE_ASSET
@{
    ViewBag.Title = "Cuenta Tipo Activo";
    Layout = null;
}
<link href="~/Content/themes/plugin/iCheck/square/blue.css" rel="stylesheet" />
<script src="~/Content/themes/plugin/iCheck/icheck.js"></script>

<style type="text/css">
    a.tooltip span {
        cursor: default;
        display: none;
        padding: 5px;
        margin: -25px 0px 0px 120px;
        width: 230px;
        position: relative;
        z-index: 9;
    }

    a.tooltip:hover span {
        display: block;
        position: absolute;
        background: #000;
        border: 1px solid #cccccc;
        color: #ddd;
        font-size: 14px;
        font-weight: normal;
        opacity: 0.9;
    }

    .bg-primary {
        background-color: rgb(81, 104, 130);
        font-size: 13px;
    }



    .contenido {
        background: #DCDCDE;
    }

    .detalle {
        font-size: 13px;
        color: #7F7F7F;
    }

    #caja {
        /*border:1px solid black;*/
        height: 30px;
        padding-top: -5px;
    }

    #pagerdivPrograma {
        margin-top: 0;
        padding-top: 0;
    }



    #BtnEditar {
        color: #2D5C88;
        background: #ffffff;
        border: 0;
    }

    b {
        color: #F83C50;
    }
</style>
<div class="afterMain" id="divContainerCrearCuenta">
    <div style="float: left; width:100%">
        <div class="titleForm">
            <div class="title" style="visibility:hidden">
                Cuenta Tipo Activo
            </div>
        </div>

        <div id="FrmComponente">
            <div class="bodyForm" id="divNuevaLicencia">
                <div class=" inbodyform">
                    <!--Declaración de Formulario-->
                    @using (Html.BeginForm("CrearCuentaTA", "TipoActivo", FormMethod.Post, new { enctype = "multipart/form-data", id = "FrmComponente", target = "upload_target" }))
                    {
                        @Html.ValidationSummary(true)
                        <fieldset>
                            <legend>Cuenta Tipo Activo</legend>
                            <div class="form-row">
                                <div class="col-md-4">
                                    <div class="editor-label">
                                        Cuenta <b>*</b>
                                    </div>
                                    <div class="editor-field">
                                        @Html.TextBoxFor(model => model.ID_ACCO)
                                        @Html.ValidationMessageFor(model => model.ID_ACCO)
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-row">
                                        @*<div id="divRequest" class="col-md-4">
                                        Tipo Activo <b>*</b>
                                    </div>*@
                                        <div id="divRequestNew" onclick="NewTipoActivo()" style="cursor:pointer; display:inline-block; text-decoration:underline;" title="Click here to register a new type asset" data-toggle="modal" data-target="#miModal">
                                            Tipo Activo <b>*</b>
                                        </div>
                                        <button type="button" id="editCombo" style="display: none;" class="btn fas fa-pen-square p-0 ml-2" onclick="Editar()" title="Editar Tipo Activo" data-toggle="modal" data-target="#miModal"></button>
                                    </div>
                                    <div class="editor-field">
                                        @Html.TextBoxFor(model => model.ID_TYPE_ASSE)
                                        @Html.ValidationMessageFor(model => model.ID_TYPE_ASSE)
                                    </div>
                                </div>

                                @*<div class="col-md-4" style="position:absolute;left:465px;top:93px;">
                                <button type="button" id="editCombo" style="display: none; position: absolute;" class="btn fas fa-pen-square" onclick="Editar()" title="Editar Tipo Activo"></button>
                            </div>*@

                                <div class="col-md-4">
                                    <div class="editor-label">
                                        Meses <b>*</b>
                                    </div>
                                    <div class="editor-field">
                                        <input id="MONTH_LIFE" name="MONTH_LIFE" />
                                    </div>
                                </div>
                            </div>
                            <br />
                            <div class="form-row">
                                <div class="col-md-2 ml-auto">
                                    <button id="Buscar" type="button" class="btn btn-primary btn-block">Buscar</button>
                                </div>

                                <div class="col-md-2">
                                    <button id="submit" class="btn btn-warning btn-block">Crear</button>
                                </div>
                            </div>
                            <br />
                            <br />
                        </fieldset>
                    }
                </div>
            </div>
        </div>
    </div>
</div>


<!--Cuadro necesario para enviar archivos Adjuntos si realizar reload de toda la página.-->
<iframe id="upload_target" name="upload_target" src="" style="display:none"></iframe>
@*<div style="width: 100%; margin:15px auto;" id="cabecera">
    <div class="bodyForm">
        <div class="inBodyForm" style="height:100%; background-color:white">
            <div class="bg-primary" style="width:100%;">
                <div class="bg-primary" style="float:left; width:100%;">&nbsp;</div>
                <div class="bg-primary" style="float:left; width:1%">&nbsp;</div>
                <div class="bg-primary" style="float:left; width:27%"><strong>Cuenta</strong></div>
                <div class="bg-primary" style="float:left; width:1%">&nbsp;</div>
                <div class="bg-primary" style="float:left; width:40%"><strong>Tipo de Activo</strong></div>
                <div class="bg-primary" style="float:left; width:1%">&nbsp;</div>
                <div class="bg-primary" style="float:left; width:28%"><strong>Meses</strong></div>
                <div class="bg-primary" style="float:left; width:1%">&nbsp;</div>
                <div class="bg-primary" style="float:left; width:0%"><strong>  </strong></div>
                <div class="bg-primary" style="float:left; width:1%">&nbsp;</div>
            </div>
            <div style="float:left; width:100%;height:10px;"></div>
            <div id="divComponente" class="contentView"></div>
            <div id="pagerdivComponente" class="contentViewPager" style="width:99%"></div>
        </div>
    </div>
</div>*@
<div class="row" id="cabecera">
    <div class="col-md-12">
        <table class="table mb-0">
            <thead class="thead-dark">
                <tr>
                    <th style="width:25%"><center>Cuenta</center></th>
                    <th style="width:32%"><center>Tipo de Activo</center></th>
                    <th style="width:25%"><center>Meses</center></th>
                    <th><center>Accion</center></th>
                </tr>
            </thead>
        </table>
         <div id="divComponente" class="contentView"></div>
         <div id="pagerdivComponente" class="contentViewPager" style="width:99%"></div>
    </div>
</div>

<script type="text/x-kendo-tmpl" id="plantillaComponente">
    <div style="float:left; width:1%">&nbsp;</div>
    <div style="float:left; width:27%;height:20px;" class="detalle">${NAM_ACCO}</div>
    <div style="float:left; width:1%">&nbsp;</div>
    <div style="float:left; width:40%;height:30px;" class="detalle">${NAM_TYPE_ASSE}</div>
    <div style="float:left; width:1%">&nbsp;</div>
    <div style="float: left; width:18%" class="detalle">${MONTH_LIFE}</div>
    <div style="float:left; width:1%">&nbsp;</div>

    <div style="float: left;">
        <button type="button" id="BtnEditar" class="btn" onclick="EditarCuenta(${[IdTipoActivo]},${IdCuenta})" data-toggle="modal" data-target="\\#miModal">
            <i class="fas fa-edit"></i>
        </button>
    </div>

    @*<div style="float:left; width:10%">&nbsp;</div>*@
    <div style="float:left; width:100%;" id="caja"><hr /></div>
</script>

@*@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}*@
<script type="text/javascript">

    $(document).ready(function () {
        
        $("#Buscar").click(function () {
            $("#pagerdivComponente").empty();
            $("#divComponente").empty();

            if ($("#divComponente").data("kendoListView")) {
                $("#pagerdivComponente").data("kendoPager").destroy();
                $("#divComponente").data("kendoListView").destroy();
            }

            var dataGrilla = new kendo.data.DataSource({
                transport: {
                    read: {
                        url: "/TipoActivo/BuscarListarTipoActivo/0?var",
                        type: "GET",
                        dataType: "json",
                        data: {
                            q: "#kendoui",
                            ran: Math.random(),
                            ID_TYPE_ASSE: $("#ID_TYPE_ASSE").val() == '' ? 0 : $("#ID_TYPE_ASSE").val(),
                            ID_ACCO: $("#ID_ACCO").val() == '' ? 0 : $("#ID_ACCO").val(),
                            MONTH_LIFE: $("#MONTH_LIFE").val() == '' ? 0 : $("#MONTH_LIFE").val()
                        }
                    }
                },
                autoSync: true,
                serverFiltering: true,
                serverPaging: true,
                pageSize: 15,
                schema: {
                    data: "Data",
                    total: "Cantidad"
                }
            });
            $("#pagerdivComponente").kendoPager({
                dataSource: dataGrilla,
                pageSizes: [5, 10, 15],
                refresh: true
            });

            $("#divComponente").kendoListView({
                dataSource: dataGrilla,
                template: kendo.template($("#plantillaComponente").html())
            });

        });
        $("#Buscar").click();

        var ID_ACCO = $("#ID_ACCO").kendoComboBox({
            autoBind: true,
            dataTextField: "NAM_ACCO",
            dataValueField: "ID_ACCO",
            filter: "contains",
            delay: 500,
            minLength: 0,
            suggest: true,
            dataSource: {
                schema: {
                    data: "Data",
                    total: "Count"
                },
                transport: {
                    read: "/TipoActivo/ListarCuentaTipoActivo?var=" + Math.random()
                }
            }
        }).data("kendoComboBox");

        /*debugger;*/
        var ID_TYPE_ASSE = $("#ID_TYPE_ASSE").kendoComboBox({
            autoBind: true,
            dataTextField: "NAM_TYPE_ASSE",
            dataValueField: "ID_TYPE_ASSE",
            cascadeFrom: 'ID_ACCO',
            filter: "contains",
            autoBind: false,
            delay: 500,
            minLength: 0,
            suggest: true,
            dataSource: {
                serverFiltering: true,
                schema: {
                    data: "Data",
                    total: "Count"

                },
                transport: {
                    read: "/TypeAsset/ListarTipoActivoPorCuenta",
                    //error: function (e) {
                    //    console.log("Error en la solicitud:", e);
                    //}
                }
            }
        }).data("kendoComboBox");

        $("#MONTH_LIFE").kendoNumericTextBox({
            min: 0,
            decimals: 0,
            format: '#'
        });


        //$("#reset").click(function (event) {
        //    event.preventDefault();
        //    location.reload(true);
        //});
        //$("#divRequest").css("display", "none");
        //$("#divRequestNew").css("display", "inline-block");

        //Función para verificar cambio de registro seleccionado

        ID_TYPE_ASSE.bind("change", function (e) {
            if (ID_TYPE_ASSE.dataItem() === undefined) {
                $("#editCombo").css("display", "none");
            }
            else {
                $("#editCombo").css("display", "block");
            }
        });

    });

</script>

<script type="text/javascript">

    function uploadDone(msg, code, idComponente) {
        //if (msg == "OK") {
        //    winPopUpModal("Información Guardada / Notificación Enviada", "<div style='border-bottom:1px dotted #dadada;padding:0px 0px 20px 0px;'>"
        //        + "<div style='padding:10px 0px 10px 0px;'>La información ha sido actualizada.</div>"
        //        + "<div style='float:right; padding:30px 0px 0px 0px; '>" +
        //        "<button id='continues' class='k-button'>Continuar</button>" +
        //        "</div></div>", 400, 160);
        //    $("#continues").focus();
        //    var undo = $("#continues")
        //        .bind("click", function () {
        //            closeWinModalPopUp();
        //            //location = "http://" + location.host + "/#/Mantenimientos/";
        //            $("#MONTH_LIFE").val('');
        //            $("#Buscar").click();

        //        });

        //    $("#closebtnmodal").click(function () {
        //        closeWinModalPopUp();
        //        $("#MONTH_LIFE").val('');
        //        $("#Buscar").click();
        //    });
        //}
        //else if (msg == "EXISTE") {
        //    winPopUpModal("Alerta", "<div style='border-bottom:1px dotted #dadada;padding:0px 0px 20px 0px;'>" +
        //        "<div style='padding:10px 0px 10px 0px;'>La información ha sido registrada anteriormente</div>" +
        //        "<div style='float:right; padding:30px 0px 0px 0px; '>" +
        //        "<button id='continuee' class='k-button'>Continuar</button>" +
        //        "</div></div>"
        //        , 400, 140);
        //    $("#continuee").focus();
        //    var undo = $("#continuee")
        //        .bind("click", function () {
        //            closeWinModalPopUp();
        //        });
        //}
        //else {
        //    winPopUpModal("Alerta", "<div style='border-bottom:1px dotted #dadada;padding:0px 0px 20px 0px;'>" +
        //        "<div style='padding:10px 0px 10px 0px;'>Completar la información solicitada</div>" +
        //        "<div style='float:right; padding:30px 0px 0px 0px; '>" +
        //        "<button id='continuee' class='k-button'>Continuar</button>" +
        //        "</div></div>"
        //        , 400, 140);
        //    $("#continuee").focus();
        //    var undo = $("#continuee")
        //        .bind("click", function () {
        //            closeWinModalPopUp();
        //        });
        //}
        if (msg == "OK") {
             toastr.success("La información ha sido actualizada", "Información Guardada / Notificación Enviada");
            /*$("#btnCancelar").trigger({ type: "click" });*/
            $(".modal-dialog .close").click();
        }
        else if (msg == "EXISTE") {
             toastr.warning("La información ha sido registrada anteriormente", "Alerta");
            /* $("#btnCancelar").trigger({ type: "click" });*/
            $(".modal-dialog .close").click();
        }
        else {
           toastr.warning("Completar la información solicitada", "Alerta");
        }
    }

    //function NewTipoActivoOld() {
    //    var htmlForm = '<div id="FormNewTypeAsset"></div>';
    //    winFormPopUpModal("Nuevo Tipo Activo", htmlForm, 750, 420);
    //    $("#FormNewTypeAsset").load("/TipoActivo/Crear?var=" + Math.random());
    //}

    function NewTipoActivo() {
        $(".modal-dialog").removeClass("modal-xl");
        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-md");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-md");
        $("#lblTitulo").text("Nuevo Tipo Activo");
        $(".modal-title").addClass("ml-auto");
        $("#modal-content").empty();
        $("#modal-content").load("/TipoActivo/Crear?var=" + Math.random());
    }


    //function EditarCuentaOld(id, idAcco) {
    //    var htmlForm = '<div id="FormEditarCuenta"></div>';
    //    winFormPopUpModal("Editar Cuenta Tipo Activo", htmlForm, 500, 180);
    //    $("#FormEditarCuenta").load("/TipoActivo/EditarCuenta/" + id + "/" + idAcco);
    //    //window.open("/#/TipoActivo/Editar/" + id);
    //    return false;
    //}

    function EditarCuenta(id, idAcco) {
        $(".modal-dialog").removeClass("modal-xl");
        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-md");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-md");
        $("#lblTitulo").text("Editar Cuenta Tipo Activo");
        $(".modal-title").addClass("ml-auto");
        $("#modal-content").empty();
        $("#modal-content").load("/TipoActivo/EditarCuenta/" + id + "/" + idAcco);
    }

    //function EditarOld() {
    //    var combobox = $("#ID_TYPE_ASSE").data("kendoComboBox");
    //    if (a_entero(combobox.value()) > 0) {
    //        var htmlForm = '<div id="FrmEditarTipoActivo"></div>';
    //        winFormPopUpModal("Editar Tipo Activo", htmlForm, 750, 420);
    //        $("#FrmEditarTipoActivo").load("/TipoActivo/Editar?id=" + combobox.value() + "&var=" + Math.random());
    //    }
    //    else { $("#divEditCombo").css("display", "none"); }
    //}

    function Editar() {
        var comboTipoActivo = $("#ID_TYPE_ASSE").data("kendoComboBox");
        //if (comboTipoActivo.value() > 0) {
        //    var htmlForm = '<div id="FrmEditarTipoActivo"></div>';
        //    winFormPopUpModal("Editar Tipo Activo", htmlForm, 750, 420);
        //    $("#FrmEditarTipoActivo").load("/TipoActivo/Editar?id=" + comboTipoActivo.value() + "&var=" + Math.random());
        //}
        //else { $("#divEditCombo").css("display", "none"); }
        $(".modal-dialog").removeClass("modal-xl");
        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-md");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-md");
        $("#lblTitulo").text("Editar Tipo Activo");
        $(".modal-title").addClass("ml-auto");
        $("#modal-content").empty();
        $("#modal-content").load("/TipoActivo/Editar?id=" + comboTipoActivo.value() + "&var=" + Math.random());
    }

    function uploadDoneEditarCuenta(msg, code, idLicencia) {
        if (msg == "OK") {
            debugger
            toastr.success("La información ha sido actualizada", "Información Guardada / Notificación Enviada");
            /* $("#btnCancelar").trigger({ type: "click" });*/
            $(".modal-dialog .close").click();
            $("#Buscar").trigger({ type:"click" });
            //$("#Buscar").trigger({ type: "click" });
            //$("#Buscar").trigger({ type: "click" });
            //$("#Buscar").trigger({ type:" click" });
            //$("#divComponente").data("kendoListView").refresh();
            //$("#divComponente").data("kendoListView").refresh();
        }
        else {
            toastr.warning("Completar la información solicitada", "Error al registrar");
        }
    }
</script>


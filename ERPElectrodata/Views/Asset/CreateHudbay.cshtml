@model ERPElectrodata.Models.ASSET

@{
    ViewBag.Title = "Create";
    //Layout = null;
}


<script src="~/Content/themes/plugin/toastr/toastr.min.js"></script>
<link href="~/Content/themes/plugin/toastr/toastr.min.css" rel="stylesheet" />

<link href="~/Content/themes/plugin/DataTables/datatables.css" rel="stylesheet" />
<link href="~/Content/themes/plugin/DataTables/Buttons-1.4.2/css/buttons.bootstrap.css" rel="stylesheet" />
<link href="~/Content/themes/plugin/DataTables/DataTables-1.10.16/css/dataTables.bootstrap4.css" rel="stylesheet" />

<script src="~/Content/themes/plugin/DataTables/datatables.js"></script>
<script src="~/Content/themes/plugin/DataTables/Buttons-1.4.2/js/buttons.bootstrap.js"></script>
<script src="~/Content/themes/plugin/DataTables/Buttons-1.4.2/js/dataTables.buttons.js"></script>
<script src="~/Content/themes/plugin/DataTables/DataTables-1.10.16/js/dataTables.bootstrap4.js"></script>
<div class="mb-3 card">
    <div class="card-header-tab card-header">Nuevo Activo</div>
    <div class="card-body">
        @using (Html.BeginForm("CreateHudbay", "Asset", FormMethod.Post, new { enctype = "multipart/form-data", id = "FrmAsset", target = "upload_target" }))
        {
            <fieldset>
                @Html.HiddenFor(model => model.CREATE_ASSE)
                <input id="IdGrupoIT" name="IdGrupoIT" value="@ViewBag.IdGrupoIT" hidden />
                <div class="row">
                    <div class="col-sm-6 col-lg-3">
                        <div class="editor-label">
                            Tipo de Activo <b style="color:red">(*)</b>
                        </div>
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.ID_TYPE_ASSE)
                            @Html.ValidationMessageFor(model => model.ID_TYPE_ASSE)
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-3">
                        <div class="editor-label">
                            Código de Activo <b style="color:red">(*)</b>
                        </div>
                        <div class="k-textbox" style="width:100%">
                            @Html.EditorFor(model => model.COD_ASSE)
                            @Html.ValidationMessageFor(model => model.COD_ASSE)
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-3">
                        <div class="editor-label">
                            Número de Serie <b style="color:red">(*)</b>
                        </div>
                        <div class="k-textbox" style="width:100%">
                            @Html.EditorFor(model => model.SER_NUMB)
                            @Html.ValidationMessageFor(model => model.SER_NUMB)
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-3">
                        <div class="editor-label">
                            Nombre de Equipo <b style="color:red">(*)</b>
                        </div>
                        <div class="k-textbox" style="width:100%">
                            @Html.EditorFor(model => model.NAM_EQUI)
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6 col-lg-3">
                        <div class="editor-label">
                            <div id="divManufacturerNew" class="editor-label" onclick="NewManufacturer()" style="cursor:pointer;color:royalblue" title="Click aquí para registrar una marca." data-toggle="modal" data-target="#miModal">
                                Marca <b style="color:red">(*)</b>
                            </div>
                        </div>
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.ID_MANU)
                            @Html.ValidationMessageFor(model => model.ID_MANU)
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-3">
                        <div class="editor-label">
                            <div id="NuevoModeloComercial" class="editor-label" onclick="NewCommercialModel()" style="cursor:pointer;color:royalblue" title="Click aquí para registrar un modelo comercial.">
                                Modelo Comercial
                            </div>
                        </div>
                        <div class="editor-field">
                            @Html.TextBoxFor(model => model.ID_COMM_MODE)
                            @Html.ValidationMessageFor(model => model.ID_COMM_MODE)
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-3">
                        <div class="editor-label">
                            <div class="editor-label">
                                Orden de compra
                            </div>
                        </div>
                        <div class="k-textbox" style="width:100%">
                            @Html.TextBoxFor(model => model.OrdenCompra)
                            @Html.ValidationMessageFor(model => model.OrdenCompra)
                        </div>
                    </div>

                    <div class="col-sm-6 col-lg-3">
                        <div class="editor-label">
                            Fecha de Adquisición @ResourceLanguaje.Resource.DateFormat
                        </div>
                        <div class="editor-field">
                            @Html.EditorFor(model => model.ACQ_DATE)
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6 col-lg-3">
                        <div class="editor-label">
                            Locación <b style="color:red">(*)</b>
                        </div>
                        <div class="editor-field">
                            @Html.Editor("ID_LOCA")
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-3">
                        <div class="editor-label">
                            MAC Física
                        </div>
                        <div class="k-textbox" style="width:100%">
                            @Html.EditorFor(model => model.MAC_ADRR)
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-3">
                        <div class="editor-label">
                            MAC Inalámbrica
                        </div>
                        <div class="k-textbox" style="width:100%">
                            @Html.TextBoxFor(model => model.Mac_Address)
                            @Html.ValidationMessageFor(model => model.Mac_Address)
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-3">
                        <div class="editor-label">
                            Fecha de exp de garantía
                        </div>
                        <div class="editor-field">
                            @Html.EditorFor(model => model.fechaFinGarantia)
                        </div>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-sm-12 col-lg-12">
                        <div class="editor-label">
                            Comentario
                        </div>
                        <div class="editor-field">
                            @Html.TextAreaFor(model => model.SUM_ASSE)
                            @Html.ValidationMessageFor(model => model.SUM_ASSE)
                        </div>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-sm-12 col-lg-12">
                        <input name="archivos" id="archivos" type="file" />
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12 col-lg-8">
                        <br />
                    </div>
                    <div class="col-sm-12 col-lg-2">
                        <button id="reset" class="btn btn-light btn-block" onclick="cancel(); return false;">Ir al Listado</button>
                    </div>
                    <div class="col-sm-12 col-lg-2">
                        <button id="submit" class="btn btn-primary btn-block"><i class="fa fa-save"></i> Guardar</button>
                    </div>
                </div>
                <iframe id="upload_target" name="upload_target" src="" style="display:none;"></iframe>
            </fieldset>
        }
    </div>
</div>

<button id="btnMensajeConfirmacion" class="k-button" data-backdrop="static" data-keyboard="false" data-toggle="modal" data-target="#miModal" style="display:none">Mensaje</button>


@*@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}*@
<script type="text/javascript">

    $(document).ready(function () {


        $("#ID_TYPE_ASSE").kendoComboBox({
            index: 0,
            dataTextField: "NAM_TYPE_ASSE",
            dataValueField: "ID_TYPE_ASSE",
            filter: "contains",
            autoBind: true,
            delay: 500,
            minLength: 0,
            suggest: true,
            dataSource: {
                serverFiltering: false,
                schema: {
                    data: "Data",
                    total: "Count"
                },
                transport: {
                    read: "/TypeAsset/List?var=" + Math.random()
                }
            }
        });
        var ID_TYPE_ASSE = $("#ID_TYPE_ASSE").data("kendoComboBox");

        if (parseInt(@Session["ID_ACCO"]) == 19) {
            var DAT_STAR_LEAS = $("#DAT_STAR_LEAS").kendoDateTimePicker().data("kendoDateTimePicker");
            var DAT_END_LEAS = $("#DAT_END_LEAS").kendoDateTimePicker().data("kendoDateTimePicker");
            var fechaFinGarantia = $("#fechaFinGarantia").kendoDateTimePicker().data("kendoDateTimePicker");
        }

        $("#IdContrato").kendoComboBox({
            dataTextField: "Nombre",
            dataValueField: "Id",
            filter: "contains",
            autoBind: true,
            delay: 500,
            minLength: 0,
            suggest: true,
            dataSource: {
                serverFiltering: false,
                schema: {
                    data: "Data",
                    total: "Count"
                },
                transport: {
                    read: "/Contrato/Listar"
                }
            }
        });
        var IdContrato = $("#IdContrato").data("kendoComboBox");

        $("#ID_MANU").kendoComboBox({
            dataTextField: "NAM_MANU",
            dataValueField: "ID_MANU",
            filter: "contains",
            autoBind: false,
            suggest: true,
            dataSource: {
                schema: {
                    data: "Data",
                    total: "Count"
                },
                transport: {
                    read: "/Manufacturer/List?var=" + Math.random()
                }
            }
        });
        var ID_MANU = $("#ID_MANU").data("kendoComboBox");

        $("#ID_COMM_MODE").kendoComboBox({

            dataTextField: "NAM_COMM_MODE",
            dataValueField: "ID_COMM_MODE",
            cascadeFrom: 'ID_MANU',
            filter: "contains",
            autoBind: false,
            delay: 500,
            minLength: 0,
            suggest: true,
            dataSource: {
                serverFiltering: true,
                schema: {
                    data: "Data",
                    total: "Count"
                },
                transport: {
                    read: "/CommercialModel/List?var=" + Math.random()
                }
            }
        });
        var ID_COME_MODE = $("#ID_COMM_MODE").data("kendoComboBox");

        $("#ID_MANU_MODE").kendoComboBox({

            dataTextField: "NAM_MANU_MODE",
            dataValueField: "ID_MANU_MODE",
            cascadeFrom: 'ID_MANU',
            filter: "contains",
            autoBind: false,
            delay: 500,
            minLength: 0,
            suggest: true,
            dataSource: {
                serverFiltering: true,
                schema: {
                    data: "Data",
                    total: "Count"
                },
                transport: {
                    read: "/ManufacturerModel/List?var=" + Math.random()
                }
            }
        });
        var ID_MANU_MODE = $("#ID_MANU_MODE").data("kendoComboBox");

        $("#ID_COND").kendoComboBox({
            //index: 0,
            dataTextField: "TEXT",
            dataValueField: "ID_COND",
            template: '<div style="font-weight:bold;">${ data.NAM_STAT_ASSE }</div>' +
                        '<div>${ data.NAM_COND }</div>',
            filter: "contains",
            index: 1,
            autoBind: true,
            delay: 500,
            minLength: 0,
            suggest: true,
            dataSource: {
                serverFiltering: true,
                schema: {
                    data: "Data",
                    total: "Count"
                },
                transport: {
                    read: "/Condition/ListStatCondAsset?var=" + Math.random()
                }
            }
        });
        var ID_COND = $("#ID_COND").data("kendoComboBox");

        var FEC_TICK = $("#ACQ_DATE").kendoDateTimePicker().data("kendoDateTimePicker");
        var fechaFinGarantia = $("#fechaFinGarantia").kendoDateTimePicker().data("kendoDateTimePicker");

        $("#ID_LOCA").kendoComboBox({
            dataTextField: "text",
            dataValueField: "id",
            //template: '<div><div style="font-weight:bold;">${ data.NAM_SITE }</div>' +
            //            '<div>${ data.NAM_LOCA }</div></div>',
            filter: "contains",
            autoBind: false,
            suggest: true,
            dataSource: {
                serverFiltering: false,
                schema: {
                    data: "Data",
                    total: "Count"
                },
                transport: {
                    read: "/Location/ListarLocacionxCuenta?var=" + Math.random()
                }
            }
        });
        var ID_LOCA = $("#ID_LOCA").data("kendoComboBox");

        $("#ID_BUY_MODE").kendoComboBox({
            dataTextField: "NAM_BUY_MODE",
            dataValueField: "ID_BUY_MODE",
            filter: "contains",
            autoBind: true,
            index: 1,
            delay: 500,
            minLength: 0,
            suggest: true,
            dataSource: {
                serverFiltering: false,
                schema: {
                    data: "Data",
                    total: "Count"
                },
                transport: {
                    read: "/BuyMode/List?var=" + Math.random()
                }
            }
        });
        var ID_BUY_MODE = $("#ID_BUY_MODE").data("kendoComboBox");

        $("#ID_COST_CENT").kendoComboBox({
            dataTextField: "COD_COST_CENT",
            dataValueField: "ID_COST_CENT",
            filter: "contains",
            autoBind: false,
            suggest: true,
            dataSource: {
                //serverFiltering: true,
                schema: {
                    data: "Data",
                    total: "Count"
                },
                transport: {
                    read: "/CostCenter/List?var=" + Math.random()
                }
            }
        });
        var ID_COST_CENT = $("#ID_COST_CENT").data("kendoComboBox");

        $("#COST").kendoNumericTextBox({
            min: 0
        });

        $("#ValorActivo").kendoNumericTextBox({
            min: 0,
            max: 5,
            decimals: 0
        });

        $("#RiesgoIntrinseco").kendoNumericTextBox({
            min: 0,
            max: 11,
            decimals: 0
        });

        $("#SUM_ASSE").kendoEditor({
            encoded: false
        });
        var onSelectAttaCess = function (e) {
            $.each(e.files, function (index, value) {
                if (value.extension.toLowerCase() != ".pdf") {
                    e.preventDefault();
                    toastr.error("@ResourceLanguaje.Resource.AssetMessage8","@ResourceLanguaje.Resource.WrongFileExtension");
                }
            });
        };
        $("#archivos").kendoUpload({
            localization: {
                select: "Adjuntar"
            },
            select: onSelectAttaCess,
            multiple: false,
        });

        $("#submit").click(function () {
            toastr.info("Guardando...", "Espere por favor");
        });

    });
</script>

<script type="text/javascript">
    function NewManufacturer() {

        $("#lblTitulo").text("Nueva Marca");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-lg");

        $('#modal-content').empty();
        $('#modal-content').load('/Manufacturer/Create/');

    }

    function NewCommercialModel() {
        $("#NuevoModeloComercial").removeAttr("data-toggle");
        $("#NuevoModeloComercial").removeAttr("data-target");

        var ID_MANU = $("#ID_MANU").data("kendoComboBox");

        if (ID_MANU.dataItem() === undefined) {
            toastr.warning("Selecciona una marca.", "Mensaje");
        }
        else {
            ID_MN = ID_MANU.dataItem().ID_MANU;
            $("#lblTitulo").text("Nuevo Modelo Comercial");

            $("#NuevoModeloComercial").attr("data-toggle", "modal");
            $("#NuevoModeloComercial").attr("data-target", "#miModal");

            $(".modal-dialog").removeClass("modal-sm");
            $(".modal-dialog").removeClass("modal-lg");

            $('#modal-content').empty();
            $('#modal-content').load("/CommercialModel/Create/" + ID_MANU.dataItem().ID_MANU + "?var=" + Math.random());
        }
    }

    function NewCostCenter() {
        $("#lblTitulo").text("Nuevo Centro de Costo");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-lg");
        $(".modal-dialog").addClass("modal-sm");

        $('#modal-content').empty();
        $('#modal-content').load("/CostCenter/Create?var=" + Math.random());
    }

    function NuevoContrato() {
        $("#lblTitulo").text("Nuevo Contrato");

        $(".modal-dialog").removeClass("modal-sm");
        $(".modal-dialog").removeClass("modal-lg");

        $('#modal-content').empty();
        $('#modal-content').load("/Contrato/Nuevo?var=" + Math.random());
    }

</script>

<script type="text/javascript">
    function cancel() {
        location = "http://" + location.host + "/Asset";
    }

    function uploadDone(msg, code, idActivo) {
        if (msg == "OK") {
            $("#btnMensajeConfirmacion").click();

            $("#lblTitulo").text("Información Guardada");

            $(".modal-dialog").removeClass("modal-sm");
            $(".modal-dialog").removeClass("modal-lg");
            $(".modal-dialog").addClass("modal-sm");

            $('#modal-content').empty();
            $('#modal-content').html("<div class='form-group row'><div class='col-md-12'>Información del Nuevo Activo ha sido guardado correctamente.</div></div>" +
                "<div class='form-group row'><div class='col-md-6'><button class='btn btn-light btn-block' id='btnAgregarHW'>Agregar HW</button></div>" +
                "<div class='col-md-6'><button class='btn btn-primary btn-block' id='btnContinuar'>Continuar</button></div></div> ");


            $(".close").click(function () {
                location = "http://" + location.host + "/Asset/Detalle/" + idActivo;
            });

            var undo = $("#btnAgregarHW").bind("click", function () {

                $("#lblTitulo").text("Agregar/Actualizar HW");

                $(".modal-dialog").removeClass("modal-sm");
                $(".modal-dialog").removeClass("modal-lg");
                $(".modal-dialog").addClass("modal-lg");
                $("#btnAgregarHW").attr("data-backdrop", "static");

                $('#modal-content').empty();
                $('#modal-content').load("/Asset/Componentes/" + idActivo + "?crea=1&var=" + Math.random());
            });

            $("#btnContinuar").click(function () {
                $("[data-dismiss=modal]").trigger({ type: "click" });
                location = "http://" + location.host + "/Asset/Detalle/" + idActivo;
            });
        }
        else if (msg == "INFO") {
            toastr.warning(code, "Mensaje");
        } else if (msg == "ERROR") {
            var titleAsset = '';
            var messageAsset = '';
            if (code == '0') {
                titleAsset = 'Alerta';
                messageAsset = 'Por favor completar la información';
            }
            else if (code == '1') {
                titleAsset = 'Alerta';
                messageAsset = 'Ha ocurrido un error, contacte al administrador';
            }
            else if (code == '2') {
                titleAsset = 'Sesión expirada';
                messageAsset = 'Por favor vuelva a ingresar al sistema.';
            }
            else if (code == '3') {
                titleAsset = 'Duplicidad de Activos';
                messageAsset = 'El código de activo o la serie ingresada ya existen. Por favor validar.';
            }

            toastr.warning(messageAsset, "Mensaje");
        }
    }

</script>
